<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>××•×“×œ "×¨×›×‘×ª-××˜×‘×•×œ×™×ª" â€” ×”×œ×‘×œ×‘ ×›××¨×›×– ×•×ª×—× ×•×ª ×‘××™×‘×¨×™×</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --accent:#2563eb; --good:#16a34a; --warn:#f59e0b; --bad:#dc2626;
      --shadow:0 10px 28px rgba(0,0,0,.08); --r:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); background:var(--bg); color:var(--text);}
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(246,247,251,.9); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 16px;}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    h1{margin:0; font-size:20px; line-height:1.2}
    .sub{color:var(--muted); font-size:13px; margin-top:4px}
    .pill{
      display:inline-flex; gap:10px; align-items:center; flex-wrap:wrap;
      border:1px solid var(--line); background:#fff; padding:10px 12px;
      border-radius:999px; box-shadow:0 2px 10px rgba(0,0,0,.05);
    }
    select, button, input[type="range"]{font:inherit}
    button{
      border:1px solid var(--line); background:#fff; padding:9px 12px;
      border-radius:12px; cursor:pointer; transition:.15s transform, .15s background;
    }
    button:hover{background:#fafafa}
    button:active{transform:scale(.98)}
    .btn-primary{
      border-color:rgba(37,99,235,.25); background:rgba(37,99,235,.10);
      color:#0b2e8f; font-weight:800;
    }
    .btn-ghost{background:transparent}
    main{padding:18px 0 40px;}
    .grid{display:grid; grid-template-columns: 1.25fr .75fr; gap:14px;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:var(--r);
      box-shadow:var(--shadow); padding:16px;
    }
    .card h2{margin:0 0 10px 0; font-size:18px}
    .card h3{margin:14px 0 8px 0; font-size:15px}
    p{margin:8px 0; line-height:1.65}
    .muted{color:var(--muted)}
    .hr{height:1px; background:var(--line); margin:14px 0}
    .kbd{
      font-family:var(--mono); background:#0b1220; color:#e5e7eb;
      border-radius:12px; padding:12px; overflow:auto; font-size:13px; line-height:1.6;
      border:1px solid rgba(255,255,255,.06);
      white-space:pre-wrap;
    }
    .note{border:1px dashed rgba(37,99,235,.35); background:rgba(37,99,235,.06); border-radius:12px; padding:12px;}
    .warn{border:1px dashed rgba(245,158,11,.45); background:rgba(245,158,11,.08); border-radius:12px; padding:12px;}
    .ok{border:1px dashed rgba(22,163,74,.35); background:rgba(22,163,74,.06); border-radius:12px; padding:12px;}
    .tags{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .tag{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; color:#111827}
    .tag.good{border-color:rgba(22,163,74,.25); background:rgba(22,163,74,.08)}
    .tag.warn{border-color:rgba(245,158,11,.25); background:rgba(245,158,11,.10)}
    .tag.bad{border-color:rgba(220,38,38,.25); background:rgba(220,38,38,.08)}
    .mini{font-size:12px}
    .controls{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;}
    @media (max-width: 640px){ .controls{grid-template-columns:1fr;} }
    .ctl{
      border:1px solid var(--line); border-radius:12px; padding:10px; background:#fff;
    }
    .ctl label{display:flex; justify-content:space-between; gap:10px; font-size:13px; color:#111827; font-weight:700}
    .ctl .v{color:var(--muted); font-weight:600}
    input[type="range"]{width:100%}
    canvas{width:100%; height:260px; border:1px solid var(--line); border-radius:12px; background:#fff}
    .twoCols{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media (max-width: 980px){ .twoCols{grid-template-columns:1fr;} }
    details{border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:#fff;}
    details summary{cursor:pointer; font-weight:800}
    a{color:var(--accent); text-decoration:none; font-weight:800}
    a:hover{text-decoration:underline}
    .foot{font-size:12px; color:var(--muted); margin-top:10px}
    .svgBox{border:1px solid var(--line); border-radius:12px; background:#fff; padding:10px; overflow:auto}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="row">
      <div>
        <h1>××•×“×œ â€œ×¨×›×‘×ª-××˜×‘×•×œ×™×ªâ€ (Metabolic Railway)</h1>
        <div class="sub">×”×œ×‘×œ×‘ + ×”×›×‘×“ ×›××¨×›×–×™ ×‘×§×¨×”, ×•×´×ª×—× ×•×ª×´ ×‘×›×œ ××™×‘×¨ (×•×‘×›×œ ×ª×) ×œ×•×•×™×¡×•×ª ×’×œ×•×§×•×– + ×©×•×× ×™× + ×—×œ×‘×•× ×™× + × ×•×–×œ×™×</div>
      </div>
      <div class="pill">
        <button class="btn-primary" id="btnDownload">â¬‡ï¸ ×”×•×¨×“×ª ×”×§×•×‘×¥ (HTML)</button>
        <button class="btn-ghost" id="btnCopy">ğŸ“‹ ×”×¢×ª×§×ª ×©× ×§×•×‘×¥</button>
        <select id="mode">
          <option value="normal">××¦×‘ ×¨×’×™×œ</option>
          <option value="study">××¦×‘ ×œ×™××•×“ (×™×•×ª×¨ ×”×¢×¨×•×ª)</option>
          <option value="compact">××¦×‘ ×§×•××¤×§×˜×™</option>
        </select>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap grid">
    <section class="card">
      <h2>1) ×ª×™×§×•×Ÿ ××•×©×’×™× ×•×”×’×“×¨×ª ×”×¨×¢×™×•×Ÿ</h2>

      <div class="warn">
        <b>×“×™×•×§ ×—×©×•×‘:</b>
        <ul style="margin:8px 0 0 0; padding-right:18px">
          <li><b>×”×˜×—×•×œ (Ø·Ø­Ø§Ù„)</b> ××™× ×• â€œ××™×‘×¨ ××™×–×•×Ÿ ×¡×•×›×¨â€. ×ª×¤×§×™×“×™×• ×”×¢×™×§×¨×™×™×: ××¢×¨×›×ª ×—×™×¡×•×Ÿ, ×¡×™× ×•×Ÿ/××—×–×•×¨ ×ª××™ ×“×.</li>
          <li><b>×”×œ×‘×œ×‘ (Ø§Ù„Ø¨Ù†ÙƒØ±ÙŠØ§Ø³)</b> ×›×Ÿ ××¨×›×–×™ ×‘××™×–×•×Ÿ ×¡×•×›×¨: ××¤×¨×™×© <b>××™× ×¡×•×œ×™×Ÿ</b> ×•<b>×’×œ×•×§×’×•×Ÿ</b> ×œ×“×.</li>
          <li><b>×”×›×‘×“</b> ×”×•× â€œ××—×¡×Ÿ/×× ×”×œ ×œ×•×’×™×¡×˜×™â€ ×©×œ ×× ×¨×’×™×”: ××’×™×¨×” (×’×œ×™×§×•×’×Ÿ), ×©×—×¨×•×¨ ×’×œ×•×§×•×–, ×™×™×¦×•×¨ ×’×œ×•×§×•×–, × ×™×”×•×œ ×©×•×× ×™× ×•×—×œ×‘×•× ×™×.</li>
          <li><b>×”×›×œ×™×•×ª</b> ××¡× × ×•×ª ×“× ×•×× ×”×œ×•×ª ××™×/××œ×—×™×; ×§×©×•×¨×•×ª ×’× ×œ×’×œ×•×§×•×– (×¡×¤×™×’×” ××—×“×© + ××™×‘×•×“ ×’×œ×•×§×•×– ×›×©×’×‘×•×”).</li>
        </ul>
      </div>

      <p>
        ×”×¨×¢×™×•×Ÿ: ×œ×¨××•×ª ××ª ×”×’×•×£ ×›<b>××¢×¨×›×ª ×¨×›×‘×•×ª</b> â€” ×”×“× ×”×•× ×”××¡×™×œ×•×ª, ×”×œ×‘ ×”×•× ×”××©××‘×”,
        ×•×”×œ×‘×œ×‘/×›×‘×“ ×”× <b>××’×“×œ ×¤×™×§×•×—</b>. ×‘×›×œ ××™×‘×¨ ×™×© â€œ×ª×—× ×”â€ ×©××§×‘×œ×ª ×¤×§×•×“×•×ª (×”×•×¨××•× ×™×) ×•××•×“×“×ª ××¦×‘ ××§×•××™,
        ×•××– ××—×œ×™×˜×” ×›××” ×œ×§×œ×•×˜/×œ×¦×¨×•×š/×œ××’×•×¨/×œ×©×—×¨×¨ ×—×•××¨×™×.
      </p>

      <div class="note">
        <b>×”×—×™×“×•×© ×”××•×“×œ×™:</b> ×œ× ×¨×§ â€œ×¤×§×•×“×” ××—×ªâ€ ××”×œ×‘×œ×‘, ××œ× <b>×¨×©×ª ×‘×§×¨×” ×”×™×¨×¨×›×™×ª</b>:
        <ul style="margin:8px 0 0 0; padding-right:18px">
          <li><b>×‘×§×¨-×¢×œ</b>: ×œ×‘×œ×‘ + ×›×‘×“ (×”×•×¨××•× ×™× + × ×™×”×•×œ ××—×¡× ×™×).</li>
          <li><b>×‘×§×¨×™×-×ª×—× ×ª×™×™×</b>: ×©×¨×™×¨/×©×•××Ÿ/××•×—/×›×œ×™×”/×œ×‘ ×•×›×•â€™ (×§×œ×™×˜×”/×¦×¨×™×›×”/×”××¨×”).</li>
          <li><b>××™×§×¨×•-×‘×§×¨×™×</b>: ×‘×ª×•×š ×”×ª××™× (××¡×œ×•×œ×™ ATP, GLUT, ×× ×–×™××™×, ××™×˜×•×›×•× ×“×¨×™×”).</li>
        </ul>
      </div>

      <div class="hr"></div>

      <h2>2) ×”××•×“×œ ×›×¨×©×ª (Network) â€” â€œ××¡×™×œ×•×ª + ×ª×—× ×•×ªâ€</h2>
      <p class="muted">× ×’×“×™×¨ â€œ××˜×¢×Ÿâ€ ×©××¡×ª×•×‘×‘ ×‘×“×: ×’×œ×•×§×•×–, ×—×•××¦×•×ª ×©×•××Ÿ, ×—×•××¦×•×ª ×××™× ×•, ×œ×§×˜×˜, ×’×•×¤×™ ×§×˜×•×Ÿ, ××™×/××œ×—×™×, ×•×¢×•×“.</p>

      <div class="twoCols">
        <div class="ok">
          <b>××¨×›×–×™ ×‘×§×¨×” (Dispatch):</b>
          <ul style="margin:8px 0 0 0; padding-right:18px">
            <li><b>×”×œ×‘×œ×‘</b>: ××©×“×¨ ××•×ª×•×ª â€” ××™× ×¡×•×œ×™×Ÿ (I), ×’×œ×•×§×’×•×Ÿ (H), ×•×¢×•×“.</li>
            <li><b>×”×›×‘×“</b>: ××‘×¦×¢ ×©×™× ×•×™ ×–×¨×™××•×ª ×‘×¤×•×¢×œ â€” ××—×¡×•×Ÿ/×©×—×¨×•×¨/×™×™×¦×•×¨ ×’×œ×•×§×•×–; × ×™×”×•×œ ×©×•××Ÿ ×•×—×œ×‘×•×Ÿ.</li>
          </ul>
        </div>
        <div class="note">
          <b>×ª×—× ×•×ª ×‘××™×‘×¨×™× (Stations):</b>
          <ul style="margin:8px 0 0 0; padding-right:18px">
            <li><b>×©×¨×™×¨</b>: ×§×œ×™×˜×ª ×’×œ×•×§×•×– ×•×©×¨×™×¤×”/××’×™×¨×” (×¨×’×™×© ×œ××™× ×¡×•×œ×™×Ÿ).</li>
            <li><b>×©×•××Ÿ</b>: ×§×œ×™×˜×”/××’×™×¨×”; ×”×©×¤×¢×” ×¢×œ ×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ.</li>
            <li><b>××•×—</b>: ×¦×¨×™×›×” ×™×¦×™×‘×” ×™×—×¡×™×ª (×—×œ×§×” ×œ× ×ª×œ×•×™×” ×‘××™× ×¡×•×œ×™×Ÿ).</li>
            <li><b>×›×œ×™×”</b>: ×¡×™× ×•×Ÿ + ×¡×¤×™×’×” ××—×“×© + ××™×‘×•×“ ×’×œ×•×§×•×– ×›×©×’×‘×•×”.</li>
            <li><b>×œ×‘</b>: ×¦×¨×™×›×ª ×× ×¨×’×™×” ×’×‘×•×”×”, ××©×ª××© ×’× ×‘×©×•××Ÿ/×§×˜×•× ×™×.</li>
          </ul>
        </div>
      </div>

      <h3>2.1 ×ª×¨×©×™× ×–×¨×™××” (Flow) â€” ×‘××‘×˜ ××—×“</h3>
      <div class="svgBox">
        <svg viewBox="0 0 980 340" width="980" height="340" role="img" aria-label="×ª×¨×©×™× ×–×¨×™××”">
          <defs>
            <filter id="sh" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="3" stdDeviation="4" flood-color="#000" flood-opacity=".15"/>
            </filter>
            <marker id="arr" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
              <path d="M0,0 L10,5 L0,10 z" fill="#2563eb"></path>
            </marker>
          </defs>

          <rect x="15" y="20" width="290" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="160" y="55" text-anchor="middle" font-size="16" font-weight="700" fill="#111827">×”×œ×‘×œ×‘ (Pancreas)</text>
          <text x="160" y="82" text-anchor="middle" font-size="13" fill="#6b7280">××•×ª ×‘×§×¨×”: ××™× ×¡×•×œ×™×Ÿ I(t), ×’×œ×•×§×’×•×Ÿ H(t)</text>
          <text x="160" y="108" text-anchor="middle" font-size="13" fill="#6b7280">××©×“×¨ â€œ×¤×§×•×“×•×ªâ€ ×œ×´×ª×—× ×•×ª×´</text>

          <rect x="340" y="20" width="290" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="485" y="55" text-anchor="middle" font-size="16" font-weight="700" fill="#111827">×”×›×‘×“ (Liver)</text>
          <text x="485" y="82" text-anchor="middle" font-size="13" fill="#6b7280">××—×¡×Ÿ + ×™×™×¦×•×¨/×©×—×¨×•×¨/××’×™×¨×”</text>
          <text x="485" y="108" text-anchor="middle" font-size="13" fill="#6b7280">×× ×”×œ ×–×¨×™××•×ª ×‘×¤×•×¢×œ</text>

          <rect x="665" y="20" width="300" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="815" y="55" text-anchor="middle" font-size="16" font-weight="700" fill="#111827">×”×“× (Blood) = â€œ××¡×™×œ×•×ªâ€</text>
          <text x="815" y="82" text-anchor="middle" font-size="13" fill="#6b7280">××˜×¢×Ÿ: ×’×œ×•×§×•×–/×©×•××Ÿ/×—×œ×‘×•×Ÿ/× ×•×–×œ×™×</text>
          <text x="815" y="108" text-anchor="middle" font-size="13" fill="#6b7280">×”×œ×‘ = ×”××©××‘×”</text>

          <line x1="305" y1="80" x2="340" y2="80" stroke="#2563eb" stroke-width="3" marker-end="url(#arr)"/>
          <line x1="630" y1="80" x2="665" y2="80" stroke="#2563eb" stroke-width="3" marker-end="url(#arr)"/>

          <rect x="70" y="190" width="200" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="170" y="222" text-anchor="middle" font-size="15" font-weight="700" fill="#111827">×©×¨×™×¨</text>
          <text x="170" y="246" text-anchor="middle" font-size="12" fill="#6b7280">×§×œ×™×˜×” â†‘ ×¢× ××™× ×¡×•×œ×™×Ÿ</text>
          <text x="170" y="268" text-anchor="middle" font-size="12" fill="#6b7280">×©×¨×™×¤×”/××’×™×¨×”</text>

          <rect x="300" y="190" width="200" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="400" y="222" text-anchor="middle" font-size="15" font-weight="700" fill="#111827">×©×•××Ÿ</text>
          <text x="400" y="246" text-anchor="middle" font-size="12" fill="#6b7280">××’×™×¨×” + ××•×ª×•×ª ×“×œ×§×ª</text>
          <text x="400" y="268" text-anchor="middle" font-size="12" fill="#6b7280">×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ</text>

          <rect x="530" y="190" width="200" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="630" y="222" text-anchor="middle" font-size="15" font-weight="700" fill="#111827">××•×—</text>
          <text x="630" y="246" text-anchor="middle" font-size="12" fill="#6b7280">×¦×¨×™×›×” ×™×¦×™×‘×” ×™×—×¡×™×ª</text>
          <text x="630" y="268" text-anchor="middle" font-size="12" fill="#6b7280">×¤×—×•×ª ×ª×œ×•×™ ××™× ×¡×•×œ×™×Ÿ</text>

          <rect x="760" y="190" width="200" height="120" rx="16" fill="#ffffff" stroke="#e5e7eb" filter="url(#sh)"/>
          <text x="860" y="222" text-anchor="middle" font-size="15" font-weight="700" fill="#111827">×›×œ×™×”</text>
          <text x="860" y="246" text-anchor="middle" font-size="12" fill="#6b7280">×¡×™× ×•×Ÿ + ×¡×¤×™×’×” ××—×“×©</text>
          <text x="860" y="268" text-anchor="middle" font-size="12" fill="#6b7280">××™×‘×•×“ ×’×œ×•×§×•×– ×›×©×’×‘×•×”</text>

          <line x1="815" y1="140" x2="170" y2="190" stroke="#2563eb" stroke-width="2" marker-end="url(#arr)" opacity=".5"/>
          <line x1="815" y1="140" x2="400" y2="190" stroke="#2563eb" stroke-width="2" marker-end="url(#arr)" opacity=".5"/>
          <line x1="815" y1="140" x2="630" y2="190" stroke="#2563eb" stroke-width="2" marker-end="url(#arr)" opacity=".5"/>
          <line x1="815" y1="140" x2="860" y2="190" stroke="#2563eb" stroke-width="2" marker-end="url(#arr)" opacity=".5"/>
        </svg>
      </div>

      <div class="hr"></div>

      <h2>3) ×œ×™×‘×” ××ª××˜×™×ª (×¤×©×•×˜×” ××‘×œ ×©×™××•×©×™×ª)</h2>
      <p>
        × ×¡××Ÿ ××ª ×¨×™×›×•×– ×”×’×œ×•×§×•×– ×‘×“× ×›Ö¾<b>G(t)</b> (×œ××©×œ mg/dL). ×™×© ×›× ×™×¡×•×ª ×•×™×¦×™××•×ª:
        ×›× ×™×¡×” ××”××¢×™ ××—×¨×™ ××•×›×œ, ×©×—×¨×•×¨/×™×™×¦×•×¨ ××”×›×‘×“, ×§×œ×™×˜×” ×‘××™×‘×¨×™×, ×•××™×‘×•×“ ×‘×›×œ×™×” ×›×©×’×‘×•×”.
      </p>

      <div class="kbd" id="eqBlock">
dG/dt = P_gut(t) + R_liver(t) - Î£_k u_k(t) - E_kidney(t)

P_gut(t)    = A * exp(-(t - t0)/tau)   (×œ××—×¨ ××¨×•×—×”)
R_liver(t)  = r0 + rG * max(0, Gset - G) - rI * I
u_muscle(t) = kM * S * I * max(0, G - Gmin)
u_fat(t)    = kF * S * I * max(0, G - Gmin)
u_brain(t)  = kB * max(0, G - GminB)    (×›××¢×˜ ×§×‘×•×¢)
E_kidney(t) = kE * max(0, G - Thr)      (××™×‘×•×“ ×‘×©×ª×Ÿ ××¢×œ ×¡×£)

I(t)        = i0 + iG * max(0, G - Gset) (×‘×§×¨ ×¤×™×“×‘×§ ×¤×©×•×˜)
S           âˆˆ [0..1] (×¨×’×™×©×•×ª ×œ××™× ×¡×•×œ×™×Ÿ)
      </div>

      <details style="margin-top:12px">
        <summary>××” ×”××©×•×•××•×ª ××•××¨×•×ª â€œ×‘×¢×‘×¨×™×ª ×¤×©×•×˜×”â€</summary>
        <div style="margin-top:10px" class="muted">
          <ul style="margin:0; padding-right:18px; line-height:1.7">
            <li><b>P_gut</b>: ××—×¨×™ ××•×›×œ ×™×© â€œ×’×œâ€ ×©×œ ×’×œ×•×§×•×– ××”××¢×™ ×œ×“× (×“×•×¢×š ×‘×–××Ÿ).</li>
            <li><b>R_liver</b>: ×”×›×‘×“ ××©×—×¨×¨ ×™×•×ª×¨ ×›×©Ö¾G × ××•×š, ×•××©×—×¨×¨ ×¤×—×•×ª ×›×©×™×© ××™× ×¡×•×œ×™×Ÿ.</li>
            <li><b>u_k</b>: ×›×œ â€œ×ª×—× ×”â€ ×§×•×œ×˜×ª ×’×œ×•×§×•×–. ×‘×©×¨×™×¨/×©×•××Ÿ ×–×” ×¢×•×œ×” ×›×©×™×© ××™× ×¡×•×œ×™×Ÿ ×•×‘×›×œ×œ ×›×©Ö¾G ×’×‘×•×”.</li>
            <li><b>E_kidney</b>: ×”×›×œ×™×” ××ª×—×™×œ×” â€œ×œ×–×¨×•×§â€ ×’×œ×•×§×•×– ×œ×©×ª×Ÿ ××¢×œ ×¡×£ (Thr).</li>
            <li><b>I(t)</b>: ×‘×§×¨ ×¤×©×•×˜: ×× G ×’×‘×•×” ××”×™×¢×“ (Gset) â€” ×”××™× ×¡×•×œ×™×Ÿ ×¢×•×œ×”.</li>
          </ul>
          <div class="warn" style="margin-top:10px">
            <b>×”×¢×¨×ª ×‘×˜×™×—×•×ª:</b> ×–×” ××•×“×œ ×—×™× ×•×›×™/×”× ×“×¡×™, ×œ× ×›×œ×™ ×¨×¤×•××™ ×•×œ× ×ª×—×œ×™×£ ×œ×™×™×¢×•×¥ ×¨×¤×•××™.
          </div>
        </div>
      </details>

      <div class="hr"></div>

      <h2>4) ×”â€×ª×—× ×•×ªâ€ ×‘×¨××ª ×ª× â€” ×œ××” ×–×” ×—×©×•×‘</h2>
      <p>
        ×‘×¨××ª ×”×ª× ×§×™×™××™× ×›×‘×¨ â€œ×× ×’× ×•× ×™ ×ª×—× ×”â€: ×©×¢×¨×™× ×œ×’×œ×•×§×•×– (×œ××©×œ GLUT),
        ×—×™×™×©× ×™ ×× ×¨×’×™×” (ATP/ADP, AMPK), ×•××¡×œ×•×œ×™× ×©××—×œ×™×˜×™× ×× ×œ×©×¨×•×£ ××• ×œ××’×•×¨.
        ×›×©×™×© ×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ â€” ×”×¤×§×•×“×” ××’×™×¢×” ××‘×œ ×”×©×¢×¨×™× × ×¤×ª×—×™× ×¤×—×•×ª (â€œ×ª×—× ×” ×—×œ×©×”â€).
      </p>

      <div class="tags">
        <span class="tag good">×ª×—× ×•×ª ××’×™×‘×•×ª = ××™×–×•×Ÿ ×™×¦×™×‘</span>
        <span class="tag warn">×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ = ×ª×’×•×‘×” ×—×œ×©×”</span>
        <span class="tag bad">×›×©×œ ×œ×‘×œ×‘ = ×¤×§×•×“×” ×œ× ××¡×¤×™×§×”</span>
      </div>

      <div class="hr"></div>

      <h2>5) ×”×¨×—×‘×” ××¢×‘×¨ ×œ×¡×•×›×¨: ×©×•××Ÿ/×—×œ×‘×•×Ÿ/× ×•×–×œ×™× (×›×™×•×•×Ÿ ×¢×‘×•×“×”)</h2>
      <div class="twoCols">
        <div class="note">
          <b>×©×•×× ×™×</b>
          <ul style="margin:8px 0 0 0; padding-right:18px">
            <li>×›×‘×“: ×™×¦×™×¨×”/×¤×™×¨×•×§ ×©×•××Ÿ + ×™×¦×™×¨×ª ×’×•×¤×™ ×§×˜×•×Ÿ ×‘×¦×•×.</li>
            <li>×©×•××Ÿ: ××’×™×¨×”/×©×—×¨×•×¨ ×—×•××¦×•×ª ×©×•××Ÿ ×•×”×©×¤×¢×” ×¢×œ ×“×œ×§×ª.</li>
          </ul>
        </div>
        <div class="note">
          <b>×—×œ×‘×•× ×™×</b>
          <ul style="margin:8px 0 0 0; padding-right:18px">
            <li>×›×‘×“: ××•×¨××” (×¤×™× ×•×™ ×××•× ×™×”), ×™×™×¦×•×¨ ×—×œ×‘×•× ×™ ×“×.</li>
            <li>×©×¨×™×¨: ×××’×¨ ×—×œ×‘×•×Ÿ ×•×©×™××•×© ×‘×—×•××¦×•×ª ×××™× ×• ×‘×¦×•×/××××¥.</li>
          </ul>
        </div>
      </div>
      <div class="twoCols" style="margin-top:12px">
        <div class="note">
          <b>× ×•×–×œ×™×/××œ×—×™×</b>
          <ul style="margin:8px 0 0 0; padding-right:18px">
            <li>×›×œ×™×•×ª: â€œ×ª×—× ×ª ××™×â€ ××¨×›×–×™×ª â€” ××™×–×•×Ÿ × ×ª×¨×Ÿ/××©×œ×’×Ÿ/××™×/×œ×—×¥ ×“×.</li>
            <li>×›×‘×“: ××œ×‘×•××™×Ÿ (××©×¤×™×¢ ×¢×œ × ×¤×— ×”×“×) ×•×¢×•×“.</li>
          </ul>
        </div>
        <div class="ok">
          <b>××˜×¨×” ×”× ×“×¡×™×ª</b>
          <div class="muted">×œ×”×’×“×™×¨ ×œ×›×œ ×ª×—× ×” â€œ×—×™×™×©× ×™× â†’ ×”×—×œ×˜×” â†’ ×¤×¢×•×œ×”â€ ×•×œ×‘×“×•×§ ×™×¦×™×‘×•×ª ×©×œ ×”×¨×©×ª ×œ××•×¨×š ×–××Ÿ.</div>
        </div>
      </div>

      <div class="foot">
        ×× ×ª×¨×¦×”, ××¤×©×¨ ×œ×”×•×¡×™×£ ×‘×”××©×š: â€œ××“×“ ×¢×•××¡ ×ª×—× ×”â€ (Station Load), ××¦×‘×™ ×›×©×œ, ×•× ×™×ª×•×— ×™×¦×™×‘×•×ª (Stability).
      </div>
    </section>

    <aside class="card">
      <h2>×¡×™××•×œ×¦×™×” ××™× ×˜×¨××§×˜×™×‘×™×ª (×“××•)</h2>
      <p class="muted">
        ×©×™× ×•×™ ×¤×¨××˜×¨×™× ×•×œ×—×™×¦×” ×¢×œ â€œ×”×¨×¥ ×¡×™××•×œ×¦×™×”â€ ×™×™×¦×¨×• ×’×¨×£ ×©×œ G(t) (×’×œ×•×§×•×– ×‘×“×).
      </p>

      <canvas id="plot" width="980" height="520"></canvas>

      <div class="controls">
        <div class="ctl">
          <label>××¨×•×—×” (A) <span class="v" id="vMeal">80</span></label>
          <input type="range" min="0" max="180" value="80" step="1" id="meal"/>
          <div class="muted mini">×¢×•×¦××ª â€œ×’×œâ€ ×’×œ×•×§×•×– ××”××¢×™</div>
        </div>
        <div class="ctl">
          <label>×¨×’×™×©×•×ª ×œ××™× ×¡×•×œ×™×Ÿ (S) <span class="v" id="vSens">0.70</span></label>
          <input type="range" min="0" max="1" value="0.70" step="0.01" id="sens"/>
          <div class="muted mini">× ××•×š = ×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ</div>
        </div>
        <div class="ctl">
          <label>×¡×£ ×›×œ×™×” (Thr) <span class="v" id="vThr">180</span></label>
          <input type="range" min="120" max="240" value="180" step="1" id="thr"/>
          <div class="muted mini">××¢×œ ×”×¡×£ â€” ××™×‘×•×“ ×’×œ×•×§×•×– ×‘×©×ª×Ÿ</div>
        </div>
        <div class="ctl">
          <label>×™×¢×“ ×’×œ×•×§×•×– (Gset) <span class="v" id="vSet">95</span></label>
          <input type="range" min="70" max="120" value="95" step="1" id="gset"/>
          <div class="muted mini">× ×§×•×“×ª ×™×™×—×•×¡ ×œ×‘×§×¨ ×”×œ×‘×œ×‘</div>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="btn-primary" id="run">â–¶ï¸ ×”×¨×¥ ×¡×™××•×œ×¦×™×”</button>
        <button id="reset">â†©ï¸ ××™×¤×•×¡</button>
      </div>

      <div class="hr"></div>
      <h3>×¤×¢× ×•×— ××”×™×¨</h3>
      <div class="kbd" id="readout">×œ×—×¥ â€œ×”×¨×¥ ×¡×™××•×œ×¦×™×”â€ ×›×“×™ ×œ×¨××•×ª ×ª×•×¦××”.</div>

      <details style="margin-top:12px">
        <summary>××” ×‘×“×™×•×§ ××“××” ×”×“××•?</summary>
        <div class="muted" style="margin-top:10px; line-height:1.7">
          ××•×“×œ â€œ×¦×¢×¦×•×¢â€ ×©××“×’×™×:
          <ul style="margin:8px 0 0 0; padding-right:18px">
            <li>×›× ×™×¡×” ××”××¢×™ ×œ××—×¨ ××¨×•×—×”</li>
            <li>×¤×§×•×“×ª ××™× ×¡×•×œ×™×Ÿ ×›×¤×™×“×‘×§ ×¢×œ G</li>
            <li>×§×œ×™×˜×” ×‘×©×¨×™×¨/×©×•××Ÿ ×›×¤×•× ×§×¦×™×” ×©×œ ××™× ×¡×•×œ×™×Ÿ ×•×¨×’×™×©×•×ª</li>
            <li>×©×—×¨×•×¨ ×‘×¡×™×¡×™ ××”×›×‘×“ + ×¤×™×¦×•×™ ×›×©Ö¾G × ××•×š</li>
            <li>××™×‘×•×“ ×‘×›×œ×™×” ××¢×œ ×¡×£</li>
          </ul>
        </div>
      </details>

      <div class="warn" style="margin-top:12px">
        <b>×”×¢×¨×”:</b> ×œ×”×“×’××”/×œ××™×“×”/×”× ×“×¡×” ×©×œ ××¢×¨×›×ª ×‘×§×¨×” â€” ×œ× ×œ×©×™××•×© ×§×œ×™× ×™.
      </div>
    </aside>
  </div>
</main>

<script>
const $ = (id)=>document.getElementById(id);
function fmt(n, d=2){ return Number(n).toFixed(d); }

function setMode(mode){
  document.body.style.fontSize = (mode==="compact") ? "14px" : "15px";
  const eq = $("eqBlock");
  if(mode==="compact"){
    eq.style.maxHeight = "190px";
    eq.style.overflow = "auto";
  }else{
    eq.style.maxHeight = "none";
    eq.style.overflow = "visible";
  }
  if(mode==="study"){
    document.documentElement.style.setProperty('--shadow','0 12px 34px rgba(0,0,0,.10)');
  }else{
    document.documentElement.style.setProperty('--shadow','0 10px 28px rgba(0,0,0,.08)');
  }
}
$("mode").addEventListener("change", (e)=>setMode(e.target.value));
setMode($("mode").value);

// Download self
$("btnDownload").addEventListener("click", ()=>{
  const blob = new Blob([document.documentElement.outerHTML], {type:"text/html;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "metabolic_railway_model_he.html";
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
});

$("btnCopy").addEventListener("click", async ()=>{
  const name = "metabolic_railway_model_he.html";
  try{ await navigator.clipboard.writeText(name); alert("×”×•×¢×ª×§: " + name); }
  catch(e){ prompt("×”×¢×ª×§ ×™×“× ×™×ª:", name); }
});

// Plot
const canvas = $("plot");
const ctx = canvas.getContext("2d");

function drawAxes(){
  const w = canvas.width, h = canvas.height;
  ctx.clearRect(0,0,w,h);
  ctx.lineWidth = 1;
  ctx.strokeStyle = "#e5e7eb";
  ctx.strokeRect(0.5,0.5,w-1,h-1);

  const m = {l:70, r:18, t:18, b:56};

  ctx.strokeStyle = "#111827";
  ctx.beginPath();
  ctx.moveTo(m.l, m.t);
  ctx.lineTo(m.l, h-m.b);
  ctx.lineTo(w-m.r, h-m.b);
  ctx.stroke();

  ctx.fillStyle = "#111827";
  ctx.font = "14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillText("G(t) ×’×œ×•×§×•×– (mg/dL)", 12, 18);
  ctx.fillText("×–××Ÿ (×“×§×•×ª)", w/2 - 35, h-18);

  return m;
}

function plotSeries(series, ymin, ymax){
  const w = canvas.width, h = canvas.height;
  const m = drawAxes();
  const x0 = m.l, y0 = h-m.b, x1 = w-m.r, y1 = m.t;

  ctx.strokeStyle = "#e5e7eb";
  ctx.fillStyle = "#6b7280";
  ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";

  const yTicks = 6;
  for(let i=0;i<=yTicks;i++){
    const y = y0 - (y0-y1)*(i/yTicks);
    ctx.beginPath(); ctx.moveTo(x0,y); ctx.lineTo(x1,y); ctx.stroke();
    const v = ymin + (ymax-ymin)*(i/yTicks);
    ctx.fillText(String(Math.round(v)), 20, y+4);
  }

  const xTicks = 6;
  for(let i=0;i<=xTicks;i++){
    const x = x0 + (x1-x0)*(i/xTicks);
    ctx.beginPath(); ctx.moveTo(x,y0); ctx.lineTo(x,y1); ctx.stroke();
    const idx = Math.floor((series.t.length-1)*(i/xTicks));
    ctx.fillText(String(Math.round(series.t[idx])), x-10, h-30);
  }

  // line
  ctx.strokeStyle = "#2563eb";
  ctx.lineWidth = 3;
  ctx.beginPath();
  for(let i=0;i<series.t.length;i++){
    const x = x0 + (x1-x0)*(i/(series.t.length-1));
    const y = y0 - (y0-y1)*((series.G[i]-ymin)/(ymax-ymin));
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // target line
  const gset = parseFloat($("gset").value);
  ctx.strokeStyle = "rgba(22,163,74,.85)";
  ctx.lineWidth = 2;
  const ySet = y0 - (y0-y1)*((gset-ymin)/(ymax-ymin));
  ctx.beginPath(); ctx.moveTo(x0, ySet); ctx.lineTo(x1, ySet); ctx.stroke();
  ctx.fillStyle = "rgba(22,163,74,.95)";
  ctx.fillText("×™×¢×“ Gset", x1-65, ySet-6);

  // kidney threshold line
  const thr = parseFloat($("thr").value);
  ctx.strokeStyle = "rgba(245,158,11,.9)";
  ctx.lineWidth = 2;
  const yThr = y0 - (y0-y1)*((thr-ymin)/(ymax-ymin));
  ctx.beginPath(); ctx.moveTo(x0, yThr); ctx.lineTo(x1, yThr); ctx.stroke();
  ctx.fillStyle = "rgba(245,158,11,.95)";
  ctx.fillText("×¡×£ ×›×œ×™×” Thr", x1-95, yThr-6);
}

function simulate(params){
  const {A,S,Thr,Gset,tEnd,dt,t0,tau,i0,iG,r0,rG,rI,kM,kF,kB,kE,Gmin,GminB} = params;

  let G = Gset;
  const n = Math.floor(tEnd/dt)+1;
  const t = new Array(n), Gs = new Array(n), Is = new Array(n);

  for(let i=0;i<n;i++){
    const ti = i*dt;

    const P_gut = (ti>=t0) ? (A * Math.exp(-(ti-t0)/tau)) : 0;
    const I = i0 + iG*Math.max(0, G - Gset);

    const R_liver = r0 + rG*Math.max(0, Gset - G) - rI*I;

    const u_muscle = kM * S * I * Math.max(0, G - Gmin);
    const u_fat    = kF * S * I * Math.max(0, G - Gmin);
    const u_brain  = kB * Math.max(0, G - GminB);

    const E_kidney = kE * Math.max(0, G - Thr);

    const dG = (P_gut + R_liver - (u_muscle + u_fat + u_brain) - E_kidney);
    G = G + dt * dG;

    if(!Number.isFinite(G)) G = Gset;
    if(G < 30) G = 30;
    if(G > 450) G = 450;

    t[i]=ti; Gs[i]=G; Is[i]=I;
  }
  return {t, G:Gs, I:Is};
}

function summarize(series){
  const G = series.G;
  let min = Infinity, max = -Infinity, sum = 0;
  for(const v of G){ if(v<min)min=v; if(v>max)max=v; sum += v; }
  const avg = sum/G.length;

  const Thr = parseFloat($("thr").value);
  let above = 0;
  for(let i=1;i<G.length;i++){
    if(G[i] > Thr) above += (series.t[i]-series.t[i-1]);
  }
  return {min, max, avg, above};
}

function run(){
  const A = parseFloat($("meal").value);
  const S = parseFloat($("sens").value);
  const Thr = parseFloat($("thr").value);
  const Gset = parseFloat($("gset").value);

  const series = simulate({
    A,S,Thr,Gset,
    tEnd:240, dt:0.5,
    t0:20, tau:35,
    i0:0.8, iG:0.08,
    r0:0.20, rG:0.035, rI:0.015,
    kM:0.0028, kF:0.0016, kB:0.020,
    kE:0.010,
    Gmin:60, GminB:40
  });

  const s = summarize(series);
  const ymin = Math.max(40, Math.floor((s.min-20)/10)*10);
  const ymax = Math.min(450, Math.ceil((s.max+20)/10)*10);
  plotSeries(series, ymin, ymax);

  const status =
    (s.max < 160 && s.min > 70) ? "×™×¦×™×‘ ×™×—×¡×™×ª" :
    (s.max >= 200) ? "×©×™× ×’×‘×•×”" :
    (s.min <= 65) ? "× ××•×š ××“×™" : "×‘×™× ×™×™×";

  $("readout").textContent =
`×ª×•×¦××•×ª (4 ×©×¢×•×ª):
â€¢ ××™× ×™××•×: ${Math.round(s.min)} mg/dL
â€¢ ×××•×¦×¢:  ${Math.round(s.avg)} mg/dL
â€¢ ××§×¡×™××•×: ${Math.round(s.max)} mg/dL
â€¢ ×–××Ÿ ××¢×œ ×¡×£ ×›×œ×™×” Thr (${Thr}): ${Math.round(s.above)} ×“×§×•×ª
â€¢ ××¦×‘ ×›×œ×œ×™: ${status}

×¤×¨×©× ×•×ª ××”×™×¨×”:
- ×”×•×¨×“ S â†’ ×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ â†’ ×”×©×™× ×¢×•×œ×” ×•×™×•×¨×“ ×œ××˜ ×™×•×ª×¨.
- ×”×¢×œ×” A â†’ ××¨×•×—×” ×’×“×•×œ×” â†’ ×’×œ ×—×–×§ ×™×•×ª×¨.
- ×”×•×¨×“ Thr â†’ â€œ××™×‘×•×“ ×’×œ×•×§×•×–â€ ××•×§×“× ×™×•×ª×¨ ×‘×›×œ×™×”.`;
}

// sliders
function bindRange(id, outId, fn){
  const r = $(id), o = $(outId);
  const upd = ()=> o.textContent = fn ? fn(r.value) : r.value;
  r.addEventListener("input", upd);
  upd();
}
bindRange("meal","vMeal", v=>String(Math.round(parseFloat(v))));
bindRange("sens","vSens", v=>fmt(parseFloat(v),2));
bindRange("thr","vThr", v=>String(Math.round(parseFloat(v))));
bindRange("gset","vSet", v=>String(Math.round(parseFloat(v))));

$("run").addEventListener("click", run);
$("reset").addEventListener("click", ()=>{
  $("meal").value = 80;
  $("sens").value = 0.70;
  $("thr").value  = 180;
  $("gset").value = 95;
  ["meal","sens","thr","gset"].forEach(id => $(id).dispatchEvent(new Event("input")));
  drawAxes();
  $("readout").textContent = "××•×¤×¡. ×œ×—×¥ â€œ×”×¨×¥ ×¡×™××•×œ×¦×™×”â€ ×›×“×™ ×œ×¨××•×ª ×ª×•×¦××”.";
});

drawAxes();
</script>
</body>
</html>
