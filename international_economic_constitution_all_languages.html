<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>International Economic Constitution — Graph Sandwich Model</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- MathJax (renders equations) -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'],['$','$']] },
      options: { renderActions: { addMenu: [] } }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.88);
      --muted: rgba(255,255,255,.62);
      --gold: #d6b25e;
      --accent: #7dd3fc;
      --accent2: #a78bfa;
      --ok: #34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --border: rgba(255,255,255,.12);
      --shadow: 0 12px 40px rgba(0,0,0,.45);
      --radius: 18px;
    }
    [data-theme="light"]{
      --bg:#f7fafc;
      --panel: rgba(2,6,23,.05);
      --panel2: rgba(2,6,23,.08);
      --text: rgba(2,6,23,.92);
      --muted: rgba(2,6,23,.62);
      --border: rgba(2,6,23,.12);
      --shadow: 0 14px 40px rgba(2,6,23,.12);
    }

    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(125,211,252,.25), transparent 55%),
                  radial-gradient(900px 600px at 90% 20%, rgba(167,139,250,.22), transparent 55%),
                  radial-gradient(900px 600px at 50% 90%, rgba(52,211,153,.18), transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family: Inter, Noto Sans, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height:1.55;
      letter-spacing:.1px;
    }

    .wrap{max-width:1100px;margin:0 auto;padding:28px 18px 60px;}
    header{
      display:flex;gap:16px;align-items:center;justify-content:space-between;
      padding:18px 18px;
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{display:flex;gap:14px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: conic-gradient(from 220deg, var(--accent), var(--accent2), var(--ok), var(--accent));
      box-shadow:0 10px 28px rgba(0,0,0,.25);
      position:relative;overflow:hidden;
    }
    .logo:after{
      content:"";position:absolute;inset:-18px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 35%);
      transform: rotate(18deg);
      opacity:.7;
    }
    h1{margin:0;font-size:18px;font-weight:800}
    .subtitle{margin:0;color:var(--muted);font-size:13px}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:flex-end}
    .btn, select, input{
      border:1px solid var(--border);
      background:var(--panel);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      outline:none;
    }
    input::placeholder{color:var(--muted)}
    .btn{cursor:pointer;user-select:none}
    .btn:hover{background:var(--panel2)}
    .btn.primary{
      border-color: rgba(214,178,94,.45);
      box-shadow: 0 10px 26px rgba(214,178,94,.18);
    }
    .chip{
      display:inline-flex;gap:8px;align-items:center;
      padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background:var(--panel);
      color:var(--muted);
      font-size:12px
    }
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:16px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      header{flex-direction:column;align-items:stretch}
      .controls{justify-content:flex-start}
    }
    .card{
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      backdrop-filter: blur(10px);
    }
    .card h2{margin:0 0 10px;font-size:16px}
    .card p{margin:8px 0;color:var(--text)}
    .muted{color:var(--muted)}
    .gold, .mjx-container{ color: var(--gold) !important; }
    .mjx-container{ font-size: 108% !important; }

    .steps{display:flex;flex-direction:column;gap:12px}
    .step{
      border:1px solid var(--border);
      background:var(--panel);
      border-radius:16px;
      padding:14px;
    }
    .step-head{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
    .step-title{display:flex;gap:10px;align-items:flex-start}
    .num{
      width:30px;height:30px;border-radius:10px;
      background:rgba(214,178,94,.12);
      border:1px solid rgba(214,178,94,.32);
      display:flex;align-items:center;justify-content:center;
      font-weight:800;color:var(--gold)
    }
    .step h3{margin:0;font-size:14px}
    details{border-top:1px dashed var(--border);margin-top:10px;padding-top:10px}
    summary{cursor:pointer;color:var(--muted);font-weight:600}
    .kpi{
      display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px
    }
    .kpi .box{
      padding:12px;border-radius:14px;border:1px solid var(--border);
      background:rgba(255,255,255,.05)
    }
    .kpi .box b{display:block}
    .kpi .box span{color:var(--muted);font-size:12px}

    .svgwrap{border:1px solid var(--border);background:rgba(255,255,255,.03);border-radius:18px;padding:10px;overflow:hidden}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:8px}
    .note{
      margin-top:10px;
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(125,211,252,.35);
      background:rgba(125,211,252,.10);
      color:var(--text);
    }
    .danger{
      border:1px solid rgba(251,113,133,.45);
      background:rgba(251,113,133,.12);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .small{font-size:12px}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    /* Language dropdown big */
    #langSelect{max-width:340px}
    #langSearch{min-width:220px}
    .toast{
      position:fixed;left:16px;bottom:16px;z-index:99;
      padding:12px 14px;border-radius:14px;border:1px solid var(--border);
      background:rgba(0,0,0,.55);backdrop-filter: blur(10px);
      color:rgba(255,255,255,.92);box-shadow:var(--shadow);
      max-width:min(520px, calc(100vw - 32px));
      display:none;
    }
    [data-theme="light"] .toast{
      background:rgba(2,6,23,.75);
      color:rgba(255,255,255,.92);
    }
  </style>
</head>

<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 data-i18n="title">International Economic Constitution — “Graph Sandwich” Model</h1>
        <p class="subtitle" data-i18n="subtitle">A unified, transparent way to integrate multi-country economic rules and choose fair decisions within upper/lower legal bounds.</p>
      </div>
    </div>

    <div class="controls">
      <span class="chip"><span class="dot" style="background:var(--gold)"></span><span data-i18n="equationsGold">Equations are gold</span></span>
      <button class="btn" id="themeBtn" title="Toggle theme" data-i18n="toggleTheme">Toggle theme</button>

      <input id="langSearch" placeholder="Search language…" data-i18n-placeholder="searchLanguage" />
      <select id="langSelect" title="Language">
        <!-- populated by JS -->
      </select>

      <button class="btn primary" id="translateBtn" data-i18n="translate">Translate</button>
      <button class="btn" id="resetBtn" data-i18n="reset">Reset</button>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <h2 data-i18n="overviewTitle">Overview (what you described)</h2>
      <p data-i18n="overviewP1">
        Each country has its own economic-legal “constitution” (set of rules, treaties, and constraints). For any dispute, we integrate the relevant rules across countries,
        build a graph of legal reasoning paths, and for each scenario we define a “sandwich” of two concentric bounds:
        a lower bound (minimum permitted decision) and an upper bound (maximum permitted decision).
      </p>
      <p data-i18n="overviewP2">
        We then choose an optimal path among the best “sandwiches” (fair, stable, explainable). Optionally, we can also sample a path by a transparent weighted lottery
        to reduce bias and manipulation.
      </p>

      <div class="kpi">
        <div class="box">
          <b data-i18n="kpi1t">Lower bound</b>
          <span data-i18n="kpi1d">Minimum permitted remedy/sanction.</span>
        </div>
        <div class="box">
          <b data-i18n="kpi2t">Upper bound</b>
          <span data-i18n="kpi2d">Maximum permitted remedy/sanction.</span>
        </div>
        <div class="box">
          <b data-i18n="kpi3t">Graph paths</b>
          <span data-i18n="kpi3d">Legal reasoning as nodes and edges.</span>
        </div>
        <div class="box">
          <b data-i18n="kpi4t">Transparent record</b>
          <span data-i18n="kpi4d">Every decision becomes an auditable event.</span>
        </div>
      </div>

      <div class="note">
        <b data-i18n="noteTitle">How “All languages” works here:</b>
        <span data-i18n="noteBody">
          This HTML keeps a single source text (English) and can translate to virtually any language on demand using a configurable translation API (LibreTranslate-compatible).
          You can set a different endpoint/API key inside the “Translation settings” section.
        </span>
      </div>

      <details class="note danger">
        <summary data-i18n="limitsSummary">Important limitations (please read)</summary>
        <p class="small" data-i18n="limitsBody">
          “All languages” requires an online translation service when you press Translate. Some public endpoints may be rate-limited or blocked by browsers (CORS).
          If Translate fails, switch the endpoint to one you control (self-host LibreTranslate) or use a paid translation API.
          The math equations stay universal and are not translated.
        </p>
      </details>
    </section>

    <aside class="card">
      <h2 data-i18n="visualTitle">Visual intuition</h2>
      <p class="muted" data-i18n="visualSubtitle">A scenario bounded by two concentric circles + a graph of decision paths.</p>

      <div class="svgwrap">
        <svg viewBox="0 0 520 320" width="100%" height="auto" role="img" aria-label="Sandwich bounds and graph paths">
          <defs>
            <radialGradient id="glow" cx="40%" cy="35%" r="65%">
              <stop offset="0%" stop-color="rgba(255,255,255,.55)"/>
              <stop offset="45%" stop-color="rgba(255,255,255,.10)"/>
              <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
            </radialGradient>
            <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="2.2" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>

          <!-- Concentric bounds -->
          <g transform="translate(165,165)">
            <circle r="120" fill="rgba(214,178,94,.06)" stroke="rgba(214,178,94,.55)" stroke-width="2"/>
            <circle r="70"  fill="rgba(125,211,252,.07)" stroke="rgba(125,211,252,.60)" stroke-width="2"/>
            <circle r="20" fill="url(#glow)" opacity=".8"/>
            <circle r="8" fill="rgba(255,255,255,.85)" filter="url(#soft)"/>
            <text x="0" y="-132" text-anchor="middle" fill="rgba(214,178,94,.95)" font-size="12" font-weight="700">UPPER BOUND</text>
            <text x="0" y="-82" text-anchor="middle" fill="rgba(125,211,252,.95)" font-size="12" font-weight="700">LOWER BOUND</text>
            <text x="0" y="40" text-anchor="middle" fill="rgba(255,255,255,.85)" font-size="12" font-weight="700">Scenario</text>
          </g>

          <!-- Graph to the right -->
          <g transform="translate(330,40)">
            <path d="M20,30 C90,20 110,60 160,55" stroke="rgba(167,139,250,.7)" stroke-width="2" fill="none"/>
            <path d="M20,30 C95,80 110,105 160,120" stroke="rgba(125,211,252,.7)" stroke-width="2" fill="none"/>
            <path d="M160,55 C220,55 230,95 260,95" stroke="rgba(52,211,153,.7)" stroke-width="2" fill="none"/>
            <path d="M160,120 C220,120 230,95 260,95" stroke="rgba(52,211,153,.7)" stroke-width="2" fill="none"/>

            <g>
              <circle cx="20" cy="30" r="10" fill="rgba(255,255,255,.85)"/>
              <text x="20" y="34" text-anchor="middle" font-size="10" font-weight="800" fill="rgba(2,6,23,.9)">S</text>
            </g>

            <g>
              <circle cx="160" cy="55" r="10" fill="rgba(255,255,255,.85)"/>
              <text x="160" y="59" text-anchor="middle" font-size="10" font-weight="800" fill="rgba(2,6,23,.9)">A</text>
            </g>
            <g>
              <circle cx="160" cy="120" r="10" fill="rgba(255,255,255,.85)"/>
              <text x="160" y="124" text-anchor="middle" font-size="10" font-weight="800" fill="rgba(2,6,23,.9)">B</text>
            </g>

            <g>
              <circle cx="260" cy="95" r="10" fill="rgba(255,255,255,.85)"/>
              <text x="260" y="99" text-anchor="middle" font-size="10" font-weight="800" fill="rgba(2,6,23,.9)">D</text>
            </g>

            <text x="15" y="160" fill="rgba(255,255,255,.65)" font-size="12">Graph paths = legal reasoning options</text>
          </g>
        </svg>
      </div>

      <div class="legend">
        <span class="chip"><span class="dot" style="background:rgba(125,211,252,.9)"></span><span data-i18n="leg1">Lower bound ring</span></span>
        <span class="chip"><span class="dot" style="background:rgba(214,178,94,.9)"></span><span data-i18n="leg2">Upper bound ring</span></span>
        <span class="chip"><span class="dot" style="background:rgba(52,211,153,.9)"></span><span data-i18n="leg3">Converging decision</span></span>
      </div>

      <details class="note">
        <summary data-i18n="settingsTitle">Translation settings (for “All languages”)</summary>
        <div class="row" style="margin-top:10px">
          <label class="small muted" style="min-width:140px" data-i18n="endpointLabel">Translate endpoint</label>
          <input id="endpoint" class="mono" style="flex:1" value="https://libretranslate.com/translate"/>
        </div>
        <div class="row" style="margin-top:10px">
          <label class="small muted" style="min-width:140px" data-i18n="apikeyLabel">API key (optional)</label>
          <input id="apikey" class="mono" style="flex:1" placeholder="(empty)"/>
        </div>
        <p class="small muted" data-i18n="settingsHint" style="margin-top:10px">
          If the public endpoint fails, self-host LibreTranslate and paste your URL here.
        </p>
      </details>
    </aside>
  </div>

  <section class="card" style="margin-top:16px">
    <h2 data-i18n="stepsTitle">Step-by-step model (with equations)</h2>
    <p class="muted" data-i18n="stepsSubtitle">Each step is short. Expand details to see the math and how it connects to the “sandwich” idea.</p>

    <div class="steps">

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">1</div>
            <div>
              <h3 data-i18n="s1t">Represent each country’s economic-legal rule space</h3>
              <div class="muted small" data-i18n="s1d">Build the set of relevant laws, treaties, constraints, precedents.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--accent)"></span><span data-i18n="tagModel">Model</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show math & explanation</summary>
          <p data-i18n="s1p1">
            Let countries be \(c \in \mathcal{C}\). For each country define a set of laws \(\mathcal{L}_c=\{\ell_{c,1},\ell_{c,2},\dots\}\).
            Each law is mapped into a decision-range operator for a scenario \(s\):
          </p>
          <p class="gold">
            \(R_{\ell}(s)=\big[\underline{r}_{\ell}(s),\overline{r}_{\ell}(s)\big]\)
          </p>
          <p class="muted small" data-i18n="s1p2">
            Think of \(r\) as a vector: fines, compensation, restrictions, trade limits, interest, etc.
          </p>
        </details>
      </div>

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">2</div>
            <div>
              <h3 data-i18n="s2t">Turn a dispute into scenarios (nodes) and reasoning moves (edges)</h3>
              <div class="muted small" data-i18n="s2d">Graph theory: every legal “if-then” becomes a transition.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--accent2)"></span><span data-i18n="tagGraph">Graph</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show math & explanation</summary>
          <p data-i18n="s2p1">
            Build a directed graph \(G=(V,E)\). Each node \(s\in V\) is a scenario/state (facts + classification),
            and edges \(E\) are allowed reasoning steps.
          </p>
          <p class="gold">
            \(p:\ s_{start}\rightarrow s_2\rightarrow \dots \rightarrow s_{end}\)
          </p>
          <p class="muted small" data-i18n="s2p2">
            Each path \(p\) is one coherent legal storyline from start to decision.
          </p>
        </details>
      </div>

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">3</div>
            <div>
              <h3 data-i18n="s3t">Build the “sandwich” bounds for each scenario</h3>
              <div class="muted small" data-i18n="s3d">Two concentric circles: lower bound and upper bound.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--gold)"></span><span data-i18n="tagBounds">Bounds</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show math & explanation</summary>
          <p data-i18n="s3p1">
            After selecting the relevant laws for the scenario, aggregate them into a single lower and upper bound:
          </p>
          <p class="gold">
            \(\underline{R}(s)=\mathcal{A}\big(\{\underline{r}_{\ell}(s)\}_{\ell}\big),\quad
              \overline{R}(s)=\mathcal{A}\big(\{\overline{r}_{\ell}(s)\}_{\ell}\big)\)
          </p>
          <p data-i18n="s3p2">
            The final decision \(r(s)\) must satisfy:
          </p>
          <p class="gold">
            \(\underline{R}(s)\le r(s)\le \overline{R}(s)\)
          </p>
          <p class="muted small" data-i18n="s3p3">
            This is the “sandwich”: the decision is always trapped between two legal slices.
          </p>
        </details>
      </div>

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">4</div>
            <div>
              <h3 data-i18n="s4t">Integrate laws across countries (international layer)</h3>
              <div class="muted small" data-i18n="s4d">Find what is jointly permitted, or use weighted blending.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--ok)"></span><span data-i18n="tagIntegrate">Integrate</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show math & explanation</summary>
          <p data-i18n="s4p1">
            For a dispute involving countries \(C_s\subseteq\mathcal{C}\), the joint law-space is:
          </p>
          <p class="gold">
            \(\mathcal{L}_{joint}=\bigcup_{c\in C_s}\mathcal{L}_c\)
          </p>
          <p data-i18n="s4p2">
            Conservative integration uses intersection:
          </p>
          <p class="gold">
            \(R_{joint}(s)=\bigcap_{\ell\in\mathcal{L}_{joint}} R_{\ell}(s)\)
          </p>
          <p data-i18n="s4p3">
            Alternatively, a weighted blend:
          </p>
          <p class="gold">
            \(R_{joint}(s)=\Big[\sum w_{\ell}\underline{r}_{\ell}(s),\ \sum w_{\ell}\overline{r}_{\ell}(s)\Big],\quad \sum w_\ell=1\)
          </p>
        </details>
      </div>

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">5</div>
            <div>
              <h3 data-i18n="s5t">Score paths and choose the “tastiest sandwich”</h3>
              <div class="muted small" data-i18n="s5d">Optimization over paths: fairness, stability, clarity, time, risk.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--warn)"></span><span data-i18n="tagOptimize">Optimize</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show math & explanation</summary>
          <p data-i18n="s5p1">
            Define a utility function for a path \(p\):
          </p>
          <p class="gold">
            \(U(p)=\alpha\cdot Fairness(p)-\beta\cdot Contradictions(p)-\gamma\cdot Time(p)-\delta\cdot Risk(p)\)
          </p>
          <p data-i18n="s5p2">
            Choose the best path:
          </p>
          <p class="gold">
            \(p^\*=\arg\max_{p\in\mathcal{P}} U(p)\)
          </p>
        </details>
      </div>

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">6</div>
            <div>
              <h3 data-i18n="s6t">Optional: transparent weighted lottery over legal space</h3>
              <div class="muted small" data-i18n="s6d">Reduces capture and manipulation while favoring quality paths.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--bad)"></span><span data-i18n="tagLottery">Lottery</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show math & explanation</summary>
          <p data-i18n="s6p1">
            Instead of always picking \(p^\*\), sample \(p\) with:
          </p>
          <p class="gold">
            \(\Pr(p)\propto \exp\big(-\lambda\cdot Cost(p)\big)\)
          </p>
          <p class="muted small" data-i18n="s6p2">
            Because the rule is public, everyone can verify the randomness and weights.
          </p>
        </details>
      </div>

      <div class="step">
        <div class="step-head">
          <div class="step-title">
            <div class="num">7</div>
            <div>
              <h3 data-i18n="s7t">Record the decision as an auditable event (precedent memory)</h3>
              <div class="muted small" data-i18n="s7d">A public log: which laws, which bounds, which path, and why.</div>
            </div>
          </div>
          <span class="chip"><span class="dot" style="background:var(--ok)"></span><span data-i18n="tagAudit">Audit</span></span>
        </div>

        <details>
          <summary data-i18n="showMath">Show structure</summary>
          <p class="muted small" data-i18n="s7p1">
            Store: scenario id, countries, laws used, lower/upper bounds, chosen path, chosen decision, and explanatory notes.
            This creates transparency, reproducibility, and learning.
          </p>
        </details>
      </div>

    </div>
  </section>

  <section class="card" style="margin-top:16px">
    <h2 data-i18n="demoTitle">Tiny demo (conceptual)</h2>
    <p class="muted" data-i18n="demoSubtitle">A toy example showing how the sandwich bounds appear and how paths compete.</p>
    <div class="svgwrap">
      <svg viewBox="0 0 980 260" width="100%" height="auto" role="img" aria-label="Toy decision graph">
        <defs>
          <filter id="glow2" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="3" result="b"/>
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>

        <!-- nodes -->
        <g font-family="Inter, system-ui, sans-serif">
          <g transform="translate(70,130)">
            <circle r="22" fill="rgba(255,255,255,.88)" filter="url(#glow2)"/>
            <text y="6" text-anchor="middle" font-weight="800" fill="rgba(2,6,23,.9)">S</text>
            <text y="44" text-anchor="middle" font-size="12" fill="rgba(255,255,255,.7)">Start</text>
          </g>

          <g transform="translate(290,70)">
            <circle r="20" fill="rgba(255,255,255,.88)"/>
            <text y="6" text-anchor="middle" font-weight="800" fill="rgba(2,6,23,.9)">A</text>
            <text y="42" text-anchor="middle" font-size="12" fill="rgba(255,255,255,.7)">Treaty route</text>
          </g>

          <g transform="translate(290,190)">
            <circle r="20" fill="rgba(255,255,255,.88)"/>
            <text y="6" text-anchor="middle" font-weight="800" fill="rgba(2,6,23,.9)">B</text>
            <text y="42" text-anchor="middle" font-size="12" fill="rgba(255,255,255,.7)">Domestic route</text>
          </g>

          <g transform="translate(520,130)">
            <circle r="20" fill="rgba(255,255,255,.88)"/>
            <text y="6" text-anchor="middle" font-weight="800" fill="rgba(2,6,23,.9)">C</text>
            <text y="42" text-anchor="middle" font-size="12" fill="rgba(255,255,255,.7)">Hybrid</text>
          </g>

          <g transform="translate(760,130)">
            <circle r="22" fill="rgba(255,255,255,.88)" filter="url(#glow2)"/>
            <text y="6" text-anchor="middle" font-weight="800" fill="rgba(2,6,23,.9)">D</text>
            <text y="44" text-anchor="middle" font-size="12" fill="rgba(255,255,255,.7)">Decision</text>
          </g>

          <!-- edges -->
          <path d="M92,130 C170,130 200,80 270,72" stroke="rgba(167,139,250,.75)" stroke-width="3" fill="none"/>
          <path d="M92,130 C170,130 200,180 270,188" stroke="rgba(125,211,252,.75)" stroke-width="3" fill="none"/>
          <path d="M310,70 C400,70 430,130 500,130" stroke="rgba(52,211,153,.75)" stroke-width="3" fill="none"/>
          <path d="M310,190 C400,190 430,130 500,130" stroke="rgba(52,211,153,.75)" stroke-width="3" fill="none"/>
          <path d="M540,130 C620,130 650,130 738,130" stroke="rgba(214,178,94,.75)" stroke-width="3" fill="none"/>

          <!-- sandwich rings near Decision -->
          <g transform="translate(860,130)">
            <circle r="54" fill="rgba(214,178,94,.08)" stroke="rgba(214,178,94,.55)" stroke-width="2"/>
            <circle r="32" fill="rgba(125,211,252,.08)" stroke="rgba(125,211,252,.55)" stroke-width="2"/>
            <text y="-62" text-anchor="middle" font-size="11" fill="rgba(214,178,94,.95)" font-weight="800">Upper</text>
            <text y="-38" text-anchor="middle" font-size="11" fill="rgba(125,211,252,.95)" font-weight="800">Lower</text>
            <text y="6" text-anchor="middle" font-size="11" fill="rgba(255,255,255,.7)" font-weight="700">Sandwich</text>
          </g>
        </g>
      </svg>
    </div>

    <p class="small muted" data-i18n="demoNote" style="margin-top:10px">
      In real systems, nodes represent legal classifications and factual findings; edges represent allowed reasoning transitions.
      Each node (and each whole path) carries bounds — then we optimize or lottery-sample within those bounds.
    </p>
  </section>

  <footer class="card" style="margin-top:16px">
    <div class="row" style="justify-content:space-between">
      <span class="muted small" data-i18n="footerLeft">Single-file HTML • Works offline for reading (translation requires internet)</span>
      <span class="muted small">© Concept model</span>
    </div>
  </footer>

</div>

<div class="toast" id="toast"></div>

<script>
/* ---------------------------
   1) Language list (wide)
   --------------------------- */
const LANGS = [
  // A broad ISO-639-1 list (most common); the translator can still target many more codes (ISO-639-3) if your endpoint supports it.
  // We keep this list practical & searchable. You can manually type a code too by editing the selection field value in DevTools.
  {code:"auto", name:"Auto-detect"},
  {code:"en", name:"English"},
  {code:"he", name:"עברית (Hebrew)"},
  {code:"ar", name:"العربية (Arabic)"},
  {code:"de", name:"Deutsch (German)"},
  {code:"fr", name:"Français (French)"},
  {code:"es", name:"Español (Spanish)"},
  {code:"it", name:"Italiano (Italian)"},
  {code:"pt", name:"Português (Portuguese)"},
  {code:"ru", name:"Русский (Russian)"},
  {code:"uk", name:"Українська (Ukrainian)"},
  {code:"pl", name:"Polski (Polish)"},
  {code:"nl", name:"Nederlands (Dutch)"},
  {code:"sv", name:"Svenska (Swedish)"},
  {code:"no", name:"Norsk (Norwegian)"},
  {code:"da", name:"Dansk (Danish)"},
  {code:"fi", name:"Suomi (Finnish)"},
  {code:"cs", name:"Čeština (Czech)"},
  {code:"sk", name:"Slovenčina (Slovak)"},
  {code:"hu", name:"Magyar (Hungarian)"},
  {code:"ro", name:"Română (Romanian)"},
  {code:"bg", name:"Български (Bulgarian)"},
  {code:"el", name:"Ελληνικά (Greek)"},
  {code:"tr", name:"Türkçe (Turkish)"},
  {code:"fa", name:"فارسی (Persian)"},
  {code:"ur", name:"اردو (Urdu)"},
  {code:"hi", name:"हिन्दी (Hindi)"},
  {code:"bn", name:"বাংলা (Bengali)"},
  {code:"ta", name:"தமிழ் (Tamil)"},
  {code:"te", name:"తెలుగు (Telugu)"},
  {code:"mr", name:"मराठी (Marathi)"},
  {code:"gu", name:"ગુજરાતી (Gujarati)"},
  {code:"pa", name:"ਪੰਜਾਬੀ (Punjabi)"},
  {code:"kn", name:"ಕನ್ನಡ (Kannada)"},
  {code:"ml", name:"മലയാളം (Malayalam)"},
  {code:"th", name:"ไทย (Thai)"},
  {code:"vi", name:"Tiếng Việt (Vietnamese)"},
  {code:"id", name:"Bahasa Indonesia"},
  {code:"ms", name:"Bahasa Melayu (Malay)"},
  {code:"tl", name:"Filipino (Tagalog)"},
  {code:"zh", name:"中文 (Chinese)"},
  {code:"ja", name:"日本語 (Japanese)"},
  {code:"ko", name:"한국어 (Korean)"},
  {code:"am", name:"አማርኛ (Amharic)"},
  {code:"sw", name:"Kiswahili (Swahili)"},
  {code:"zu", name:"isiZulu (Zulu)"},
  {code:"af", name:"Afrikaans"},
  {code:"is", name:"Íslenska (Icelandic)"},
  {code:"ga", name:"Gaeilge (Irish)"},
  {code:"cy", name:"Cymraeg (Welsh)"},
  {code:"la", name:"Latina (Latin)"},
  {code:"yi", name:"ייִדיש (Yiddish)"},
  {code:"eo", name:"Esperanto"},
  {code:"sr", name:"Српски (Serbian)"},
  {code:"hr", name:"Hrvatski (Croatian)"},
  {code:"sl", name:"Slovenščina (Slovene)"},
  {code:"lt", name:"Lietuvių (Lithuanian)"},
  {code:"lv", name:"Latviešu (Latvian)"},
  {code:"et", name:"Eesti (Estonian)"},
  {code:"az", name:"Azərbaycan (Azerbaijani)"},
  {code:"ka", name:"ქართული (Georgian)"},
  {code:"hy", name:"Հայերեն (Armenian)"},
  {code:"kk", name:"Қазақша (Kazakh)"},
  {code:"uz", name:"Oʻzbek (Uzbek)"},
  {code:"mn", name:"Монгол (Mongolian)"},
  {code:"ne", name:"नेपाली (Nepali)"},
  {code:"si", name:"සිංහල (Sinhala)"},
  {code:"km", name:"ខ្មែរ (Khmer)"},
  {code:"lo", name:"ລາວ (Lao)"},
  {code:"my", name:"မြန်မာ (Burmese)"},
  {code:"sq", name:"Shqip (Albanian)"},
  {code:"mk", name:"Македонски (Macedonian)"},
  {code:"bs", name:"Bosanski (Bosnian)"},
  {code:"mt", name:"Malti (Maltese)"},
  {code:"lb", name:"Lëtzebuergesch (Luxembourgish)"},
  {code:"eu", name:"Euskara (Basque)"},
  {code:"ca", name:"Català (Catalan)"},
  {code:"gl", name:"Galego (Galician)"},
  {code:"bn", name:"বাংলা (Bengali)"},
  {code:"yo", name:"Yorùbá (Yoruba)"},
  {code:"ig", name:"Igbo"},
  {code:"ha", name:"Hausa"},
  {code:"ps", name:"پښتو (Pashto)"},
  {code:"sd", name:"سنڌي (Sindhi)"},
  {code:"ckb", name:"کوردیی ناوەندی (Central Kurdish)"},
];

/* ---------------------------
   2) i18n source capture
   --------------------------- */
const SOURCE = {}; // key -> English
const nodes = document.querySelectorAll("[data-i18n]");
nodes.forEach(el=>{
  const k = el.getAttribute("data-i18n");
  SOURCE[k] = el.innerHTML.trim();
});

// placeholders
document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
  const k = el.getAttribute("data-i18n-placeholder");
  SOURCE["__ph__"+k] = el.getAttribute("placeholder") || "";
});

/* ---------------------------
   3) UI helpers
   --------------------------- */
const toastEl = document.getElementById("toast");
function toast(msg){
  toastEl.textContent = msg;
  toastEl.style.display = "block";
  clearTimeout(toastEl._t);
  toastEl._t = setTimeout(()=>toastEl.style.display="none", 4200);
}

function setDirForLang(lang){
  // RTL languages
  const rtl = new Set(["ar","he","fa","ur","ps","sd","ckb"]);
  document.documentElement.setAttribute("dir", rtl.has(lang) ? "rtl" : "ltr");
  document.documentElement.setAttribute("lang", lang === "auto" ? "en" : lang);
}

/* ---------------------------
   4) Populate language dropdown + search
   --------------------------- */
const langSelect = document.getElementById("langSelect");
const langSearch = document.getElementById("langSearch");

function renderLangOptions(filter=""){
  langSelect.innerHTML = "";
  const f = filter.trim().toLowerCase();
  const items = LANGS.filter(x => !f || (x.name.toLowerCase().includes(f) || x.code.toLowerCase().includes(f)));
  items.forEach(x=>{
    const opt = document.createElement("option");
    opt.value = x.code;
    opt.textContent = `${x.name}  —  [${x.code}]`;
    langSelect.appendChild(opt);
  });
  // keep selection if possible
  const saved = localStorage.getItem("lang") || "en";
  const found = [...langSelect.options].find(o=>o.value===saved);
  if(found) langSelect.value = saved;
}
renderLangOptions();
langSearch.addEventListener("input", ()=>renderLangOptions(langSearch.value));

/* ---------------------------
   5) Theme toggle
   --------------------------- */
const themeBtn = document.getElementById("themeBtn");
function applyTheme(t){
  document.documentElement.setAttribute("data-theme", t);
  localStorage.setItem("theme", t);
}
applyTheme(localStorage.getItem("theme") || "dark");
themeBtn.addEventListener("click", ()=>{
  const t = document.documentElement.getAttribute("data-theme")==="dark" ? "light" : "dark";
  applyTheme(t);
});

/* ---------------------------
   6) Translation via LibreTranslate-compatible API
   --------------------------- */
async function translateBatch(texts, target, source="en"){
  const endpoint = document.getElementById("endpoint").value.trim();
  const api_key = document.getElementById("apikey").value.trim();
  // LibreTranslate supports q as string; for batching we call multiple requests.
  // Some endpoints support q as array; we keep safe by chunking.
  const chunkSize = 12;
  const out = [];
  for(let i=0;i<texts.length;i+=chunkSize){
    const chunk = texts.slice(i,i+chunkSize);
    // Try array first
    let body = { q: chunk, source: source, target: target, format: "html" };
    if(api_key) body.api_key = api_key;

    let res = await fetch(endpoint, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(body)
    });

    if(!res.ok){
      // fallback: single requests
      for(const t of chunk){
        const b2 = { q: t, source: source, target: target, format:"html" };
        if(api_key) b2.api_key = api_key;
        const r2 = await fetch(endpoint, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(b2)
        });
        if(!r2.ok) throw new Error("Translation endpoint rejected the request (CORS/rate limit/invalid URL).");
        const j2 = await r2.json();
        out.push(j2.translatedText || j2.translation || "");
      }
      continue;
    }

    const j = await res.json();
    // LibreTranslate sometimes returns { translatedText: "..." } for single,
    // or [{translatedText:"..."}, ...] / {translations:[...]} for batch.
    if(Array.isArray(j)){
      j.forEach(o=>out.push(o.translatedText || o.translation || ""));
    }else if(Array.isArray(j.translations)){
      j.translations.forEach(o=>out.push(o.translatedText || o.translation || ""));
    }else if(typeof j.translatedText === "string"){
      // single text
      out.push(j.translatedText);
    }else{
      // best effort
      out.push("");
    }
  }
  return out;
}

async function applyTranslation(target){
  if(target === "en"){
    resetToEnglish();
    setDirForLang("en");
    toast("Reset to English.");
    return;
  }

  // collect keys
  const keys = Object.keys(SOURCE).filter(k=>!k.startsWith("__ph__"));
  const placeholders = Object.keys(SOURCE).filter(k=>k.startsWith("__ph__"));
  const texts = keys.map(k=>SOURCE[k]);
  const phTexts = placeholders.map(k=>SOURCE[k]);

  toast("Translating… (requires internet + a working endpoint)");
  const translated = await translateBatch(texts, target, "en");
  const translatedPH = placeholders.length ? await translateBatch(phTexts, target, "en") : [];

  // apply to elements
  keys.forEach((k, idx)=>{
    const el = document.querySelector(`[data-i18n="${CSS.escape(k)}"]`);
    if(el) el.innerHTML = translated[idx] || SOURCE[k];
  });
  placeholders.forEach((k, idx)=>{
    const phKey = k.replace("__ph__","");
    const el = document.querySelector(`[data-i18n-placeholder="${CSS.escape(phKey)}"]`);
    if(el) el.setAttribute("placeholder", translatedPH[idx] || SOURCE[k]);
  });

  setDirForLang(target);

  // re-typeset math
  if(window.MathJax && window.MathJax.typesetPromise){
    await window.MathJax.typesetPromise();
  }
  toast("Done.");
}

function resetToEnglish(){
  Object.keys(SOURCE).forEach(k=>{
    if(k.startsWith("__ph__")) return;
    const el = document.querySelector(`[data-i18n="${CSS.escape(k)}"]`);
    if(el) el.innerHTML = SOURCE[k];
  });
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
    const k = el.getAttribute("data-i18n-placeholder");
    el.setAttribute("placeholder", SOURCE["__ph__"+k] || "");
  });
  if(window.MathJax && window.MathJax.typesetPromise){
    window.MathJax.typesetPromise();
  }
}

/* ---------------------------
   7) Buttons
   --------------------------- */
document.getElementById("translateBtn").addEventListener("click", async ()=>{
  const target = langSelect.value;
  localStorage.setItem("lang", target);
  try{
    await applyTranslation(target);
  }catch(err){
    console.error(err);
    toast("Translation failed. Try another endpoint (self-host LibreTranslate) or check CORS/rate limits.");
  }
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  langSelect.value = "en";
  localStorage.setItem("lang", "en");
  resetToEnglish();
  setDirForLang("en");
  toast("Reset.");
});

// Apply saved language (without auto-translate at load to avoid rate limits)
setDirForLang(localStorage.getItem("lang") || "en");
</script>

</body>
</html>
