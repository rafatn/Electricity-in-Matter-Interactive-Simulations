<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>×ª××•×¨×” ×‘×‘×™×ª ×œ×œ× ××¤×¡×™×§×™× â€” ×”×¦×‘×¢×” + ×‘×™×•××˜×¨×™×” (×“×£ ××¢×¨×›×ª)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --link:#2563eb;
      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow:0 10px 24px rgba(0,0,0,.08);
      --r:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
    }
    header{
      padding:22px 18px 10px;
      max-width:1100px;
      margin:0 auto;
    }
    .title{
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
    }
    .top-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    button, select, input[type="text"], input[type="range"]{
      font:inherit;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 2px 10px rgba(0,0,0,.04);
      transition:transform .05s ease, box-shadow .2s ease;
      user-select:none;
    }
    .btn:hover{ box-shadow:0 10px 18px rgba(0,0,0,.08); }
    .btn:active{ transform:translateY(1px); }
    .btn.primary{
      background:var(--link);
      color:#fff;
      border-color:transparent;
    }
    .btn.danger{
      background:#fff;
      color:var(--bad);
      border-color:rgba(239,68,68,.35);
    }
    main{
      max-width:1100px;
      margin:0 auto;
      padding:0 18px 28px;
    }
    .grid{
      display:grid;
      grid-template-columns:1.15fr .85fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:17px;
    }
    .card h3{
      margin:14px 0 8px;
      font-size:14px;
      color:#0f172a;
    }
    .muted{ color:var(--muted); }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      font-size:12px;
      user-select:none;
    }
    .pill.ok{ border-color:rgba(22,163,74,.25); }
    .pill.warn{ border-color:rgba(245,158,11,.25); }
    .pill.bad{ border-color:rgba(239,68,68,.25); }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .hr{
      height:1px;
      background:var(--line);
      margin:12px 0;
    }
    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .tab{
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .tab[aria-selected="true"]{
      border-color:rgba(37,99,235,.35);
      box-shadow:0 12px 20px rgba(37,99,235,.12);
    }
    .panel{ display:none; margin-top:12px; }
    .panel.active{ display:block; }
    .kpi{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
    }
    @media (max-width:700px){
      .kpi{ grid-template-columns:1fr; }
    }
    .kpi .box{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:#fff;
    }
    .kpi .box .v{ font-weight:700; font-size:14px; }
    .kpi .box .l{ color:var(--muted); font-size:12px; margin-top:4px; }
    .mono{
      font-family:var(--mono);
      font-size:12.5px;
      background:#0b1220;
      color:#e5e7eb;
      padding:12px;
      border-radius:14px;
      overflow:auto;
      border:1px solid rgba(255,255,255,.08);
    }
    .note{
      border:1px dashed rgba(37,99,235,.35);
      background:rgba(37,99,235,.05);
      padding:10px;
      border-radius:14px;
    }
    .warnbox{
      border:1px dashed rgba(245,158,11,.5);
      background:rgba(245,158,11,.08);
      padding:10px;
      border-radius:14px;
    }
    .badbox{
      border:1px dashed rgba(239,68,68,.5);
      background:rgba(239,68,68,.07);
      padding:10px;
      border-radius:14px;
    }
    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      text-align:right;
      vertical-align:top;
      font-size:13px;
    }
    .table th{
      background:#0f172a;
      color:#fff;
      font-size:13px;
    }
    .table tr:last-child td{ border-bottom:none; }
    .small{ font-size:12px; }
    a{ color:var(--link); text-decoration:none; font-weight:700; }
    a:hover{ text-decoration:underline; }

    /* Diagram */
    .diagramWrap{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:10px;
      overflow:auto;
    }
    svg{ max-width:100%; height:auto; }
    .legend{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    /* Controls */
    .control{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width:700px){
      .control{ grid-template-columns:1fr; }
    }
    label{
      display:block;
      font-weight:700;
      margin-bottom:6px;
      font-size:12px;
      color:#0f172a;
    }
    .field{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:#fff;
    }
    select, input[type="text"]{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      background:#fff;
      outline:none;
    }
    input[type="range"]{ width:100%; }
    .statusLine{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid var(--line);
    }
    .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      user-select:none;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .tag.ok{ border-color:rgba(22,163,74,.35); color:#064e3b; }
    .tag.warn{ border-color:rgba(245,158,11,.45); color:#7c2d12; }
    .tag.bad{ border-color:rgba(239,68,68,.45); color:#7f1d1d; }

    /* "Soft lock" (optional) */
    .lockOverlay{
      position:fixed;
      inset:0;
      display:none;
      background:rgba(17,24,39,.75);
      backdrop-filter: blur(8px);
      z-index:9999;
      color:#fff;
      padding:20px;
      align-items:center;
      justify-content:center;
      text-align:center;
    }
    .lockOverlay .box{
      max-width:620px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.18);
      border-radius:18px;
      padding:16px;
    }
    .lockOverlay input{
      margin-top:10px;
      width:100%;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.25);
      padding:10px;
      background:rgba(0,0,0,.18);
      color:#fff;
      outline:none;
    }
    .lockOverlay .row{
      justify-content:center;
      margin-top:10px;
    }

    /* Print note */
    @media print{
      body{ filter:grayscale(1); }
      .noPrint{ display:none !important; }
    }
  </style>
</head>
<body>

<header>
  <div class="title">
    <div>
      <h1>×ª××•×¨×” ×œ×œ× ××¤×¡×™×§×™×: ×”×¦×‘×¢×” ×¢×œ × ×¨/×’×•×£ ×ª××•×¨×” + ××™××•×ª ×‘×™×•××˜×¨×™</h1>
      <div class="subtitle">×“×£ ××¢×¨×›×ª (××¤×¨×˜ + ×ª×¨×©×™× + ×¡×™××•×œ×¦×™×” ×§×˜× ×” + BOM + ××œ×’×•×¨×™×ª×). ×”×›×œ ××§×•××™ (×œ×œ× ×¢× ×Ÿ) ×›×§×• ×× ×—×”.</div>
    </div>

    <div class="top-actions noPrint">
      <button class="btn" id="btnToggleLock">ğŸ”’ ××¦×‘ × ×¢×™×œ×” (××•×¤×¦×™×•× ×œ×™)</button>
      <button class="btn" id="btnExport">ğŸ“„ ×”×¢×ª×§ ×¡×™×›×•× ×œ××§×œ×“×ª</button>
      <button class="btn primary" id="btnReset">â†º ××™×¤×•×¡ ×‘×—×™×¨×•×ª</button>
    </div>
  </div>

  <div class="tabs noPrint" role="tablist" aria-label="Sections">
    <div class="tab" role="tab" tabindex="0" aria-selected="true" data-tab="overview">×¡×§×™×¨×”</div>
    <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="architecture">××¨×›×™×˜×§×˜×•×¨×”</div>
    <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="prototype">×¤×¨×•×˜×•×˜×™×™×¤</div>
    <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="security">××‘×˜×—×”</div>
    <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="code">××œ×’×•×¨×™×ª× ×•×§×•×“</div>
  </div>
</header>

<main>
  <div class="grid">
    <!-- LEFT -->
    <section class="card">
      <div id="panel-overview" class="panel active" role="tabpanel" aria-label="overview">
        <h2>××” ×”××¢×¨×›×ª ×¢×•×©×” ×‘×¤×•×¢×œ</h2>

        <div class="kpi">
          <div class="box">
            <div class="v">×œ×œ× ××’×¢</div>
            <div class="l">×”×“×œ×§×”/×›×™×‘×•×™ ×‘×”×¦×‘×¢×” + ××™××•×ª ×‘×™×•××˜×¨×™</div>
          </div>
          <div class="box">
            <div class="v">×–××Ÿ ×ª×’×•×‘×” ×™×¢×“</div>
            <div class="l">~0.3â€“1.0 ×©× ×™×•×ª (×ª×œ×•×™ ×—×™×™×©× ×™×)</div>
          </div>
          <div class="box">
            <div class="v">×¤×¨×˜×™×•×ª</div>
            <div class="l">×¢×™×‘×•×“ ××§×•××™ + ×ª×‘× ×™×•×ª ××•×¦×¤× ×•×ª</div>
          </div>
        </div>

        <div class="hr"></div>

        <h3>×©×¨×©×¨×ª ×¤×¢×•×œ×” (Flow)</h3>
        <div class="diagramWrap" aria-label="flow diagram">
          <svg viewBox="0 0 980 250" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <filter id="sh" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="5" stdDeviation="6" flood-color="#000" flood-opacity=".12"/>
              </filter>
              <style>
                .n{fill:#fff;stroke:#e5e7eb;stroke-width:2;rx:16;filter:url(#sh)}
                .t{font-family:Arial,sans-serif;font-size:16px;fill:#111827}
                .s{font-family:Arial,sans-serif;font-size:12px;fill:#6b7280}
                .a{stroke:#94a3b8;stroke-width:2;marker-end:url(#m)}
              </style>
              <marker id="m" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"></path>
              </marker>
            </defs>

            <!-- nodes -->
            <rect class="n" x="20" y="60" width="180" height="120"></rect>
            <text class="t" x="110" y="105" text-anchor="middle">1) ×”×¦×‘×¢×”</text>
            <text class="s" x="110" y="128" text-anchor="middle">×–×™×”×•×™ ×›×™×•×•×Ÿ/××—×•×•×”</text>
            <text class="s" x="110" y="148" text-anchor="middle">××™×–×” × ×¨ × ×‘×—×¨</text>

            <rect class="n" x="220" y="60" width="220" height="120"></rect>
            <text class="t" x="330" y="105" text-anchor="middle">2) ×‘×™×•××˜×¨×™×”</text>
            <text class="s" x="330" y="128" text-anchor="middle">×˜×‘×™×¢×ª ××¦×‘×¢ / ×•×¨×™×“×™× / ×—×•×</text>
            <text class="s" x="330" y="148" text-anchor="middle">×œ×œ× ××’×¢</text>

            <rect class="n" x="460" y="60" width="220" height="120"></rect>
            <text class="t" x="570" y="105" text-anchor="middle">3) ××™××•×ª</text>
            <text class="s" x="570" y="128" text-anchor="middle">×”×©×•×•××” ×œ×ª×‘× ×™×ª ××•×¦×¤× ×ª</text>
            <text class="s" x="570" y="148" text-anchor="middle">×”×¨×©××•×ª ×œ×¤×™ ××©×ª××©</text>

            <rect class="n" x="700" y="60" width="260" height="120"></rect>
            <text class="t" x="830" y="105" text-anchor="middle">4) ×¤×¢×•×œ×” ×¢×œ ×ª××•×¨×”</text>
            <text class="s" x="830" y="128" text-anchor="middle">ON / OFF / ×¢××¢× / ×¦×‘×¢</text>
            <text class="s" x="830" y="148" text-anchor="middle">Zigbee / Thread / Wi-Fi</text>

            <!-- arrows -->
            <line class="a" x1="200" y1="120" x2="220" y2="120"></line>
            <line class="a" x1="440" y1="120" x2="460" y2="120"></line>
            <line class="a" x1="680" y1="120" x2="700" y2="120"></line>
          </svg>

          <div class="legend">
            <span class="pill ok">âœ… ××¤×©×¨×™ ×˜×›× ×™×ª</span>
            <span class="pill warn">âš ï¸ ×ª×œ×•×™ ×‘××™×›×•×ª ×—×™×™×©× ×™× ×•×ª× ××™ ××•×¨</span>
            <span class="pill bad">â›” â€œ×× ×™×¢×ª ×¦×™×œ×•×/×”×¢×ª×§×”â€ ×œ× × ×™×ª× ×ª ×œ×”×‘×˜×—×” ××œ××” ×‘×“×¤×“×¤×Ÿ</span>
          </div>
        </div>

        <div class="hr"></div>

        <h3>3 ×ª×¦×•×¨×•×ª ××•××œ×¦×•×ª</h3>
        <table class="table">
          <thead>
            <tr>
              <th>×ª×¦×•×¨×”</th>
              <th>××˜×¨×ª ×—×™×™×©×Ÿ</th>
              <th>×™×ª×¨×•×Ÿ</th>
              <th>××’×‘×œ×”</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>A â€” ×‘×¡×™×¡×™×ª</b></td>
              <td>××—×•×•×”/×”×¦×‘×¢×” + ×–×™×”×•×™ ××©×ª××© â€œ×§×œâ€ (PIN/×˜×œ×¤×•×Ÿ)</td>
              <td>×”×›×™ ×§×œ ×œ×¤×¨×•×˜×•×˜×™×™×¤</td>
              <td>×œ× ×‘×™×•××˜×¨×™ ××œ×</td>
            </tr>
            <tr>
              <td><b>B â€” ×™×¦×™×‘×”</b></td>
              <td>×—×™×™×©×Ÿ ×¢×•××§ (ToF) + ×•×¨×™×“×™×/IR ×‘××¦×‘×¢</td>
              <td>×¢××™×“ ×™×•×ª×¨ ××–×™×•×¤×™× ×•××•×¨</td>
              <td>×—×™×™×©×Ÿ ××•×¨×›×‘ ×™×•×ª×¨</td>
            </tr>
            <tr>
              <td><b>C â€” ××ª×§×“××ª</b></td>
              <td>××¦×œ××ª ×¢×•××§ + ×‘×™×•××˜×¨×™×” ××¨×•×‘×ª-×××¤×™×™× ×™×</td>
              <td>×—×•×•×™×™×ª â€œ××¦×‘×™×¢ ×•× ×“×œ×§â€ ×”×›×™ ×˜×‘×¢×™×ª</td>
              <td>×¢×œ×•×ª/×›×™×•×œ</td>
            </tr>
          </tbody>
        </table>

        <div class="hr"></div>

        <div class="note">
          <b>×§×• ×× ×—×”:</b> ×›×“×™ ×©×–×” ×™×¢×‘×•×“ ×—×œ×§ ×‘×‘×™×ª ×××™×ª×™ â€” ××¤×¨×™×“×™× ×‘×™×Ÿ 2 ×‘×¢×™×•×ª:
          <br/>â‘  <b>Targeting</b> (×¢×œ ××™×–×” × ×¨ ×”×¦×‘×¢×ª) â‘¡ <b>Authentication</b> (××™ ××ª×”).
          ×›××©×¨ ×›×œ ××—×“ ××§×‘×œ ×—×™×™×©×Ÿ/××œ×’×•×¨×™×ª× ××ª××™×.
        </div>
      </div>

      <div id="panel-architecture" class="panel" role="tabpanel" aria-label="architecture">
        <h2>××¨×›×™×˜×§×˜×•×¨×” ××•××œ×¦×ª</h2>

        <h3>××™×§×¨×•-×©×›×‘×•×ª ××¢×¨×›×ª</h3>
        <table class="table">
          <thead>
            <tr>
              <th>×©×›×‘×”</th>
              <th>×¨×›×™×‘</th>
              <th>××” ×”×™× ×¢×•×©×”</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>×—×™×©×”</td>
              <td>ToF / IR / ××¦×œ××”</td>
              <td>××–×”×” ×™×“/××¦×‘×¢, ×›×™×•×•×Ÿ ×”×¦×‘×¢×”, ×˜×•×•×—</td>
            </tr>
            <tr>
              <td>×‘×™×•××˜×¨×™×”</td>
              <td>IR Vein / Optical FP / Thermal</td>
              <td>××™×™×¦×¨ ×—×ª×™××”/×ª×‘× ×™×ª ×•××©×•×•×” ×œ××—×¡×•×Ÿ ××§×•××™</td>
            </tr>
            <tr>
              <td>×‘×§×¨×”</td>
              <td>MCU (×œ××©×œ ESP32)</td>
              <td>×× ×”×œ ×œ×•×’×™×§×”, ×”×¨×©××•×ª, ×ª×§×©×•×¨×ª</td>
            </tr>
            <tr>
              <td>×ª××•×¨×”</td>
              <td>×“×¨×™×™×‘×¨ LED + ×××¡×¨/×“×™××¨</td>
              <td>××¤×¢×™×œ On/Off/×¢××¢×•×/×¦×‘×¢</td>
            </tr>
            <tr>
              <td>×ª×§×©×•×¨×ª</td>
              <td>Zigbee/Thread/Wi-Fi</td>
              <td>×©×•×œ×— ×¤×§×•×“×” ×œ×’×•×£ ×”×ª××•×¨×”/×’×©×¨</td>
            </tr>
          </tbody>
        </table>

        <h3>××™×¤×” ×œ×©×™× ××ª ×”×—×™×™×©× ×™×</h3>
        <div class="diagramWrap">
          <svg viewBox="0 0 980 360" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <style>
                .box{fill:#fff;stroke:#e5e7eb;stroke-width:2;rx:18}
                .lbl{font-family:Arial,sans-serif;font-size:14px;fill:#111827}
                .sub{font-family:Arial,sans-serif;font-size:12px;fill:#6b7280}
                .line{stroke:#94a3b8;stroke-width:2}
                .cone{fill:rgba(37,99,235,.12);stroke:rgba(37,99,235,.55);stroke-width:2}
              </style>
            </defs>

            <!-- room -->
            <rect x="40" y="40" width="900" height="280" fill="rgba(15,23,42,.03)" stroke="#e5e7eb" stroke-width="2" rx="18"/>
            <text class="lbl" x="70" y="75">×—×“×¨ (×“×•×’××”)</text>

            <!-- person -->
            <rect class="box" x="90" y="145" width="160" height="110"/>
            <text class="lbl" x="170" y="190" text-anchor="middle">××©×ª××©</text>
            <text class="sub" x="170" y="212" text-anchor="middle">××¦×‘×™×¢ ×¢×œ × ×¨</text>

            <!-- lamp -->
            <rect class="box" x="720" y="120" width="180" height="160"/>
            <text class="lbl" x="810" y="165" text-anchor="middle">× ×¨ / ×’×•×£ ×ª××•×¨×”</text>
            <text class="sub" x="810" y="188" text-anchor="middle">×‘×§×¨ ×ª××•×¨×” + ×ª×§×©×•×¨×ª</text>
            <text class="sub" x="810" y="210" text-anchor="middle">Zigbee/Thread/Wi-Fi</text>

            <!-- sensor near lamp -->
            <rect class="box" x="520" y="70" width="170" height="100"/>
            <text class="lbl" x="605" y="110" text-anchor="middle">××•×“×•×œ ×—×™×©×”</text>
            <text class="sub" x="605" y="132" text-anchor="middle">ToF/IR/××¦×œ××”</text>

            <!-- cone -->
            <path class="cone" d="M250,175 L520,120 L520,220 Z"/>
            <line class="line" x1="250" y1="200" x2="520" y2="170"/>
            <text class="sub" x="390" y="148" text-anchor="middle">"×§×•× ×•×¡ ×”×¦×‘×¢×”"</text>

            <!-- arrows to lamp -->
            <line class="line" x1="690" y1="140" x2="720" y2="140"/>
            <line class="line" x1="690" y1="230" x2="720" y2="230"/>
            <text class="sub" x="700" y="120">×¤×§×•×“×”</text>
          </svg>
          <div class="legend">
            <span class="pill">ğŸ’¡ ××•×¤×¦×™×” 1: ×—×™×™×©×Ÿ ×œ×™×“ ×›×œ × ×¨</span>
            <span class="pill">ğŸ  ××•×¤×¦×™×” 2: ×—×™×™×©×Ÿ ×ª×§×¨×” ××¨×›×–×™ + ××™×¤×•×™ ××™×§×•× × ×¨×•×ª</span>
            <span class="pill">ğŸ” ××•×¤×¦×™×” 3: ×‘×™×•××˜×¨×™×” ×‘× ×§×•×“×ª ×›× ×™×¡×” + ×”×¦×‘×¢×” ×‘×œ×‘×“ ×œ×™×“ × ×¨×•×ª</span>
          </div>
        </div>

        <div class="warnbox" style="margin-top:12px;">
          <b>×”××œ×¦×” ×¤×¨×§×˜×™×ª ×œ×‘×™×ª:</b> ×œ× â€œ×˜×‘×™×¢×ª ××¦×‘×¢ ×§×œ××¡×™×ª ××¨×—×•×§â€ ×‘×œ×‘×“.
          ×¢×“×™×£ ×œ×©×œ×‘ <b>×•×¨×™×“×™× ×‘××¦×‘×¢ (IR)</b> ××• <b>×¨×‘-×××¤×™×™× ×™×</b> (×•×¨×™×“×™× + ××¨×—×§ + ××—×•×•×”),
          ×›×™ ×–×” ×¢×•×‘×“ ×˜×•×‘ ×™×•×ª×¨ ×‘×ª××•×¨×” ××©×ª× ×” ×•×¤×—×•×ª ×¨×’×™×© ×œ×ª××•× ×” ××–×•×™×¤×ª.
        </div>
      </div>

      <div id="panel-prototype" class="panel" role="tabpanel" aria-label="prototype">
        <h2>××—×•×œ×œ ×¤×¨×•×˜×•×˜×™×™×¤ (×‘×—×™×¨×•×ª â†’ BOM + ×—×™×•×•×˜ + ×”×¢×¨×›×ª ×‘×™×¦×•×¢×™×)</h2>
        <div class="control noPrint">
          <div class="field">
            <label for="selTarget">×©×™×˜×ª Targeting (×¢×œ ××™×–×” × ×¨ ×”×¦×‘×¢×ª)</label>
            <select id="selTarget">
              <option value="tof">ToF/IR Distance (×—×™×™×©×Ÿ ×¢×•××§ ×§×˜×Ÿ)</option>
              <option value="depthcam">××¦×œ××ª ×¢×•××§ + ×–×™×”×•×™ ×™×“</option>
              <option value="irgrid">×’×¨×™×“ IR ×¡×‘×™×‘ ×”× ×¨ (×˜×•×•×— ×§×¦×¨)</option>
            </select>
          </div>
          <div class="field">
            <label for="selBio">×©×™×˜×ª ×‘×™×•××˜×¨×™×”</label>
            <select id="selBio">
              <option value="vein">IR Vein (×•×¨×™×“×™× ×‘××¦×‘×¢)</option>
              <option value="optfp">Optical Fingerprint ××¨×—×•×§ (×˜×•×•×— ×§×¦×¨)</option>
              <option value="thermal">×—×ª×™××ª ×—×•× + ××¨×§×</option>
              <option value="hybrid">×”×™×‘×¨×™×“×™ (×•×¨×™×“×™× + ××¨×—×§ + ××—×•×•×”)</option>
            </select>
          </div>

          <div class="field">
            <label for="selNet">×ª×§×©×•×¨×ª ×œ×‘×™×ª ×—×›×</label>
            <select id="selNet">
              <option value="zigbee">Zigbee (××•××œ×¥ ×œ×‘×™×ª ×™×¦×™×‘)</option>
              <option value="thread">Thread/Matter</option>
              <option value="wifi">Wi-Fi (×¤×©×•×˜ ×œ×¤×¨×•×˜×•×˜×™×™×¤)</option>
            </select>
          </div>

          <div class="field">
            <label for="rangeDist">××¨×—×§ ×¢×‘×•×“×” ×¨×¦×•×™ (×¡"×)</label>
            <input id="rangeDist" type="range" min="5" max="200" value="35" />
            <div class="row" style="justify-content:space-between;margin-top:6px;">
              <span class="muted small">5</span>
              <b id="distVal">35</b>
              <span class="muted small">200</span>
            </div>
          </div>

          <div class="field">
            <label for="selLight">×¡×•×’ ×©×œ×™×˜×” ×‘×ª××•×¨×”</label>
            <select id="selLight">
              <option value="relay">ON/OFF ×‘×××¦×¢×•×ª ×××¡×¨/×¨×™×œ×™×™</option>
              <option value="dimmer">×¢××¢×•× (Triac/0-10V/Driver ××ª××™×)</option>
              <option value="rgb">RGB / CCT (×¦×‘×¢/×˜××¤×¨×˜×•×¨×”)</option>
            </select>
          </div>

          <div class="field">
            <label for="txtRooms">×›××•×ª × ×¨×•×ª/×’×•×¤×™× ×‘×‘×™×ª (××¡×¤×¨)</label>
            <input id="txtRooms" type="text" inputmode="numeric" value="6" />
            <div class="muted small" style="margin-top:6px;">××©×¤×™×¢ ×¢×œ ×”×¢×¨×›×ª ×¢×œ×•×ª/××•×¨×›×‘×•×ª.</div>
          </div>
        </div>

        <div class="statusLine">
          <div class="row">
            <span class="tag" id="tagFeas">...</span>
            <span class="tag" id="tagLatency">...</span>
            <span class="tag" id="tagRisk">...</span>
          </div>
          <div class="row noPrint">
            <button class="btn" id="btnCopyBOM">×”×¢×ª×§ BOM</button>
            <button class="btn" id="btnCopyWiring">×”×¢×ª×§ ×—×™×•×•×˜</button>
          </div>
        </div>

        <div class="hr"></div>

        <h3>BOM â€” ×¨×›×™×‘×™× ××•×¦×¢×™× (×›×œ×œ×™)</h3>
        <div class="mono" id="bomOut"></div>

        <h3 style="margin-top:14px;">×—×™×•×•×˜/×—×™×‘×•×¨×™×•×ª (×¡×§×™×¦×” ×˜×§×¡×˜×•××œ×™×ª)</h3>
        <div class="mono" id="wiringOut"></div>

        <div class="hr"></div>

        <h3>×›×œ×œ×™ ×›×™×•×œ ××”×™×¨×™×</h3>
        <ul class="small">
          <li><b>×¡×£ â€œ×”×¦×‘×¢×”â€:</b> ×”×—×–×§×ª ××¦×‘×¢/×™×“ ×‘××¦×‘ ×™×¦×™×‘ 200â€“400ms ×›×“×™ ×œ×× ×•×¢ ×”×“×œ×§×•×ª ×‘×˜×¢×•×ª.</li>
          <li><b>×¨×¢×© ××•×¨:</b> ×¢×‘×•×“×” ×‘-IR ×¢× ×¤×™×œ×˜×¨ + ×”×ª×××ª ×—×©×™×¤×” (Auto exposure lock) ×‘×¢×ª ×–×™×”×•×™.</li>
          <li><b>××™××•×ª:</b> ×¢×“×™×£ 2 ×©×œ×‘×™×: â€œ××™ ××ª×”â€ + â€œ×¢×œ ××” ×”×¦×‘×¢×ªâ€.</li>
          <li><b>×¡×’×™×¨×ª ××¢×’×œ:</b> ×¤×™×“×‘×§ ×•×™×–×•××œ×™ ×§×˜×Ÿ (×œ×“ ×–×¢×™×¨) ×©××¨××” â€œ×–×•×”×™×ª/×œ× ×–×•×”×™×ªâ€.</li>
        </ul>
      </div>

      <div id="panel-security" class="panel" role="tabpanel" aria-label="security">
        <h2>××‘×˜×—×”, ×¤×¨×˜×™×•×ª, ×•×× ×˜×™-×–×™×•×£</h2>

        <h3>××™×•××™× × ×¤×•×¦×™×</h3>
        <table class="table">
          <thead>
            <tr>
              <th>××™×•×</th>
              <th>×“×•×’××”</th>
              <th>×”×’× ×” ××•××œ×¦×ª</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Replay / ×¦×™×œ×•×</td>
              <td>×ª××•× ×”/×•×™×“××• ×©×œ ××¦×‘×¢</td>
              <td>×‘×“×™×§×ª â€œ×—×™×•×ªâ€ (Liveness): IR vein/×¤×•×œ×¡/×ª× ×•×¢×” ××™×§×¨×•</td>
            </tr>
            <tr>
              <td>×–×™×•×£ ××—×•×•×”</td>
              <td>××™×©×”×• ××¦×‘×™×¢ ×‘××§×•××š</td>
              <td>×”×¨×©××•×ª ×œ×¤×™ ××©×ª××© + × ×¢×™×œ×” ×œ×¤×™ ×–××Ÿ + ×˜×•×•×— ×§×¦×¨</td>
            </tr>
            <tr>
              <td>×—×˜×™×¤×ª ×ª×§×©×•×¨×ª</td>
              <td>×¤×§×•×“×•×ª ×‘×¨×©×ª ×”×‘×™×ª×™×ª</td>
              <td>Zigbee/Thread ×¢× ××¤×ª×—×•×ª, ××• TLS ×‘-Wi-Fi</td>
            </tr>
            <tr>
              <td>×“×œ×™×¤×ª ×‘×™×•××˜×¨×™×”</td>
              <td>×©××™×¨×ª ×ª××•× ×ª ×˜×‘×™×¢×”</td>
              <td>×œ× ×œ×©××•×¨ ×ª××•× ×•×ª â€” ×¨×§ ×ª×‘× ×™×•×ª/×•×§×˜×•×¨×™× + ×”×¦×¤× ×” + salt</td>
            </tr>
          </tbody>
        </table>

        <div class="hr"></div>

        <h3>×›×œ×œ×™ ×–×”×‘ ×œ×™×™×©×•× ×‘×˜×•×—</h3>
        <div class="note">
          <ul class="small" style="margin:0; padding-inline-start:18px;">
            <li><b>×¢×™×‘×•×“ ××§×•××™:</b> ××™×Ÿ ×¦×•×¨×š ×‘×¢× ×Ÿ ×›×“×™ ×œ×”×“×œ×™×§ × ×¨.</li>
            <li><b>×ª×‘× ×™×ª ×•×œ× ×ª××•× ×”:</b> ×©××™×¨×” ×›-template (hash/embedding), ×œ× ×›-JPG ×©×œ ×˜×‘×™×¢×”.</li>
            <li><b>×—×™×•×ª (Liveness):</b> ×‘×“×™×§×ª ×©×™× ×•×™ ×§×˜×Ÿ ×‘×–××Ÿ (×ª× ×•×¢×”, ×–×¨×™××”, IR-×“×™× ××™×§×”).</li>
            <li><b>Failsafe:</b> ×ª××™×“ ×›×¤×ª×•×¨ ×—×™×¨×•×/××¤×œ×™×§×¦×™×” ×œ××§×¨×” ×ª×§×œ×”.</li>
          </ul>
        </div>

        <div class="badbox" style="margin-top:12px;">
          <b>×”×¢×¨×” ×—×©×•×‘×”:</b> ×‘×“×¤×“×¤×Ÿ ××™× ×˜×¨× ×˜ ××™ ××¤×©×¨ ×œ×”×‘×˜×™×— ×× ×™×¢×” ××•×—×œ×˜×ª ×©×œ ×¦×™×œ×•× ××¡×š/×©××™×¨×”/×”×¢×ª×§×”.
          ××¤×©×¨ ×¨×§ â€œ×œ×”×§×©×•×ªâ€ (×œ××©×œ ×—×¡×™××ª ×”×“×¤×¡×” ××• ×§×™×¦×•×¨×™ ××§×œ×“×ª), ××‘×œ ××™ ×©×¨×•×¦×” ×ª××™×“ ×™×•×›×œ ×œ×¦×œ× ××¡×š.
        </div>
      </div>

      <div id="panel-code" class="panel" role="tabpanel" aria-label="code">
        <h2>××œ×’×•×¨×™×ª× ×•×§×•×“ (×¤×¡××•×“×• + ×“×•×’×××•×ª)</h2>

        <h3>××‘× ×™ × ×ª×•× ×™× (×¨×¢×™×•×Ÿ)</h3>
        <div class="mono">
type LampID = string

UserTemplate:
  user_id: string
  bio_template: bytes        # ×œ× ×ª××•× ×” ×’×•×œ××™×ª
  perms: { onoff: bool, dim: bool, color: bool, allowed_lamps: [LampID] }

Event:
  ts: int
  pointing_vector: (x,y,z)
  target_lamp: LampID | null
  bio_score: float
  liveness_ok: bool
        </div>

        <h3>×œ×•×’×™×§×ª ×”×—×œ×˜×”</h3>
        <div class="mono" id="algoOut"></div>

        <h3>×“×•×’××” (Arduino/ESP32) â€” ×©×œ×“ ××™×¨×•×¢×™×</h3>
        <div class="mono">
/*
  ×–×” ×©×œ×“ ×›×œ×œ×™: ×§×¨×™××ª ×—×™×™×©× ×™× â†’ ×–×™×”×•×™ ×™×¢×“ â†’ ××™××•×ª â†’ ×©×œ×™×—×ª ×¤×§×•×“×”.
  ×‘×¤×•×¢×œ ×¦×¨×™×š ×œ×‘×—×•×¨ ×¡×¤×¨×™×•×ª ×œ×¤×™ ×”×—×•××¨×” (ToF/IR/×ª×§×©×•×¨×ª).
*/

void loop(){
  SensorFrame f = readSensors();

  Target t = detectTargetLamp(f);          // Targeting
  BioResult b = biometricMatch(f);         // Biometric
  bool live = livenessCheck(f);            // Anti-spoof

  if(!t.valid) return;
  if(!live)   { denyBlink(); return; }
  if(b.score < THRESH) { denyBlink(); return; }

  if(!isAllowed(b.user_id, t.lamp_id)) { denyBlink(); return; }

  // Toggle / set mode:
  sendLampCommand(t.lamp_id, CMD_TOGGLE);
  okBlink();
}
        </div>

        <h3>××™×¤×•×™ â€œ×”×¦×‘×¢×” â†’ × ×¨â€ (×¨×¢×™×•×Ÿ ×¤×©×•×˜)</h3>
        <div class="mono">
# ×× ×™×© ×—×™×™×©×Ÿ ×ª×§×¨×” ××¨×›×–×™:
# ××—×©×‘×™× ×•×§×˜×•×¨ ×”×¦×‘×¢×” ××”×™×“,
# ××—×¤×©×™× ××ª ×’×•×£ ×”×ª××•×¨×” ×”×›×™ ×§×¨×•×‘ ×œ×§×•.

for each lamp in lamps:
  d = distancePointToRay(lamp.position, hand.origin, hand.direction)
choose lamp with minimal d and d < threshold
        </div>

        <div class="warnbox" style="margin-top:12px;">
          <b>×˜×™×¤:</b> ×›×“×™ ×©×”××¢×¨×›×ª ×œ× ×ª×“×œ×™×§ ×‘×˜×¢×•×ª â€” ××—×™×™×‘×™× â€œ×™×¦×™×‘×•×ªâ€:
          ×—×™×™×‘×™× 3â€“8 ×¤×¨×™×™××™× ×¨×¦×•×¤×™× ×©××¦×‘×™×¢×™× ×¢×œ ××•×ª×• ×’×•×£ ×ª××•×¨×” ×œ×¤× ×™ ×”×¤×¢×œ×”.
        </div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <h2>××¦×‘ ××¢×¨×›×ª (×¡×™××•×œ×¦×™×” ×§×˜× ×”)</h2>
      <div class="muted small">×”×¡×™××•×œ×¦×™×” ×›××Ÿ ×”×™× ×œ×•×’×™×ª ×‘×œ×‘×“ â€” ×›×“×™ ×œ×”×‘×™×Ÿ ×”×—×œ×˜×•×ª. ×”×™× ×œ× ××—×œ×™×¤×” ×—×•××¨×” ×××™×ª×™×ª.</div>

      <div class="hr"></div>

      <div class="field noPrint">
        <label for="simPoint">××¦×‘×™×¢ ×¢×œ ×’×•×£ ×ª××•×¨×”</label>
        <select id="simPoint">
          <option value="lamp1">× ×¨ 1</option>
          <option value="lamp2">× ×¨ 2</option>
          <option value="lamp3">× ×¨ 3</option>
          <option value="none">×œ× ××¦×‘×™×¢</option>
        </select>
      </div>

      <div class="field noPrint" style="margin-top:10px;">
        <label for="simUser">××™ ×× ×¡×” ×œ×”×¤×¢×™×œ</label>
        <select id="simUser">
          <option value="owner">××©×ª××© ××•×¨×©×”</option>
          <option value="guest">××•×¨×— (××•×’×‘×œ)</option>
          <option value="unknown">×œ× ××•×›×¨</option>
        </select>
      </div>

      <div class="field noPrint" style="margin-top:10px;">
        <label for="simScore">×¦×™×•×Ÿ ×”×ª×××” ×‘×™×•××˜×¨×™×ª</label>
        <input id="simScore" type="range" min="0" max="1" step="0.01" value="0.82"/>
        <div class="row" style="justify-content:space-between;margin-top:6px;">
          <span class="muted small">0</span>
          <b id="scoreVal">0.82</b>
          <span class="muted small">1</span>
        </div>
      </div>

      <div class="field noPrint" style="margin-top:10px;">
        <label>×‘×“×™×§×ª ×—×™×•×ª (Liveness)</label>
        <div class="row">
          <label class="pill"><input type="checkbox" id="simLive" checked> ×ª×§×™×Ÿ</label>
          <label class="pill"><input type="checkbox" id="simStable" checked> ×™×¦×™×‘×•×ª ×”×¦×‘×¢×”</label>
        </div>
      </div>

      <div class="row noPrint" style="margin-top:10px;">
        <button class="btn primary" id="btnRun">â–¶ ×”×¨×¥ ×”×—×œ×˜×”</button>
        <button class="btn" id="btnDemo">âœ¨ ×ª×¨×—×™×© ×“×•×’××”</button>
      </div>

      <div class="hr"></div>

      <div class="tag" id="simDecision">××•×›×Ÿ</div>
      <div class="mono" id="simLog" style="margin-top:10px; max-height:260px;"></div>

      <div class="hr"></div>

      <h3>×”×¢×¨×•×ª ×™×™×©×•× ×œ×‘×™×ª ×××™×ª×™</h3>
      <ul class="small">
        <li>×œ×× ×™×¢×ª â€œ×”×“×œ×§×•×ª ×‘×˜×¢×•×ªâ€: ×˜×™×™××××•×˜ + ×“×¨×™×©×ª ×™×¦×™×‘×•×ª + ×˜×•×•×—.</li>
        <li>××•×¨×— ×™×›×•×œ ×œ×§×‘×œ ×”×¨×©××” ×¨×§ ×œÖ¾ON/OFF ×©×œ × ×¨×•×ª ××¡×•×™××™×.</li>
        <li>××•××œ×¥ ×œ×”×•×¡×™×£ ××¦×‘ â€œ×©×§×˜ ×œ×™×œ×”â€ ×©×œ× ××’×™×‘ ×œ×ª× ×•×¢×•×ª ××–×“×× ×•×ª.</li>
      </ul>
    </aside>
  </div>

  <div class="card" style="margin-top:14px;">
    <h2>×¡×™×›×•× ×§×¦×¨</h2>
    <div class="muted">×”××¢×¨×›×ª ×”×›×™ ××•×¦×œ×—×ª ×‘×‘×™×ª ×‘×“×¨×š ×›×œ×œ: <b>×—×™×™×©×Ÿ Targeting ×™×¦×™×‘</b> + <b>×‘×™×•××˜×¨×™×” ×¢××™×“×”</b> + <b>××™××•×ª ××§×•××™</b> + <b>×ª×§×©×•×¨×ª ×××•×‘×˜×—×ª</b>.</div>
    <div class="hr"></div>
    <div class="row">
      <span class="pill ok">âœ… ×¢×•×‘×“ ×˜×•×‘: ToF + IR Vein + Zigbee/Thread</span>
      <span class="pill warn">âš ï¸ ×“×•×¨×© ×›×™×•×œ: FP ××•×¤×˜×™ ××¨×—×•×§</span>
      <span class="pill">ğŸ’¡ ×ª××™×“ ×œ×”×©××™×¨ ×¤×ª×¨×•×Ÿ ×’×™×‘×•×™: ××¤×œ×™×§×¦×™×”/×›×¤×ª×•×¨</span>
    </div>
  </div>
</main>

<!-- Optional soft lock overlay -->
<div class="lockOverlay noPrint" id="lockOverlay" aria-hidden="true">
  <div class="box">
    <h2 style="margin:0 0 6px;">××¦×‘ × ×¢×™×œ×” (××•×¤×¦×™×•× ×œ×™)</h2>
    <div class="muted" style="color:rgba(255,255,255,.85); font-size:13px;">
      ×–×” ×¨×§ â€œ× ×¢×™×œ×” ×¨×›×”â€ ×‘×“×¤×“×¤×Ÿ ×œ×”×’×‘×œ×ª ×¦×¤×™×™×” ××–×“×× ×ª. ×œ× ×× ×’× ×•×Ÿ ××‘×˜×—×” ××•×—×œ×˜.
    </div>
    <input id="lockPass" type="text" placeholder="×”×§×œ×“ ×¡×™×¡××” ×›×“×™ ×œ×¤×ª×•×— (×‘×¨×™×¨×ª ××—×“×œ: 1234)" />
    <div class="row">
      <button class="btn primary" id="btnUnlock">×¤×ª×—</button>
      <button class="btn" id="btnCloseLock">×¡×’×•×¨</button>
    </div>
  </div>
</div>

<script>
  // --- Tabs ---
  const tabs = [...document.querySelectorAll('.tab')];
  const panels = {
    overview: document.getElementById('panel-overview'),
    architecture: document.getElementById('panel-architecture'),
    prototype: document.getElementById('panel-prototype'),
    security: document.getElementById('panel-security'),
    code: document.getElementById('panel-code'),
  };

  function setTab(name){
    tabs.forEach(t => t.setAttribute('aria-selected', String(t.dataset.tab === name)));
    Object.entries(panels).forEach(([k,el]) => el.classList.toggle('active', k === name));
  }
  tabs.forEach(t => t.addEventListener('click', () => setTab(t.dataset.tab)));
  tabs.forEach(t => t.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' || e.key === ' ') setTab(t.dataset.tab);
  }));

  // --- Prototype generator ---
  const selTarget = document.getElementById('selTarget');
  const selBio = document.getElementById('selBio');
  const selNet = document.getElementById('selNet');
  const selLight = document.getElementById('selLight');
  const rangeDist = document.getElementById('rangeDist');
  const distVal = document.getElementById('distVal');
  const txtRooms = document.getElementById('txtRooms');

  const tagFeas = document.getElementById('tagFeas');
  const tagLatency = document.getElementById('tagLatency');
  const tagRisk = document.getElementById('tagRisk');
  const bomOut = document.getElementById('bomOut');
  const wiringOut = document.getElementById('wiringOut');

  const algoOut = document.getElementById('algoOut');

  function clampInt(v, def){
    const n = parseInt(String(v).replace(/[^\d]/g,''), 10);
    return Number.isFinite(n) && n>0 ? n : def;
  }

  function gradeTag(el, kind, text){
    el.classList.remove('ok','warn','bad');
    el.classList.add(kind);
    el.textContent = text;
  }

  function estimate(){
    const target = selTarget.value;
    const bio = selBio.value;
    const net = selNet.value;
    const light = selLight.value;
    const dist = parseInt(rangeDist.value, 10);
    const lamps = clampInt(txtRooms.value, 6);

    distVal.textContent = dist;

    // Feasibility
    let feas = 'ok', feasText = 'âœ… ×™×©×™××•×ª: ×’×‘×•×”×”';
    if(bio === 'optfp' && dist > 50){ feas='warn'; feasText='âš ï¸ ×™×©×™××•×ª: ×‘×™× ×•× ×™×ª (FP ××¨×—×•×§ > 50 ×¡"× ×“×•×¨×© ××™×›×•×ª ×’×‘×•×”×”)'; }
    if(target === 'irgrid' && dist > 40){ feas='warn'; feasText='âš ï¸ ×™×©×™××•×ª: ×‘×™× ×•× ×™×ª (IR grid ××ª××™× ×œ×˜×•×•×— ×§×¦×¨)'; }
    if(bio === 'optfp' && dist > 120){ feas='bad'; feasText='â›” ×™×©×™××•×ª: × ××•×›×” (××¨×—×§ ×’×“×•×œ ××“×™ ×œ-FP ××•×¤×˜×™ ×˜×™×¤×•×¡×™)'; }
    gradeTag(tagFeas, feas, feasText);

    // Latency
    let lat = 'ok', latText = 'âš¡ ×–××Ÿ ×ª×’×•×‘×” ×™×¢×“: ~0.3â€“0.8s';
    if(target === 'depthcam'){ lat='warn'; latText = 'â±ï¸ ×–××Ÿ ×ª×’×•×‘×” ×™×¢×“: ~0.6â€“1.2s (××¦×œ××ª ×¢×•××§ + ×¢×™×‘×•×“)'; }
    if(bio === 'hybrid'){ lat='warn'; latText = 'â±ï¸ ×–××Ÿ ×ª×’×•×‘×” ×™×¢×“: ~0.5â€“1.1s (×›××” ×‘×“×™×§×•×ª)'; }
    gradeTag(tagLatency, lat, latText);

    // Risk
    let risk='ok', riskText='ğŸ›¡ï¸ ×¡×™×›×•×Ÿ ×–×™×•×£: × ××•×š';
    if(bio === 'optfp') { risk='warn'; riskText='âš ï¸ ×¡×™×›×•×Ÿ ×–×™×•×£: ×‘×™× ×•× ×™ (××•××œ×¥ Liveness ×—×–×§)'; }
    if(bio === 'vein' || bio === 'hybrid') { risk='ok'; riskText='ğŸ›¡ï¸ ×¡×™×›×•×Ÿ ×–×™×•×£: × ××•×š (IR Vein ×˜×•×‘)'; }
    if(bio === 'thermal') { risk='warn'; riskText='âš ï¸ ×¡×™×›×•×Ÿ ×–×™×•×£: ×‘×™× ×•× ×™ (×˜×•×‘ ×›×ª×•×¡×¤×ª, ×¤×—×•×ª ×œ×‘×“)'; }
    gradeTag(tagRisk, risk, riskText);

    // BOM builder
    const bom = [];
    bom.push(`BOM (×›×œ×œ×™) â€” ×¢×‘×•×¨ ~${lamps} ×’×•×¤×™ ×ª××•×¨×”`);
    bom.push(`- MCU/Broker: ESP32 (××• ×‘×§×¨ ××¨×›×–×™ + Gateways ×œ×¤×™ ×”×¦×•×¨×š)`);
    if(net === 'zigbee') bom.push(`- ×ª×§×©×•×¨×ª: ××•×“×•×œ Zigbee (××• ×’×©×¨ Zigbee ×§×™×™× ×‘×‘×™×ª)`);
    if(net === 'thread') bom.push(`- ×ª×§×©×•×¨×ª: Thread/Matter (Border Router ×× ×¦×¨×™×š)`);
    if(net === 'wifi')   bom.push(`- ×ª×§×©×•×¨×ª: Wi-Fi (×¢× TLS/××¤×ª×—×•×ª)`);
    if(target === 'tof') bom.push(`- Targeting: ×—×™×™×©×Ÿ ToF/IR (×˜×•×•×— ${dist} ×¡"×) + ×¢×™×‘×•×“ ×™×“ ×‘×¡×™×¡×™`);
    if(target === 'depthcam') bom.push(`- Targeting: ××¦×œ××ª ×¢×•××§ / IR depth + ×–×™×”×•×™ ××—×•×•×ª`);
    if(target === 'irgrid') bom.push(`- Targeting: ×’×¨×™×“ IR ×¡×‘×™×‘ ×›×œ × ×¨ (×˜×•×•×— ×§×¦×¨)`);
    if(bio === 'vein') bom.push(`- ×‘×™×•××˜×¨×™×”: IR Vein sensor (×¢×“×™×£) + ×ª××•×¨×ª IR + ×¤×™×œ×˜×¨`);
    if(bio === 'optfp') bom.push(`- ×‘×™×•××˜×¨×™×”: ××¦×œ××”/×—×™×™×©×Ÿ FP ××•×¤×˜×™ ××¨×—×•×§ + ×ª××•×¨×ª IR + ×¤×™×œ×˜×¨ (×˜×•×•×— ×§×¦×¨)`);
    if(bio === 'thermal') bom.push(`- ×‘×™×•××˜×¨×™×”: ×—×™×™×©×Ÿ ×ª×¨××™ ×§×˜×Ÿ + ×–×™×”×•×™ ×ª×‘× ×™×ª/×—×•×`);
    if(bio === 'hybrid') bom.push(`- ×‘×™×•××˜×¨×™×”: ×©×™×œ×•×‘ Vein/IR + ××¨×—×§ + ××—×•×•×” + Liveness`);
    if(light === 'relay') bom.push(`- ×©×œ×™×˜×ª ×ª××•×¨×”: ×××¡×¨/SSR ××“×•×¨×’ ×œ×¢×•××¡ + ×¡×¤×§ ×›×•×— ××ª××™×`);
    if(light === 'dimmer') bom.push(`- ×©×œ×™×˜×ª ×ª××•×¨×”: ×“×™××¨ (Triac/0-10V/Driver LED ××ª××™×) + ×‘×™×“×•×“`);
    if(light === 'rgb') bom.push(`- ×©×œ×™×˜×ª ×ª××•×¨×”: ×“×¨×™×™×‘×¨ RGB/CCT (PWM/×“×™×’×™×˜×œ×™) + ×¡×¤×§ ×›×•×—`);
    bom.push(`- ××‘×˜×—×”: ××—×¡×•×Ÿ ×ª×‘× ×™×•×ª ××•×¦×¤×Ÿ + salt + × ×™×”×•×œ ×”×¨×©××•×ª`);
    bom.push(`- ×¤×™×“×‘×§: ×œ×“ ××¦×‘/×‘××–×¨ ×¢×“×™×Ÿ (××•×¤×¦×™×•× ×œ×™)`);
    bom.push(`- ×’×™×‘×•×™: ××¤×œ×™×§×¦×™×”/×›×¤×ª×•×¨ ×—×™×¨×•×`);

    bomOut.textContent = bom.join('\n');

    // Wiring sketch
    const wire = [];
    wire.push(`×—×™×•×•×˜ (×¡×§×™×¦×” ×›×œ×œ×™×ª):`);
    wire.push(`1) ×—×™×™×©× ×™ Targeting/Bio â†’ ESP32 (I2C/SPI/UART ×œ×¤×™ ×—×™×™×©×Ÿ)`);
    wire.push(`2) ESP32 â†’ ×ª×§×©×•×¨×ª (${net.toUpperCase()}) â†’ ×‘×§×¨ ×ª××•×¨×” / ×’×©×¨ / × ×•×¨×” ×—×›××”`);
    if(light === 'relay') wire.push(`3) ESP32 â†’ GPIO â†’ ×“×¨×™×™×‘×¨ ×××¡×¨/SSR â†’ ×§×• AC/DC ×œ×’×•×£ ×”×ª××•×¨×”`);
    if(light === 'dimmer') wire.push(`3) ESP32 â†’ ×“×¨×™×™×‘×¨ Triac/0-10V â†’ ×“×¨×™×™×‘×¨ LED/×× ×•×¨×” (×‘×™×“×•×“ ×—×•×‘×”)`);
    if(light === 'rgb') wire.push(`3) ESP32 â†’ PWM/Bus â†’ ×“×¨×™×™×‘×¨ RGB/CCT â†’ LED`);
    wire.push(`4) ×¡×¤×§ ×›×•×— ×™×¦×™×‘: 5V/3.3V (×œ×¤×™ ××•×“×•×œ×™×) ×¢× ×”×’× ×•×ª ×‘×¡×™×¡×™×•×ª`);
    wire.push(`5) ×”×¦×¤× ×”/××¤×ª×—×•×ª: × ×©××¨×™× ×‘-NVS/Flash ×‘×¦×•×¨×” ××•×¦×¤× ×ª (××• ×¨×›×™×‘ Secure Element)`);
    wiringOut.textContent = wire.join('\n');

    // Algorithm text (tailored)
    const TH = (bio === 'optfp') ? 0.90 : (bio === 'thermal' ? 0.88 : 0.80);
    algoOut.textContent =
`×¡×£ ×”×ª×××” ××•××œ×¥ (×“×•×’××”): THRESH = ${TH.toFixed(2)}

Decision(event):
  if event.target_lamp == null:
      return DENY("×œ× ×–×•×”×” ×™×¢×“")
  if not event.stable_pointing:
      return DENY("×œ× ×™×¦×™×‘ â€” × ×’×“ ×”×“×œ×§×•×ª ×‘×˜×¢×•×ª")
  if not event.liveness_ok:
      return DENY("×›×©×œ ×‘×“×™×§×ª ×—×™×•×ª")
  if event.bio_score < THRESH:
      return DENY("×‘×™×•××˜×¨×™×” ×œ× ××¡×¤×§×ª")
  if not allowed(user, event.target_lamp):
      return DENY("××™×Ÿ ×”×¨×©××” ×œ× ×¨ ×”×–×”")
  return ALLOW("×‘×¦×¢ ×¤×§×•×“×”: Toggle/Dim/Color")`;
  }

  [selTarget, selBio, selNet, selLight, rangeDist, txtRooms].forEach(el=>{
    el.addEventListener('input', estimate);
    el.addEventListener('change', estimate);
  });
  estimate();

  // Copy helpers
  function copyText(txt){
    navigator.clipboard?.writeText(txt).catch(()=>{});
  }
  document.getElementById('btnCopyBOM').addEventListener('click', ()=>copyText(bomOut.textContent));
  document.getElementById('btnCopyWiring').addEventListener('click', ()=>copyText(wiringOut.textContent));

  // --- Simulation ---
  const simPoint = document.getElementById('simPoint');
  const simUser = document.getElementById('simUser');
  const simScore = document.getElementById('simScore');
  const simLive = document.getElementById('simLive');
  const simStable = document.getElementById('simStable');
  const scoreVal = document.getElementById('scoreVal');
  const simDecision = document.getElementById('simDecision');
  const simLog = document.getElementById('simLog');

  simScore.addEventListener('input', ()=>{
    scoreVal.textContent = Number(simScore.value).toFixed(2);
  });

  function simAppend(line){
    const ts = new Date().toLocaleTimeString('he-IL');
    simLog.textContent += `[${ts}] ${line}\n`;
    simLog.scrollTop = simLog.scrollHeight;
  }

  function runSim(){
    const target = simPoint.value;
    const user = simUser.value;
    const score = Number(simScore.value);
    const live = simLive.checked;
    const stable = simStable.checked;

    const TH = (selBio.value === 'optfp') ? 0.90 : (selBio.value === 'thermal' ? 0.88 : 0.80);

    simAppend(`Targeting: ${target === 'none' ? '×œ× ××¦×‘×™×¢' : target}`);
    if(target === 'none'){
      simDecision.className = 'tag bad';
      simDecision.textContent = 'â›” ×“×—×™×™×”: ×œ× ×–×•×”×” ×™×¢×“';
      simAppend('DENY: no target');
      return;
    }
    if(!stable){
      simDecision.className = 'tag warn';
      simDecision.textContent = 'âš ï¸ ×“×—×™×™×”: ×”×¦×‘×¢×” ×œ× ×™×¦×™×‘×”';
      simAppend('DENY: unstable pointing');
      return;
    }
    if(!live){
      simDecision.className = 'tag bad';
      simDecision.textContent = 'â›” ×“×—×™×™×”: ×›×©×œ ×‘×“×™×§×ª ×—×™×•×ª';
      simAppend('DENY: liveness failed');
      return;
    }
    if(user === 'unknown'){
      simDecision.className = 'tag bad';
      simDecision.textContent = 'â›” ×“×—×™×™×”: ××©×ª××© ×œ× ××•×›×¨';
      simAppend('DENY: unknown user');
      return;
    }
    simAppend(`Bio score=${score.toFixed(2)} (TH=${TH.toFixed(2)})`);
    if(score < TH){
      simDecision.className = 'tag warn';
      simDecision.textContent = 'âš ï¸ ×“×—×™×™×”: ×”×ª×××” ×‘×™×•××˜×¨×™×ª × ××•×›×”';
      simAppend('DENY: low biometric score');
      return;
    }

    // Permissions: guest allowed only lamp1 ON/OFF
    if(user === 'guest' && target !== 'lamp1'){
      simDecision.className = 'tag warn';
      simDecision.textContent = 'âš ï¸ ×“×—×™×™×”: ××™×Ÿ ×”×¨×©××” ×œ× ×¨ ×”×–×” (××•×¨×—)';
      simAppend('DENY: guest not allowed for this lamp');
      return;
    }

    simDecision.className = 'tag ok';
    simDecision.textContent = 'âœ… ××™×©×•×¨: ×©×œ×— ×¤×§×•×“×ª ×ª××•×¨×”';
    simAppend(`ALLOW: command=${selLight.value === 'relay' ? 'TOGGLE' : (selLight.value === 'dimmer' ? 'DIM' : 'RGB/CCT')}`);
  }

  document.getElementById('btnRun').addEventListener('click', runSim);
  document.getElementById('btnDemo').addEventListener('click', ()=>{
    simPoint.value='lamp1';
    simUser.value='owner';
    simScore.value='0.87';
    scoreVal.textContent='0.87';
    simLive.checked=true;
    simStable.checked=true;
    runSim();
  });

  // --- Export summary ---
  document.getElementById('btnExport').addEventListener('click', ()=>{
    const summary =
`×¡×™×›×•× ××¢×¨×›×ª ×ª××•×¨×” ×œ×œ× ××¤×¡×™×§×™× (×”×¦×‘×¢×” + ×‘×™×•××˜×¨×™×”)
×‘×—×™×¨×•×ª:
- Targeting: ${selTarget.options[selTarget.selectedIndex].text}
- ×‘×™×•××˜×¨×™×”: ${selBio.options[selBio.selectedIndex].text}
- ×ª×§×©×•×¨×ª: ${selNet.options[selNet.selectedIndex].text}
- ×©×œ×™×˜×” ×‘×ª××•×¨×”: ${selLight.options[selLight.selectedIndex].text}
- ××¨×—×§: ${rangeDist.value} ×¡"×
- ××¡×¤×¨ ×’×•×¤×™×: ${txtRooms.value}

${bomOut.textContent}

${wiringOut.textContent}

××œ×’×•×¨×™×ª×:
${algoOut.textContent}
`;
    copyText(summary);
    alert('×”×¡×™×›×•× ×”×•×¢×ª×§ ×œ××§×œ×“×ª âœ…');
  });

  // --- Reset ---
  document.getElementById('btnReset').addEventListener('click', ()=>{
    selTarget.value='tof';
    selBio.value='vein';
    selNet.value='zigbee';
    selLight.value='relay';
    rangeDist.value='35';
    txtRooms.value='6';
    distVal.textContent='35';
    estimate();
    simLog.textContent='';
    simDecision.className='tag';
    simDecision.textContent='××•×›×Ÿ';
  });

  // --- Optional lock overlay ---
  const lockOverlay = document.getElementById('lockOverlay');
  const btnToggleLock = document.getElementById('btnToggleLock');
  const btnUnlock = document.getElementById('btnUnlock');
  const btnCloseLock = document.getElementById('btnCloseLock');
  const lockPass = document.getElementById('lockPass');
  const DEFAULT_PASS = '1234';

  function openLock(){
    lockOverlay.style.display='flex';
    lockOverlay.setAttribute('aria-hidden','false');
    lockPass.value='';
    lockPass.focus();
  }
  function closeLock(){
    lockOverlay.style.display='none';
    lockOverlay.setAttribute('aria-hidden','true');
  }

  btnToggleLock?.addEventListener('click', openLock);
  btnCloseLock?.addEventListener('click', closeLock);
  btnUnlock?.addEventListener('click', ()=>{
    const p = (lockPass.value || '').trim();
    if(p === DEFAULT_PASS){
      closeLock();
    }else{
      alert('×¡×™×¡××” ×©×’×•×™×”');
    }
  });
  lockPass?.addEventListener('keydown', (e)=>{
    if(e.key==='Enter') btnUnlock.click();
    if(e.key==='Escape') closeLock();
  });

  // Small safety: prevent accidental drag-select a bit (not security)
  document.addEventListener('dragstart', (e)=>e.preventDefault());
</script>
</body>
</html>
