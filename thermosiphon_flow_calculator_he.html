<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>תרמוסיפון: פונקציות ספיקה וחום לפי גובה, קוטר וסוג צנרת</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --ink:#eaf0ff;
      --muted:#b7c4ff;
      --gold:#d8b44a;
      --line:rgba(255,255,255,.10);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    body{
      margin:0; padding:24px;
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      background: radial-gradient(1200px 800px at 80% 0%, rgba(216,180,74,.18), transparent 55%),
                  radial-gradient(1000px 700px at 0% 50%, rgba(183,196,255,.15), transparent 55%),
                  var(--bg);
      color:var(--ink);
      line-height:1.55;
    }
    .wrap{max-width:1100px; margin:0 auto;}
    h1{margin:0 0 10px; font-size:28px;}
    p{margin:8px 0; color:var(--muted);}
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:18px 18px 14px;
    }
    .card h2{margin:0 0 8px; font-size:18px;}
    .card h3{margin:14px 0 8px; font-size:16px; color:var(--ink);}
    .rule{height:1px; background:var(--line); margin:14px 0;}
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(216,180,74,.35);
      color:var(--gold);
      background: rgba(216,180,74,.10);
      font-size:12px;
      margin-inline-start:8px;
      vertical-align:middle;
    }
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    @media (max-width: 520px){ .row{grid-template-columns:1fr;} }
    label{display:block; font-weight:650; margin:8px 0 6px;}
    input, select{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color:var(--ink);
      outline:none;
    }
    input:focus, select:focus{ border-color: rgba(216,180,74,.55); box-shadow:0 0 0 3px rgba(216,180,74,.12);}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    button{
      border:1px solid rgba(216,180,74,.55);
      background: rgba(216,180,74,.14);
      color:var(--ink);
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
    }
    button.secondary{
      border-color: rgba(255,255,255,.20);
      background: rgba(255,255,255,.07);
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      color:var(--ink);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius:14px;
      overflow:auto;
      white-space:pre-wrap;
    }
    .kpi{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 520px){ .kpi{grid-template-columns:1fr;} }
    .kpi .box{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius:14px;
      padding:10px 12px;
    }
    .kpi .t{font-size:12px; color:var(--muted);}
    .kpi .v{font-size:18px; font-weight:800; color:var(--gold); margin-top:2px;}
    details{
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px 12px;
      background: rgba(0,0,0,.16);
      margin-top:10px;
    }
    summary{cursor:pointer; font-weight:750; color:var(--ink);}
    .hint{font-size:12px; color:var(--muted);}
    .warn{color:#ffdd99;}
    .footer{margin-top:14px; font-size:12px; color:var(--muted);}
  </style>
</head>

<body>
<div class="wrap">
  <h1>תרמוסיפון (Thermosiphon): פונקציות לספיקה וחום לפי גובה, קוטר וסוג צנרת</h1>
  <p>
    הדף מחשב זרימה מלמטה למעלה בלולאה סגורה בעזרת <b>עילוי תרמי</b> (הפרש צפיפויות בגלל טמפרטורה),
    ומעריך את <b>הספק החימום</b> הדרוש לשמירת הפרש הטמפרטורות.
    <span class="badge">כולל איטרציה ל־f לפי Re</span>
  </p>

  <div class="grid">
    <div class="card">
      <h2>קלטים (סולם יחידות ברור)</h2>
      <p class="hint">הזנת ערכים במטר / מעלות °C. ניתן להתחיל עם ברירות המחדל.</p>

      <div class="row">
        <div>
          <label>גובה אפקטיבי H (מ׳)</label>
          <input id="H" type="number" step="0.1" value="3.0">
          <div class="hint">הפרש הגבהים בין האזור החם (תחתית) לאזור הקר (עליון).</div>
        </div>
        <div>
          <label>אורך כולל L (מ׳)</label>
          <input id="L" type="number" step="0.1" value="12.0">
          <div class="hint">סה״כ אורך צנרת במסלול (עולה + יורד + אופקי).</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>קוטר פנימי D (מ״מ)</label>
          <input id="Dmm" type="number" step="1" value="25">
          <div class="hint">קוטר פנימי אמיתי.</div>
        </div>
        <div>
          <label>סכום הפסדים מקומיים ΣK</label>
          <input id="Ksum" type="number" step="0.1" value="3.0">
          <div class="hint">ברכיים, שסתומים, הצרות, מחליף חום וכו׳. אם לא בטוח: 2–6 טיפוסי.</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>סוג צנרת (חספוס ε)</label>
          <select id="pipe">
            <option value="1.5e-6">PEX / פלסטיק חלק (ε≈1.5×10⁻⁶ m)</option>
            <option value="1.5e-6">PVC חלק (ε≈1.5×10⁻⁶ m)</option>
            <option value="4.5e-5" selected>נחושת / פלדה חלקה (ε≈4.5×10⁻⁵ m)</option>
            <option value="1.5e-4">ברזל מגולוון (ε≈1.5×10⁻⁴ m)</option>
            <option value="2.5e-4">ברזל יצוק (ε≈2.5×10⁻⁴ m)</option>
          </select>
          <div class="hint">החספוס משפיע על f בתווך טורבולנטי.</div>
        </div>
        <div>
          <label>איטרציות (דיוק)</label>
          <select id="iters">
            <option value="8">מהיר (8)</option>
            <option value="15" selected>מאוזן (15)</option>
            <option value="25">מדויק (25)</option>
          </select>
          <div class="hint">f תלוי ב־Re ולכן פותרים באיטרציה.</div>
        </div>
      </div>

      <div class="rule"></div>

      <h3>טמפרטורות ומאפייני מים</h3>
      <div class="row">
        <div>
          <label>טמפ׳ חם Th (°C)</label>
          <input id="Th" type="number" step="0.5" value="40">
        </div>
        <div>
          <label>טמפ׳ קר Tc (°C)</label>
          <input id="Tc" type="number" step="0.5" value="30">
        </div>
      </div>

      <div class="row">
        <div>
          <label>β (1/K) מקדם התפשטות נפחי</label>
          <input id="beta" type="number" step="0.00001" value="0.00021">
        </div>
        <div>
          <label>צמיגות דינמית μ (Pa·s)</label>
          <input id="mu" type="number" step="0.000001" value="0.0008">
        </div>
      </div>

      <div class="row">
        <div>
          <label>צפיפות ρ (kg/m³)</label>
          <input id="rho" type="number" step="1" value="996">
        </div>
        <div>
          <label>חום סגולי cp (J/kg·K)</label>
          <input id="cp" type="number" step="1" value="4180">
        </div>
      </div>

      <div class="btns">
        <button onclick="compute()">חשב ספיקה וחום</button>
        <button class="secondary" onclick="setExample('small')">דוגמה: קוטר קטן</button>
        <button class="secondary" onclick="setExample('medium')">דוגמה: בינוני</button>
        <button class="secondary" onclick="setExample('large')">דוגמה: קוטר גדול</button>
      </div>

      <p class="footer">
        טיפ: אם התוצאה יוצאת ספיקה אפסית/מאוד קטנה — הגדל D, הקטן L/ΣK, הגדל H או הגדל ΔT (בזהירות).
      </p>
    </div>

    <div class="card">
      <h2>תוצאות + פירוק שלבי הפיתוח</h2>
      <div class="kpi">
        <div class="box"><div class="t">הפרש טמפ׳ ΔT</div><div class="v" id="out_dT">—</div></div>
        <div class="box"><div class="t">לחץ מניע ΔPdrive (Pa)</div><div class="v" id="out_drive">—</div></div>
        <div class="box"><div class="t">מהירות v (m/s)</div><div class="v" id="out_v">—</div></div>
        <div class="box"><div class="t">ספיקה Q (L/min)</div><div class="v" id="out_Q">—</div></div>
        <div class="box"><div class="t">Re</div><div class="v" id="out_Re">—</div></div>
        <div class="box"><div class="t">מקדם חיכוך f</div><div class="v" id="out_f">—</div></div>
        <div class="box" style="grid-column:1 / -1">
          <div class="t">הספק חימום מינימלי Q̇heat,min (W)</div>
          <div class="v" id="out_heat">—</div>
          <div class="hint warn">זה “מינימום” לשמירת ΔT בזרימה; איבודי חום לסביבה יכולים להוסיף הרבה.</div>
        </div>
      </div>

      <details open><summary>שלב 1 — עילוי תרמי: לחץ מניע</summary><div class="mono" id="step1"></div></details>
      <details><summary>שלב 2 — חיכוך בצנרת: הפסדי לחץ (Darcy–Weisbach)</summary><div class="mono" id="step2"></div></details>
      <details><summary>שלב 3 — פתרון הזרימה: איטרציה על f (כי f תלוי ב־Re)</summary><div class="mono" id="step3"></div></details>
      <details><summary>שלב 4 — הספק חימום נדרש לשמירת ΔT</summary><div class="mono" id="step4"></div></details>
      <details><summary>בדיקות הגיון + טיפים תכנוניים</summary><div class="mono" id="tips"></div></details>

      <div class="rule"></div>
      <p class="hint">הנוסחאות כאן הן קירוב הנדסי שימושי. לדיוק גבוה: תכונות מים כתלות T + מודל איבודי חום מפורט.</p>
    </div>
  </div>
</div>

<script>
  function $(id){ return document.getElementById(id); }
  function fmt(x, digits=3){
    if(!isFinite(x)) return "—";
    const ax = Math.abs(x);
    if(ax !== 0 && (ax < 1e-3 || ax > 1e6)) return x.toExponential(3);
    return x.toFixed(digits);
  }

  function setExample(kind){
    if(kind==="small"){
      $("H").value = 3; $("L").value = 18; $("Dmm").value = 16; $("Ksum").value = 5;
      $("Th").value = 45; $("Tc").value = 30; $("pipe").value = "1.5e-6";
    }
    if(kind==="medium"){
      $("H").value = 3; $("L").value = 12; $("Dmm").value = 25; $("Ksum").value = 3;
      $("Th").value = 40; $("Tc").value = 30; $("pipe").value = "4.5e-5";
    }
    if(kind==="large"){
      $("H").value = 4; $("L").value = 14; $("Dmm").value = 40; $("Ksum").value = 2.5;
      $("Th").value = 42; $("Tc").value = 30; $("pipe").value = "4.5e-5";
    }
    compute();
  }

  function frictionFactor(Re, eps, D){
    if(Re <= 0) return NaN;
    if(Re < 2300) return 64.0 / Re;
    const term = (eps/(3.7*D)) + (5.74/Math.pow(Re, 0.9));
    const logv = Math.log10(term);
    return 0.25 / (logv*logv);
  }

  function compute(){
    const g = 9.81;
    const H  = parseFloat($("H").value);
    const L  = parseFloat($("L").value);
    const D  = parseFloat($("Dmm").value) / 1000.0;
    const K  = parseFloat($("Ksum").value);

    const Th = parseFloat($("Th").value);
    const Tc = parseFloat($("Tc").value);
    const dT = Th - Tc;

    const beta = parseFloat($("beta").value);
    const mu   = parseFloat($("mu").value);
    const rho  = parseFloat($("rho").value);
    const cp   = parseFloat($("cp").value);

    const eps  = parseFloat($("pipe").value);
    const iters = parseInt($("iters").value, 10);

    const A = Math.PI * D*D / 4.0;

    const dP_drive = g * H * rho * beta * dT;

    let f = 0.03, v = 0.0, Re = 0.0;
    for(let i=0; i<iters; i++){
      const denom = (f*(L/D) + K);
      if(denom <= 0 || dP_drive <= 0){ v = 0; Re = 0; break; }
      v = Math.sqrt( (2.0*dP_drive) / (rho * denom) );
      Re = rho * v * D / mu;
      const f_new = frictionFactor(Re, eps, D);
      f = 0.6*f + 0.4*f_new;
    }

    const Q = A * v;
    const Q_Lmin = Q * 1000.0 * 60;
    const mdot = rho * Q;
    const Qheat_min = mdot * cp * dT;

    $("out_dT").textContent = fmt(dT, 2) + " °C";
    $("out_drive").textContent = fmt(dP_drive, 1);
    $("out_v").textContent = fmt(v, 4);
    $("out_Q").textContent = fmt(Q_Lmin, 2);
    $("out_Re").textContent = (Re>0? fmt(Re, 0): "0");
    $("out_f").textContent = (isFinite(f)? fmt(f, 4): "—");
    $("out_heat").textContent = (Qheat_min>0? fmt(Qheat_min, 1): "0");

    $("step1").textContent =
`מודל צפיפות ליניארי:
ρ(T) ≈ ρ0 · [1 − β (T − T0)]

ΔT = Th − Tc = ${fmt(dT,2)} °C

ΔPdrive ≈ g · H · ρ · β · ΔT

הצבה:
g=${g}, H=${H} m, ρ≈${rho} kg/m³, β=${beta} 1/K, ΔT=${fmt(dT,2)} K
⇒ ΔPdrive ≈ ${fmt(dP_drive,1)} Pa`;

    $("step2").textContent =
`הפסדי לחץ:
ΔPloss = ( f·(L/D) + ΣK ) · (ρ v² / 2)

L=${L} m, D=${fmt(D*1000,0)} mm, ΣK=${K}
ε=${eps} m

למינרית: f=64/Re
לטורבולנטית (Swamee–Jain):
f ≈ 0.25 / [log10( ε/(3.7D) + 5.74/Re^0.9 )]^2`;

    $("step3").textContent =
`איטרציה כי f תלוי ב-Re:

v = √[ 2ΔPdrive / ( ρ ( f(L/D)+ΣK ) ) ]
Re = ρ v D / μ
עדכון f לפי Re (מס' איטרציות: ${iters})

תוצאה:
v ≈ ${fmt(v,4)} m/s
Re ≈ ${Re>0?fmt(Re,0):"0"}
f ≈ ${isFinite(f)?fmt(f,4):"—"}

Q = (πD²/4)·v
Q ≈ ${fmt(Q_Lmin,2)} L/min`;

    $("step4").textContent =
`ṁ = ρ Q ≈ ${fmt(mdot,5)} kg/s
Q̇heat,min = ṁ · cp · ΔT
cp≈${cp} J/kg·K, ΔT=${fmt(dT,2)} K
⇒ Q̇heat,min ≈ ${Qheat_min>0?fmt(Qheat_min,1):"0"} W

בפועל:
Q̇heat ≈ Q̇heat,min + איבודי חום לסביבה (צינור לא מבודד, רוח, קירות וכו')`;

    let tips = [];
    if(dT <= 0) tips.push("• ΔT חייב להיות חיובי (Th>Tc) כדי שתיווצר זרימה בכיוון הרצוי.");
    if(Q_Lmin < 0.2 && dT>0) tips.push("• ספיקה נמוכה מאוד: הגדל D / הקטן L או ΣK / הגדל H / הגדל ΔT בזהירות.");
    tips.push("• בידוד לצינור העולה שומר על ΔT ולכן מגדיל ΔPdrive אפקטיבי.");
    tips.push("• פחות ברכיים ושסתומים = ΣK קטן יותר = זרימה טובה יותר.");
    tips.push("• חימום מדורג בתחתית עדיף על 'מכה' חמה (מקטין סיכון לבעבוע מקומי ומייצב זרימה).");
    $("tips").textContent = tips.join("\n");
  }

  compute();
</script>
</body>
</html>
