<!doctype html>
<html lang="he" dir="rtl" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>××•×“×œ PCX â€¢ ×¦×™××•×“/×–×œ×™×’×”/×”×©×¨××” ×‘×™×Ÿ ×›×‘×œ×™× ×¦××•×“×™×</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg0:#f4f6fb; --bg1:#eef2ff; --bg2:#ecfeff;
      --card:rgba(255,255,255,.78); --card2:rgba(255,255,255,.60); --cardSolid:#fff;
      --text:#0f172a; --muted:#64748b; --line:rgba(148,163,184,.35);
      --head:#0b1220; --link:#2563eb;
      --shadow:0 18px 50px rgba(2,6,23,.10); --r:18px;
      --accent:#6366f1; --accent2:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg0:#0b1020; --bg1:#0b1220; --bg2:#07111a;
        --card:rgba(15,23,42,.75); --card2:rgba(15,23,42,.55); --cardSolid:#0f172a;
        --text:#e5e7eb; --muted:#94a3b8; --line:rgba(148,163,184,.18);
        --head:#f1f5f9; --link:#60a5fa;
        --shadow:0 18px 55px rgba(0,0,0,.45);
      }
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Hebrew", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 90% -10%, var(--bg2), transparent 55%),
        radial-gradient(900px 700px at 10% 0%, var(--bg1), transparent 55%),
        linear-gradient(180deg, var(--bg0), rgba(255,255,255,0));
      min-height:100vh;
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:28px 18px 10px;
      max-width:1200px; margin:0 auto;
    }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg, var(--accent), #0ea5e9);
      box-shadow: var(--shadow);
      display:grid; place-items:center; color:white; font-weight:800;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.1vw, 34px);
      color:var(--head);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:10px 0 0;
      color:var(--muted);
      line-height:1.55;
      max-width: 80ch;
    }
    main{max-width:1200px; margin:0 auto; padding: 10px 18px 44px;}
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:16px;
    }
    .card h2{
      margin:0 0 8px;
      font-size: 18px;
      color:var(--head);
    }
    .row{display:flex; gap:12px; flex-wrap:wrap;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      background: rgba(99,102,241,.14);
      border:1px solid rgba(99,102,241,.25);
      color:var(--head);
      font-weight:600;
      user-select:none;
    }
    .pill small{color:var(--muted); font-weight:600}
    .pill.warn{
      background: rgba(245,158,11,.14);
      border:1px solid rgba(245,158,11,.25);
    }
    .pill.danger{
      background: rgba(239,68,68,.14);
      border:1px solid rgba(239,68,68,.25);
    }
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:680px){ .controls{grid-template-columns:1fr;} }
    .ctrl{
      background: var(--card2);
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
    }
    .ctrl label{
      display:flex; justify-content:space-between; gap:10px;
      font-weight:700; color:var(--head);
      margin-bottom:8px;
    }
    .ctrl label span{color:var(--muted); font-weight:700}
    input[type="range"]{width:100%}
    input[type="number"], select{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: var(--cardSolid);
      color: var(--text);
      font-family: var(--mono);
      outline:none;
    }
    .katexbox{
      background: rgba(2,6,23,.06);
      border:1px dashed var(--line);
      border-radius: 14px;
      padding:10px 12px;
      overflow:auto;
      direction:ltr;
      font-family: var(--mono);
    }
    @media (prefers-color-scheme: dark){
      .katexbox{ background: rgba(2,6,23,.35); }
    }
    .mini{
      color:var(--muted); line-height:1.6;
      margin: 8px 0 0;
    }
    .hr{height:1px; background: var(--line); margin:14px 0;}
    .two{
      display:grid; grid-template-columns: 1fr 1fr; gap:12px;
    }
    @media (max-width:860px){ .two{grid-template-columns:1fr;} }
    canvas{
      width:100%; height:320px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.35);
    }
    @media (prefers-color-scheme: dark){
      canvas{ background: rgba(2,6,23,.25); }
    }
    .btnbar{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start;
      margin-top: 10px;
    }
    button{
      border:none;
      border-radius: 999px;
      padding:10px 12px;
      background: rgba(99,102,241,.16);
      color: var(--head);
      border:1px solid rgba(99,102,241,.26);
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    button:hover{filter:brightness(1.05)}
    button.secondary{
      background: rgba(148,163,184,.14);
      border:1px solid rgba(148,163,184,.26);
    }
    .footer{
      margin-top:14px;
      color:var(--muted);
      font-size:13px;
      line-height:1.55;
    }
    .lang{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
    }
    .lang .tag{
      font-family: var(--mono);
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: var(--card2);
      cursor:pointer;
      user-select:none;
      font-weight:800;
    }
    .lang .tag.active{
      background: rgba(34,197,94,.16);
      border-color: rgba(34,197,94,.28);
    }
    .badge{
      font-family: var(--mono);
      padding:3px 8px; border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(148,163,184,.10);
      color: var(--muted);
      font-weight:800;
    }
    .callout{
      border-radius: 16px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(34,197,94,.12), rgba(34,197,94,0));
      padding:12px;
    }
    .callout.warn{
      background: linear-gradient(180deg, rgba(245,158,11,.14), rgba(245,158,11,0));
    }
    .callout.danger{
      background: linear-gradient(180deg, rgba(239,68,68,.14), rgba(239,68,68,0));
    }
    .callout h3{margin:0 0 6px; color:var(--head); font-size:16px;}
    .callout ul{margin:8px 0 0; padding:0 18px; color:var(--muted); line-height:1.7;}
    .muted{color:var(--muted)}
    .ltr{direction:ltr}
  </style>

  <!-- KaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo">âš¡</div>
      <div>
        <h1 data-i18n="title">××•×“×œ PCX â€¢ ×”×•×œ×›×”/×¦×™××•×“ ×‘×™×Ÿ ×›×‘×œ×™× ×¦××•×“×™×</h1>
        <div class="subtitle" data-i18n="subtitle">
          ××•×“×œ ××—×“ ×©×××—×“: ×¦×™××•×“ ×§×™×‘×•×œ×™ (E-field), ×¦×™××•×“ ×”×©×¨××ª×™ (B-field), ×–×œ×™×’×ª ×‘×™×“×•×“, ×•×‘××ª×— ×’×‘×•×” â€” ×¤×¨×™×¦×” ×œ×-×œ×™× ×™××¨×™×ª.
        </div>
      </div>
    </div>

    <div class="lang">
      <span class="badge" data-i18n="langLabel">×©×¤×”</span>
      <div class="tag active" data-lang="he">HE</div>
      <div class="tag" data-lang="en">EN</div>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- LEFT: Explanation -->
    <section class="card">
      <h2 data-i18n="sec1">1) ××” â€œ×—×“×©â€ ×‘××•×“×œ PCX?</h2>
      <div class="row">
        <span class="pill">PCX <small>Proximityâ€‘Coupling eXchange</small></span>
        <span class="pill warn" data-i18n="alwaysLink">×ª××™×“ ×™×© â€œ×§×™×©×•×¨â€ â€” ×”×©××œ×” ××™×–×” ×¨×›×™×‘ ×©×•×œ×˜</span>
      </div>

      <p class="mini" data-i18n="pcxDef">
        ×‘××§×•× ×œ×©××•×œ â€œ×”×× ×™×© ×”×•×œ×›×” ××• ××™×Ÿ?â€, PCX ××’×“×™×¨ â€œ×ª×¢×œ×ª ×—×™×œ×•×£â€ ×©×§×•×œ×” ×‘×™×Ÿ ×›×‘×œ 1 ×œ×›×‘×œ 2:
        <b>×§×™×‘×•×œ</b> (×©×“×” ×—×©××œ×™), <b>×”×©×¨××”</b> (×©×“×” ××’× ×˜×™), ×•<b>××•×œ×™×›×•×ª ×–×œ×™×’×”</b> (×‘×™×“×•×“/×¡×‘×™×‘×”). ×‘××ª×— ×’×‘×•×” ×××•×“ â€” ××•×¡×™×¤×™× ×¨×›×™×‘ <b>×¤×¨×™×¦×”</b>.
      </p>

      <div class="hr"></div>

      <h2 data-i18n="sec2">2) ×”×‘×œ×•×§ ×”×©×§×•×œ (××“××™×˜× ×¡ + ××§×•×¨ ××•×©×¨×”)</h2>

      <div class="katexbox">
        <div class="ltr">
          <div>\(\displaystyle Y_{12}(\omega)=G_{\text{leak}} + j\omega C_{12}\)</div>
          <div style="margin-top:8px">\(\displaystyle v_{2,\text{ind}}(t)=M\,\frac{di_1(t)}{dt}\)</div>
        </div>
      </div>

      <p class="mini" data-i18n="terms">
        \(C_{12}\): ×§×™×‘×•×œ ×‘×™×Ÿ ×”×›×‘×œ×™× (×¦×™××•×“ ×§×™×‘×•×œ×™). &nbsp;
        \(G_{\text{leak}}\): ××•×œ×™×›×•×ª ×–×œ×™×’×” (×œ×—×•×ª/××‘×§/×¤×’× ×‘×™×“×•×“). &nbsp;
        \(M\): ×”×©×¨××•×ª ×”×“×“×™×ª (×¦×™××•×“ ××’× ×˜×™). &nbsp;
        \(\omega=2\pi f\).
      </p>

      <div class="hr"></div>

      <h2 data-i18n="sec3">3) ×¤×•× ×§×¦×™×™×ª ××¢×‘×¨ ×××•×—×“×ª ×œ××ª×— ×‘×›×‘×œ 2</h2>
      <div class="katexbox">
        <div class="ltr">
          <div>\(\displaystyle V_2(\omega)=\underbrace{\frac{Z_L}{Z_L+\frac{1}{Y_{12}(\omega)}}}_{\text{×“×¨×š ×”×ª×¢×œ×”}}\,V_1(\omega)\;+\;\underbrace{\frac{Z_L}{Z_L+Z_2}}_{\text{×—×œ×•×§×”}}\,V_{2,\text{ind}}(\omega)\)</div>
        </div>
      </div>

      <p class="mini" data-i18n="dcac">
        ×‘â€‘DC (\(\omega=0\)): ×¨×›×™×‘ \(j\omega C_{12}\) × ×¢×œ× â‡’ × ×©××¨ ×¨×§ \(G_{\text{leak}}\). ×œ×›×Ÿ ×–×¨× â€œ×××™×ª×™â€ ×œ××•×¨×š ×–××Ÿ ××•×¤×™×¢ ×¨×§ ×× ×™×© ×–×œ×™×’×”.  
        ×‘â€‘AC: ×’× ×× \(G_{\text{leak}} \approx 0\), ×¨×›×™×‘ \(j\omega C_{12}\) ×™×•×¦×¨ ××ª×—/×–×¨× ××•×©×¨×™×.
      </p>

      <div class="two">
        <div class="callout">
          <h3 data-i18n="practical">××” ××•×“×“×™×/××—×©×‘×™× ×‘×¤×•×¢×œ</h3>
          <ul>
            <li data-i18n="m1">\(C_{12}\) â€” ×ª×œ×•×™ ××¨×—×§, ××•×¨×š, ×“×™××œ×§×˜×¨×™ (×‘×™×“×•×“).</li>
            <li data-i18n="m2">\(M\) â€” ×ª×œ×•×™ ×’×™××•××˜×¨×™×”, ×œ×•×œ××•×ª, ×§×¨×‘×”.</li>
            <li data-i18n="m3">\(G_{\text{leak}}\) â€” ×ª×œ×•×™ ×œ×—×•×ª/×œ×›×œ×•×š/×˜××¤×³/×”×–×“×§× ×•×ª.</li>
          </ul>
        </div>
        <div class="callout warn">
          <h3 data-i18n="risk">××ª×™ ×–×” ×”×•×¤×š ×œ××¡×•×›×Ÿ</h3>
          <ul>
            <li data-i18n="r1">××ª×— ×’×‘×•×” â‡’ ×§×•×¨×•× ×”/×§×©×ª (×œ×â€‘×œ×™× ×™××¨×™).</li>
            <li data-i18n="r2">×œ×—×•×ª/××™×/××‘×§ â‡’ ×–×œ×™×’×” ×’×“×œ×”.</li>
            <li data-i18n="r3">×›×©×œ ×‘×™×“×•×“ â‡’ ×”×•×œ×›×” ×™×©×™×¨×”.</li>
          </ul>
        </div>
      </div>

      <div class="hr"></div>

      <h2 data-i18n="sec4">4) ×”×¨×—×‘×” ×œ×â€‘×œ×™× ×™××¨×™×ª (××ª×— ×’×‘×•×”)</h2>
      <div class="katexbox">
        <div class="ltr">
          <div>\(\displaystyle G_{\text{total}} = G_{\text{leak}} + G_{\text{bd}}(E)\)</div>
          <div style="margin-top:8px">\(\displaystyle G_{\text{bd}}(E)\approx 0 \;\; (E\le E_{\text{th}}),\quad G_{\text{bd}}(E)\uparrow \text{ ××”×¨ }(E>E_{\text{th}})\)</div>
        </div>
      </div>
      <p class="mini" data-i18n="bdNote">
        ×›××Ÿ × ×©×ª××© ×‘×§×™×¨×•×‘ ×¤×©×•×˜ ×œâ€‘\(G_{\text{bd}}\) ×›×“×™ ×œ×”×“×’×™× â€œ×§×¤×™×¦×”â€ ×‘×”×ª× ×”×’×•×ª ××¢×œ ×¡×£ ×©×“×” \(E_{\text{th}}\).
      </p>

      <div class="footer">
        <div class="pill danger" style="margin-bottom:8px">
          <span>âš ï¸</span>
          <span data-i18n="safety">×–×”×• ××•×“×œ ×”×¡×‘×¨/×—×™×©×•×‘. ×¢×‘×•×“×•×ª ×—×©××œ ×‘××ª×— ××¡×•×›×Ÿ ×“×•×¨×©×•×ª ××™×© ××§×¦×•×¢ ×•×ª×§× ×™× ××ª××™××™×.</span>
        </div>
        <div>×›×œ ×”×–×›×™×•×ª ×©××•×¨×•×ª , ××™×Ÿ ×œ×©×›×¤×œ ××œ× ×‘××™×©×•×¨ × RA - Raftn4@gmail.com</div>
      </div>
    </section>

    <!-- RIGHT: Simulator -->
    <aside class="card">
      <h2 data-i18n="simTitle">×¡×™××•×œ×˜×•×¨ PCX ××™× ×˜×¨××§×˜×™×‘×™</h2>
      <p class="mini" data-i18n="simDesc">
        ×©× ×• ×¢×¨×›×™× ×•×¨××• ×‘×–××Ÿ ×××ª ××ª ×”××ª×— ×”××•×©×¨×” ×‘×›×‘×œ 2 (×ª×¨×•××” ×§×™×‘×•×œ×™×ª/×–×œ×™×’×” + ×ª×¨×•××” ×”×©×¨××ª×™×ª) ×•××ª ×”×¡×™×›×•×Ÿ ×œ×¤×¨×™×¦×”.
      </p>

      <div class="controls">
        <div class="ctrl">
          <label><span data-i18n="v1">V1 (×××¤×œ×™×˜×•×“×”)</span><span class="badge" id="v1v">230 V</span></label>
          <input id="v1" type="range" min="0" max="2000" step="1" value="230">
          <div class="mini muted ltr">Volts (peak)</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="f">×ª×“×¨ f</span><span class="badge" id="fv">50 Hz</span></label>
          <input id="f" type="range" min="0" max="200000" step="1" value="50">
          <div class="mini muted ltr">Hz</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="c12">C12 (×§×™×‘×•×œ ×‘×™×Ÿ ×›×‘×œ×™×)</span><span class="badge" id="c12v">30 pF</span></label>
          <input id="c12" type="range" min="0" max="5000" step="1" value="30">
          <div class="mini muted ltr">pF</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="gleak">G_leak (×–×œ×™×’×”)</span><span class="badge" id="gleakv">0 nS</span></label>
          <input id="gleak" type="range" min="0" max="5000" step="1" value="0">
          <div class="mini muted ltr">nS (siemens)</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="m">M (×”×©×¨××•×ª ×”×“×“×™×ª)</span><span class="badge" id="mv">0.2 ÂµH</span></label>
          <input id="m" type="range" min="0" max="5000" step="1" value="200">
          <div class="mini muted ltr">nH</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="didt">dI/dt (×©×™×)</span><span class="badge" id="didtv">500 A/s</span></label>
          <input id="didt" type="range" min="0" max="200000" step="10" value="500">
          <div class="mini muted ltr">A/s</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="zl">ZL (×¢×•××¡ ×‘×›×‘×œ 2)</span><span class="badge" id="zlv">1 MÎ©</span></label>
          <input id="zl" type="range" min="1" max="10000000" step="1" value="1000000">
          <div class="mini muted ltr">Î©</div>
        </div>

        <div class="ctrl">
          <label><span data-i18n="z2">Z2 (××™××¤×“× ×¡ ××§×•×¨ ×‘×›×‘×œ 2)</span><span class="badge" id="z2v">1 kÎ©</span></label>
          <input id="z2" type="range" min="1" max="100000" step="1" value="1000">
          <div class="mini muted ltr">Î©</div>
        </div>
      </div>

      <div class="hr"></div>

      <h2 data-i18n="bdSim">××•×“×œ ×¤×¨×™×¦×” (×”×“×’××”)</h2>
      <p class="mini" data-i18n="bdDesc">
        ×›××Ÿ × ×©×ª××© ×‘×©×“×” ××¤×§×˜×™×‘×™ \(E\) ×›×“×™ ×œ×”×¤×¢×™×œ ××•×œ×™×›×•×ª ×¤×¨×™×¦×” ×œ×â€‘×œ×™× ×™××¨×™×ª.
      </p>

      <div class="controls">
        <div class="ctrl">
          <label><span data-i18n="e">E (×©×“×” ××¤×§×˜×™×‘×™)</span><span class="badge" id="ev">0.5 kV/mm</span></label>
          <input id="e" type="range" min="0" max="5000" step="1" value="500">
          <div class="mini muted ltr">V/mm</div>
        </div>
        <div class="ctrl">
          <label><span data-i18n="eth">E_th (×¡×£)</span><span class="badge" id="ethv">1.5 kV/mm</span></label>
          <input id="eth" type="range" min="0" max="5000" step="1" value="1500">
          <div class="mini muted ltr">V/mm</div>
        </div>
      </div>

      <div class="btnbar">
        <button id="presetHouse" title="50Hz, ×¢×¨×›×™× ×‘×™×ª×™×™×" data-i18n="preset1">Preset: ×‘×™×ª×™ ğŸ </button>
        <button id="presetFast" class="secondary" title="×ª×“×¨ ×’×‘×•×”/××”×™×¨" data-i18n="preset2">Preset: ×ª×“×¨ ×’×‘×•×” ğŸš€</button>
        <button id="presetWet" class="secondary" title="×–×œ×™×’×” ×’×‘×•×”×” (×œ×—×•×ª)" data-i18n="preset3">Preset: ×œ×—×•×ª ğŸ’§</button>
      </div>

      <div class="hr"></div>

      <div class="two">
        <div class="card" style="padding:12px">
          <h2 data-i18n="results">×ª×•×¦××•×ª</h2>
          <div class="mini"><b data-i18n="v2total">V2 total</b>: <span class="badge ltr" id="v2tot">â€”</span></div>
          <div class="mini"><b data-i18n="v2cap">V2 via Y12</b>: <span class="badge ltr" id="v2cap">â€”</span></div>
          <div class="mini"><b data-i18n="v2ind">V2 induced</b>: <span class="badge ltr" id="v2ind">â€”</span></div>
          <div class="mini"><b data-i18n="y12">Y12</b>: <span class="badge ltr" id="y12">â€”</span></div>
          <div class="mini"><b data-i18n="riskLbl">××¦×‘ ×¡×™×›×•×Ÿ</b>: <span class="badge" id="risk">â€”</span></div>
        </div>

        <div class="card" style="padding:12px">
          <h2 data-i18n="notes">×”×¢×¨×•×ª ×—×™×©×•×‘</h2>
          <ul class="mini muted" style="margin:8px 0 0; padding:0 18px; line-height:1.7">
            <li data-i18n="n1">×¢×¨×›×™× ×›××Ÿ ×”× ×”×“×’××”; ×‘××¦×™××•×ª \(C_{12},M,G\) × ×’×–×¨×™× ××’×™××•××˜×¨×™×” ×•×”×ª×§× ×™×.</li>
            <li data-i18n="n2">×‘â€‘DC: ×§×™×‘×•×œ ×œ× ××¢×‘×™×¨ ×–×¨× ×§×‘×•×¢ (×¨×§ ×˜×¢×™× ×” ×¨×’×¢×™×ª).</li>
            <li data-i18n="n3">×‘â€‘AC: ×”×ª×¨×•××” ×”×§×™×‘×•×œ×™×ª ×’×“×œ×” ×¢× ×ª×“×¨; ×”×”×©×¨××ª×™×ª ×’×“×œ×” ×¢× \(dI/dt\).</li>
          </ul>
        </div>
      </div>

      <div class="hr"></div>

      <h2 data-i18n="plot">×’×¨×£ ×“×•×’××”: V2 ×œ×¢×•××ª ×ª×“×¨</h2>
      <p class="mini" data-i18n="plotDesc">
        ×”×’×¨×£ ××—×©×‘ ××ª \(V_2\) (×××¤×œ×™×˜×•×“×”) ×¢×‘×•×¨ ×˜×•×•×— ×ª×“×¨×™×, ×¢× ××•×ª× ×¤×¨××˜×¨×™×.
      </p>
      <canvas id="plot"></canvas>

      <div class="footer">
        <span class="badge">PCX</span>
        <span class="muted" data-i18n="footer2">×§×™×‘×•×œ×™ + ×”×©×¨××ª×™ + ×–×œ×™×’×” + (×¤×¨×™×¦×”)</span>
      </div>
    </aside>

  </div>
</main>

<script>
  // -------- i18n ----------
  const I18N = {
    he: {
      langLabel: "×©×¤×”",
      title: "××•×“×œ PCX â€¢ ×”×•×œ×›×”/×¦×™××•×“ ×‘×™×Ÿ ×›×‘×œ×™× ×¦××•×“×™×",
      subtitle: "××•×“×œ ××—×“ ×©×××—×“: ×¦×™××•×“ ×§×™×‘×•×œ×™ (E-field), ×¦×™××•×“ ×”×©×¨××ª×™ (B-field), ×–×œ×™×’×ª ×‘×™×“×•×“, ×•×‘××ª×— ×’×‘×•×” â€” ×¤×¨×™×¦×” ×œ×-×œ×™× ×™××¨×™×ª.",
      sec1: "1) ××” â€œ×—×“×©â€ ×‘××•×“×œ PCX?",
      alwaysLink: "×ª××™×“ ×™×© â€œ×§×™×©×•×¨â€ â€” ×”×©××œ×” ××™×–×” ×¨×›×™×‘ ×©×•×œ×˜",
      pcxDef: "×‘××§×•× ×œ×©××•×œ â€œ×”×× ×™×© ×”×•×œ×›×” ××• ××™×Ÿ?â€, PCX ××’×“×™×¨ â€œ×ª×¢×œ×ª ×—×™×œ×•×£â€ ×©×§×•×œ×” ×‘×™×Ÿ ×›×‘×œ 1 ×œ×›×‘×œ 2: ×§×™×‘×•×œ (×©×“×” ×—×©××œ×™), ×”×©×¨××” (×©×“×” ××’× ×˜×™), ×•××•×œ×™×›×•×ª ×–×œ×™×’×” (×‘×™×“×•×“/×¡×‘×™×‘×”). ×‘××ª×— ×’×‘×•×” ×××•×“ â€” ××•×¡×™×¤×™× ×¨×›×™×‘ ×¤×¨×™×¦×”.",
      sec2: "2) ×”×‘×œ×•×§ ×”×©×§×•×œ (××“××™×˜× ×¡ + ××§×•×¨ ××•×©×¨×”)",
      terms: "C12: ×§×™×‘×•×œ ×‘×™×Ÿ ×”×›×‘×œ×™× (×¦×™××•×“ ×§×™×‘×•×œ×™).  G_leak: ××•×œ×™×›×•×ª ×–×œ×™×’×” (×œ×—×•×ª/××‘×§/×¤×’× ×‘×™×“×•×“).  M: ×”×©×¨××•×ª ×”×“×“×™×ª (×¦×™××•×“ ××’× ×˜×™).  Ï‰=2Ï€f.",
      sec3: "3) ×¤×•× ×§×¦×™×™×ª ××¢×‘×¨ ×××•×—×“×ª ×œ××ª×— ×‘×›×‘×œ 2",
      dcac: "×‘â€‘DC (Ï‰=0): ×¨×›×™×‘ jÏ‰C12 × ×¢×œ× â‡’ × ×©××¨ ×¨×§ G_leak. ×œ×›×Ÿ ×–×¨× â€œ×××™×ª×™â€ ×œ××•×¨×š ×–××Ÿ ××•×¤×™×¢ ×¨×§ ×× ×™×© ×–×œ×™×’×”.  ×‘â€‘AC: ×’× ×× G_leakâ‰ˆ0, ×¨×›×™×‘ jÏ‰C12 ×™×•×¦×¨ ××ª×—/×–×¨× ××•×©×¨×™×.",
      practical: "××” ××•×“×“×™×/××—×©×‘×™× ×‘×¤×•×¢×œ",
      m1: "C12 â€” ×ª×œ×•×™ ××¨×—×§, ××•×¨×š, ×“×™××œ×§×˜×¨×™ (×‘×™×“×•×“).",
      m2: "M â€” ×ª×œ×•×™ ×’×™××•××˜×¨×™×”, ×œ×•×œ××•×ª, ×§×¨×‘×”.",
      m3: "G_leak â€” ×ª×œ×•×™ ×œ×—×•×ª/×œ×›×œ×•×š/×˜××¤×³/×”×–×“×§× ×•×ª.",
      risk: "××ª×™ ×–×” ×”×•×¤×š ×œ××¡×•×›×Ÿ",
      r1: "××ª×— ×’×‘×•×” â‡’ ×§×•×¨×•× ×”/×§×©×ª (×œ×â€‘×œ×™× ×™××¨×™).",
      r2: "×œ×—×•×ª/××™×/××‘×§ â‡’ ×–×œ×™×’×” ×’×“×œ×”.",
      r3: "×›×©×œ ×‘×™×“×•×“ â‡’ ×”×•×œ×›×” ×™×©×™×¨×”.",
      sec4: "4) ×”×¨×—×‘×” ×œ×â€‘×œ×™× ×™××¨×™×ª (××ª×— ×’×‘×•×”)",
      bdNote: "×›××Ÿ × ×©×ª××© ×‘×§×™×¨×•×‘ ×¤×©×•×˜ ×œâ€‘G_bd ×›×“×™ ×œ×”×“×’×™× â€œ×§×¤×™×¦×”â€ ×‘×”×ª× ×”×’×•×ª ××¢×œ ×¡×£ ×©×“×” E_th.",
      safety: "×–×”×• ××•×“×œ ×”×¡×‘×¨/×—×™×©×•×‘. ×¢×‘×•×“×•×ª ×—×©××œ ×‘××ª×— ××¡×•×›×Ÿ ×“×•×¨×©×•×ª ××™×© ××§×¦×•×¢ ×•×ª×§× ×™× ××ª××™××™×.",
      simTitle: "×¡×™××•×œ×˜×•×¨ PCX ××™× ×˜×¨××§×˜×™×‘×™",
      simDesc: "×©× ×• ×¢×¨×›×™× ×•×¨××• ×‘×–××Ÿ ×××ª ××ª ×”××ª×— ×”××•×©×¨×” ×‘×›×‘×œ 2 (×ª×¨×•××” ×§×™×‘×•×œ×™×ª/×–×œ×™×’×” + ×ª×¨×•××” ×”×©×¨××ª×™×ª) ×•××ª ×”×¡×™×›×•×Ÿ ×œ×¤×¨×™×¦×”.",
      v1: "V1 (×××¤×œ×™×˜×•×“×”)",
      f: "×ª×“×¨ f",
      c12: "C12 (×§×™×‘×•×œ ×‘×™×Ÿ ×›×‘×œ×™×)",
      gleak: "G_leak (×–×œ×™×’×”)",
      m: "M (×”×©×¨××•×ª ×”×“×“×™×ª)",
      didt: "dI/dt (×©×™×)",
      zl: "ZL (×¢×•××¡ ×‘×›×‘×œ 2)",
      z2: "Z2 (××™××¤×“× ×¡ ××§×•×¨ ×‘×›×‘×œ 2)",
      bdSim: "××•×“×œ ×¤×¨×™×¦×” (×”×“×’××”)",
      bdDesc: "×›××Ÿ × ×©×ª××© ×‘×©×“×” ××¤×§×˜×™×‘×™ E ×›×“×™ ×œ×”×¤×¢×™×œ ××•×œ×™×›×•×ª ×¤×¨×™×¦×” ×œ×â€‘×œ×™× ×™××¨×™×ª.",
      e: "E (×©×“×” ××¤×§×˜×™×‘×™)",
      eth: "E_th (×¡×£)",
      preset1: "Preset: ×‘×™×ª×™ ğŸ ",
      preset2: "Preset: ×ª×“×¨ ×’×‘×•×” ğŸš€",
      preset3: "Preset: ×œ×—×•×ª ğŸ’§",
      results: "×ª×•×¦××•×ª",
      v2total: "V2 total",
      v2cap: "V2 ×“×¨×š Y12",
      v2ind: "V2 ××•×©×¨×”",
      y12: "Y12",
      riskLbl: "××¦×‘ ×¡×™×›×•×Ÿ",
      notes: "×”×¢×¨×•×ª ×—×™×©×•×‘",
      n1: "×¢×¨×›×™× ×›××Ÿ ×”× ×”×“×’××”; ×‘××¦×™××•×ª C12,M,G × ×’×–×¨×™× ××’×™××•××˜×¨×™×” ×•×”×ª×§× ×™×.",
      n2: "×‘â€‘DC: ×§×™×‘×•×œ ×œ× ××¢×‘×™×¨ ×–×¨× ×§×‘×•×¢ (×¨×§ ×˜×¢×™× ×” ×¨×’×¢×™×ª).",
      n3: "×‘â€‘AC: ×”×ª×¨×•××” ×”×§×™×‘×•×œ×™×ª ×’×“×œ×” ×¢× ×ª×“×¨; ×”×”×©×¨××ª×™×ª ×’×“×œ×” ×¢× dI/dt.",
      plot: "×’×¨×£ ×“×•×’××”: V2 ×œ×¢×•××ª ×ª×“×¨",
      plotDesc: "×”×’×¨×£ ××—×©×‘ ××ª V2 (×××¤×œ×™×˜×•×“×”) ×¢×‘×•×¨ ×˜×•×•×— ×ª×“×¨×™×, ×¢× ××•×ª× ×¤×¨××˜×¨×™×.",
      footer2: "×§×™×‘×•×œ×™ + ×”×©×¨××ª×™ + ×–×œ×™×’×” + (×¤×¨×™×¦×”)"
    },
    en: {
      langLabel: "Language",
      title: "PCX Model â€¢ Coupling / leakage between adjacent cables",
      subtitle: "One unified model: capacitive coupling (Eâ€‘field), inductive coupling (Bâ€‘field), insulation leakage, and at high voltage â€” nonlinear breakdown.",
      sec1: "1) Whatâ€™s â€œnewâ€ in PCX?",
      alwaysLink: "There is always a â€œlinkâ€ â€” the question is which mechanism dominates",
      pcxDef: "Instead of asking â€œis there conduction or not?â€, PCX defines a single equivalent exchange channel between cable 1 and cable 2: capacitance (electric field), induction (magnetic field), and leakage conductance (insulation/environment). At very high voltage â€” add breakdown.",
      sec2: "2) The equivalent block (admittance + induced source)",
      terms: "C12: capacitance between cables.  G_leak: leakage conductance (humidity/dirt/insulation defects).  M: mutual inductance.  Ï‰=2Ï€f.",
      sec3: "3) Unified transfer expression for the voltage on cable 2",
      dcac: "At DC (Ï‰=0): jÏ‰C12 vanishes â‡’ only G_leak remains, so sustained current appears only via leakage.  At AC: even if G_leakâ‰ˆ0, jÏ‰C12 creates induced voltage/current.",
      practical: "What you estimate/measure in practice",
      m1: "C12 â€” set by spacing, length, dielectric.",
      m2: "M â€” set by geometry, loop area, proximity.",
      m3: "G_leak â€” set by humidity/dirt/temperature/aging.",
      risk: "When it becomes dangerous",
      r1: "High voltage â‡’ corona/arc (nonlinear).",
      r2: "Humidity/water/dust â‡’ leakage increases.",
      r3: "Insulation failure â‡’ direct conduction.",
      sec4: "4) Nonlinear extension (high voltage)",
      bdNote: "We use a simple toy approximation for G_bd to illustrate a sharp behavior change above the field threshold E_th.",
      safety: "Educational/modeling only. Highâ€‘voltage work requires qualified professionals and standards compliance.",
      simTitle: "Interactive PCX Simulator",
      simDesc: "Adjust parameters and see the induced voltage on cable 2 in real time (via Y12 + via induction) and the breakdown risk indicator.",
      v1: "V1 (amplitude)",
      f: "Frequency f",
      c12: "C12 (betweenâ€‘cable capacitance)",
      gleak: "G_leak (leakage)",
      m: "M (mutual inductance)",
      didt: "dI/dt (peak)",
      zl: "ZL (load on cable 2)",
      z2: "Z2 (source impedance on cable 2)",
      bdSim: "Breakdown model (demo)",
      bdDesc: "Use an effective field E to activate a nonlinear breakdown conductance.",
      e: "E (effective field)",
      eth: "E_th (threshold)",
      preset1: "Preset: mains ğŸ ",
      preset2: "Preset: highâ€‘freq ğŸš€",
      preset3: "Preset: humid ğŸ’§",
      results: "Results",
      v2total: "V2 total",
      v2cap: "V2 via Y12",
      v2ind: "V2 induced",
      y12: "Y12",
      riskLbl: "Risk state",
      notes: "Computation notes",
      n1: "Values are illustrative; real C12/M/G come from geometry and standards.",
      n2: "At DC: capacitance does not pass steady current (only a transient).",
      n3: "At AC: capacitive term grows with frequency; inductive term grows with dI/dt.",
      plot: "Example plot: V2 vs frequency",
      plotDesc: "The plot computes V2 amplitude across a frequency sweep using the current parameters.",
      footer2: "capacitive + inductive + leakage + (breakdown)"
    }
  };

  let LANG = "he";
  function applyLang(lang){
    LANG = lang;
    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const k = el.getAttribute("data-i18n");
      if(I18N[lang][k]) el.textContent = I18N[lang][k];
    });
    // keep RTL/LTR correct
    document.documentElement.lang = (lang==="he") ? "he" : "en";
    document.documentElement.dir = (lang==="he") ? "rtl" : "ltr";
    document.querySelectorAll(".tag").forEach(t=>t.classList.toggle("active", t.dataset.lang===lang));
  }

  document.querySelectorAll(".tag").forEach(t=>{
    t.addEventListener("click", ()=>applyLang(t.dataset.lang));
  });

  // -------- Complex helpers ----------
  function c(re, im){ return {re, im}; }
  function cadd(a,b){ return c(a.re+b.re, a.im+b.im); }
  function csub(a,b){ return c(a.re-b.re, a.im-b.im); }
  function cmul(a,b){ return c(a.re*b.re - a.im*b.im, a.re*b.im + a.im*b.re); }
  function cdiv(a,b){
    const d = b.re*b.re + b.im*b.im;
    return c((a.re*b.re + a.im*b.im)/d, (a.im*b.re - a.re*b.im)/d);
  }
  function cinv(a){ return cdiv(c(1,0), a); }
  function cabs(a){ return Math.hypot(a.re, a.im); }
  function cfmt(a, unit=""){ // for display
    const re = a.re, im = a.im;
    const sRe = (Math.abs(re) < 1e-12) ? "0" : re.toPrecision(4);
    const sIm = (Math.abs(im) < 1e-12) ? "0" : im.toPrecision(4);
    return `${sRe} ${im>=0?"+":"-"} j${Math.abs(im).toPrecision(4)}${unit}`;
  }

  // -------- UI elements ----------
  const el = id => document.getElementById(id);
  const sliders = ["v1","f","c12","gleak","m","didt","zl","z2","e","eth"].map(el);

  function humanOhms(x){
    if(x>=1e6) return (x/1e6).toFixed(3).replace(/\.?0+$/,"") + " MÎ©";
    if(x>=1e3) return (x/1e3).toFixed(3).replace(/\.?0+$/,"") + " kÎ©";
    return x.toFixed(0) + " Î©";
  }
  function humanSiemens(x){ // S
    // display in nS/uS/mS if needed
    if(x>=1e-3) return (x/1e-3).toFixed(3).replace(/\.?0+$/,"") + " mS";
    if(x>=1e-6) return (x/1e-6).toFixed(3).replace(/\.?0+$/,"") + " ÂµS";
    if(x>=1e-9) return (x/1e-9).toFixed(3).replace(/\.?0+$/,"") + " nS";
    return x.toExponential(2)+" S";
  }
  function humanF(x){ // Farads
    if(x>=1e-6) return (x/1e-6).toFixed(3).replace(/\.?0+$/,"")+" ÂµF";
    if(x>=1e-9) return (x/1e-9).toFixed(3).replace(/\.?0+$/,"")+" nF";
    if(x>=1e-12) return (x/1e-12).toFixed(3).replace(/\.?0+$/,"")+" pF";
    return x.toExponential(2)+" F";
  }
  function humanH(x){
    if(x>=1e-3) return (x/1e-3).toFixed(3).replace(/\.?0+$/,"")+" mH";
    if(x>=1e-6) return (x/1e-6).toFixed(3).replace(/\.?0+$/,"")+" ÂµH";
    if(x>=1e-9) return (x/1e-9).toFixed(3).replace(/\.?0+$/,"")+" nH";
    return x.toExponential(2)+" H";
  }

  // Breakdown toy model: additional conductance when E>E_th
  function Gbd(E, Eth){
    if(E <= Eth) return 0;
    const x = (E - Eth) / Math.max(1, Eth);
    // steep rise (toy): scale to up to ~ 5e-6 S when far above threshold
    return 5e-6 * x * x;
  }

  function computeV2(params){
    const V1 = params.V1; // V peak
    const f  = params.f;
    const w  = 2*Math.PI*f;

    const C12 = params.C12;  // F
    const Gleak = params.Gleak; // S
    const M = params.M;      // H
    const didt = params.didt; // A/s peak

    const ZL = params.ZL; // ohms (assumed real)
    const Z2 = params.Z2; // ohms (assumed real)

    // include breakdown conductance
    const Gtotal = Gleak + Gbd(params.E, params.Eth);

    const Y12 = c(Gtotal, w*C12); // G + j*wC
    const invY = (Y12.re===0 && Y12.im===0) ? c(Infinity,0) : cinv(Y12);

    // Transfer through the channel: ZL / (ZL + 1/Y12)
    // treat ZL as complex real
    const ZLc = c(ZL, 0);
    const denom = cadd(ZLc, invY);
    const Hch = cdiv(ZLc, denom);

    const V2_cap = cmul(Hch, c(V1,0));

    // induced source amplitude from M * dI/dt
    const Vind = M * didt; // V peak
    const Hdiv = ZL / (ZL + Z2);
    const V2_ind = Vind * Hdiv;

    // total: vector sum (treat induced as in quadrature? unknown phase)
    // For a conservative amplitude estimate we compute RSS and also a coherent sum assuming same phase.
    const Vcap_mag = cabs(V2_cap);
    const Vtot_rss = Math.hypot(Vcap_mag, V2_ind);
    const Vtot_coh = Vcap_mag + Math.abs(V2_ind);

    return { Y12, V2_cap, Vcap_mag, V2_ind, Vtot_rss, Vtot_coh, Gtotal };
  }

  function riskLabel(params, out){
    // simple heuristic
    const leaky = out.Gtotal >= 1e-7; // 0.1 ÂµS
    const highCap = (2*Math.PI*params.f*params.C12) >= 1e-6; // imag admittance >= 1 ÂµS
    const highV2 = out.Vtot_rss >= 50; // volts
    const bd = Gbd(params.E, params.Eth) > 0;

    if(bd || highV2) return {txt: (LANG==="he")?"×’×‘×•×”":"High", cls:"danger"};
    if(leaky || highCap) return {txt: (LANG==="he")?"×‘×™× ×•× ×™":"Medium", cls:"warn"};
    return {txt: (LANG==="he")?"× ××•×š":"Low", cls:""};
  }

  function readParams(){
    const V1 = +el("v1").value;
    const f = +el("f").value;
    const C12 = (+el("c12").value) * 1e-12;   // pF -> F
    const Gleak = (+el("gleak").value) * 1e-9; // nS -> S
    const M = (+el("m").value) * 1e-9;        // nH -> H
    const didt = +el("didt").value;           // A/s
    const ZL = +el("zl").value;
    const Z2 = +el("z2").value;
    const E = +el("e").value;                 // V/mm
    const Eth = +el("eth").value;             // V/mm
    return {V1,f,C12,Gleak,M,didt,ZL,Z2,E,Eth};
  }

  function updateBadges(p){
    el("v1v").textContent = `${p.V1.toFixed(0)} V`;
    el("fv").textContent = `${p.f.toFixed(0)} Hz`;
    el("c12v").textContent = humanF(p.C12);
    el("gleakv").textContent = humanSiemens(p.Gleak);
    el("mv").textContent = humanH(p.M);
    el("didtv").textContent = `${p.didt.toFixed(0)} A/s`;
    el("zlv").textContent = humanOhms(p.ZL);
    el("z2v").textContent = humanOhms(p.Z2);
    el("ev").textContent = `${(p.E/1000).toFixed(3).replace(/\.?0+$/,"")} kV/mm`;
    el("ethv").textContent = `${(p.Eth/1000).toFixed(3).replace(/\.?0+$/,"")} kV/mm`;
  }

  // ---- plotting (simple axes) ----
  const canvas = el("plot");
  const ctx = canvas.getContext("2d");

  function drawPlot(p){
    // internal canvas size
    const dpr = window.devicePixelRatio || 1;
    const w = Math.floor(canvas.clientWidth * dpr);
    const h = Math.floor(canvas.clientHeight * dpr);
    if(canvas.width !== w || canvas.height !== h){ canvas.width = w; canvas.height = h; }

    // frequency sweep (log-ish)
    const fmin = 1;
    const fmax = Math.max(10, Math.min(200000, Math.max(10, p.f*2000 + 10)));
    const N = 140;

    const xs = [];
    const ys = [];
    let ymax = 1e-12;

    for(let i=0;i<N;i++){
      // log spacing
      const t = i/(N-1);
      const fi = fmin * Math.pow(fmax/fmin, t);
      const pi = {...p, f: fi};
      const out = computeV2(pi);
      const y = out.Vtot_rss;
      xs.push(fi);
      ys.push(y);
      ymax = Math.max(ymax, y);
    }

    // padding
    const padL = 58*dpr, padR = 18*dpr, padT = 18*dpr, padB = 42*dpr;
    ctx.clearRect(0,0,w,h);

    // axes
    ctx.globalAlpha = 0.9;
    ctx.lineWidth = 1*dpr;
    ctx.strokeStyle = "rgba(148,163,184,0.7)";
    ctx.beginPath();
    ctx.moveTo(padL, padT);
    ctx.lineTo(padL, h-padB);
    ctx.lineTo(w-padR, h-padB);
    ctx.stroke();

    // ticks + labels (no fixed colors requested; using default strokeStyle already)
    ctx.fillStyle = (getComputedStyle(document.documentElement).getPropertyValue("--muted") || "#64748b").trim();
    ctx.font = `${12*dpr}px ui-monospace, Menlo, Consolas, monospace`;

    const yTicks = 4;
    for(let i=0;i<=yTicks;i++){
      const yy = padT + (h-padB-padT)*(1 - i/yTicks);
      ctx.globalAlpha = 0.25;
      ctx.beginPath();
      ctx.moveTo(padL, yy);
      ctx.lineTo(w-padR, yy);
      ctx.stroke();
      ctx.globalAlpha = 0.9;
      const val = (ymax*i/yTicks);
      ctx.fillText(`${val.toPrecision(3)}V`, 6*dpr, yy+4*dpr);
    }

    const xTicks = 4;
    for(let i=0;i<=xTicks;i++){
      const t = i/xTicks;
      const fi = fmin * Math.pow(fmax/fmin, t);
      const xx = padL + (w-padR-padL)*t;
      ctx.globalAlpha = 0.25;
      ctx.beginPath();
      ctx.moveTo(xx, padT);
      ctx.lineTo(xx, h-padB);
      ctx.stroke();
      ctx.globalAlpha = 0.9;
      const lab = (fi>=1000) ? (fi/1000).toFixed(1)+"k" : fi.toFixed(0);
      ctx.fillText(lab+"Hz", xx-16*dpr, h-14*dpr);
    }

    // curve
    ctx.globalAlpha = 1;
    ctx.lineWidth = 2*dpr;
    ctx.strokeStyle = "rgba(99,102,241,0.95)";
    ctx.beginPath();
    for(let i=0;i<N;i++){
      const t = i/(N-1);
      const xx = padL + (w-padR-padL)*t;
      const yy = padT + (h-padB-padT)*(1 - ys[i]/ymax);
      if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
    }
    ctx.stroke();

    // marker at current f (if within range)
    const tf = Math.log(p.f/fmin)/Math.log(fmax/fmin);
    if(isFinite(tf) && tf>=0 && tf<=1){
      const out = computeV2(p);
      const xx = padL + (w-padR-padL)*tf;
      const yy = padT + (h-padB-padT)*(1 - out.Vtot_rss/ymax);
      ctx.fillStyle = "rgba(34,197,94,0.95)";
      ctx.beginPath();
      ctx.arc(xx, yy, 4.5*dpr, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function refresh(){
    const p = readParams();
    updateBadges(p);
    const out = computeV2(p);

    // outputs
    el("v2cap").textContent = `${out.Vcap_mag.toPrecision(4)} Vpk`;
    el("v2ind").textContent = `${Math.abs(out.V2_ind).toPrecision(4)} Vpk`;
    el("v2tot").textContent = `${out.Vtot_rss.toPrecision(4)} Vpk (RSS) â€¢ ${out.Vtot_coh.toPrecision(4)} Vpk (coh)`;
    el("y12").textContent = `${humanSiemens(out.Y12.re)} + j${humanSiemens(out.Y12.im)}`;

    const r = riskLabel(p, out);
    const riskEl = el("risk");
    riskEl.textContent = r.txt;
    riskEl.classList.remove("danger","warn");
    if(r.cls) riskEl.classList.add(r.cls);

    drawPlot(p);
  }

  sliders.forEach(s=>s.addEventListener("input", refresh));

  // presets
  el("presetHouse").addEventListener("click", ()=>{
    el("v1").value = 325;   // ~230Vrms peak
    el("f").value = 50;
    el("c12").value = 60;   // pF
    el("gleak").value = 5;  // nS
    el("m").value = 200;    // nH
    el("didt").value = 800; // A/s
    el("zl").value = 1000000;
    el("z2").value = 1000;
    el("e").value = 600;
    el("eth").value = 1500;
    refresh();
  });
  el("presetFast").addEventListener("click", ()=>{
    el("v1").value = 20;
    el("f").value = 50000;
    el("c12").value = 200;
    el("gleak").value = 0;
    el("m").value = 600;
    el("didt").value = 80000;
    el("zl").value = 50000;
    el("z2").value = 100;
    el("e").value = 800;
    el("eth").value = 2000;
    refresh();
  });
  el("presetWet").addEventListener("click", ()=>{
    el("v1").value = 325;
    el("f").value = 50;
    el("c12").value = 80;
    el("gleak").value = 1200; // 1.2 ÂµS
    el("m").value = 250;
    el("didt").value = 1200;
    el("zl").value = 200000;
    el("z2").value = 1000;
    el("e").value = 1200;
    el("eth").value = 1500;
    refresh();
  });

  // KaTeX render
  window.addEventListener("load", () => {
    try{
      renderMathInElement(document.body, {
        delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "\\(", right: "\\)", display: false},
          {left: "\\[", right: "\\]", display: true}
        ]
      });
    }catch(e){}
    refresh();
  });

  // initial lang
  applyLang("he");
</script>
</body>
</html>
