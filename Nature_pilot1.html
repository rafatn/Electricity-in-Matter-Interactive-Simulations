<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>××•×“×œ â€œ×˜×‘×¢ ×”×—×•××¨ ×”××¤×œâ€ â€” ××¨×—×‘×™ ××¡×œ×•×œ×™×, ×¦×‘×™×¨×™× ×›â€œ×“×’ ×˜×•×¨×£â€, ×•×¢×“×©×•×ª ×›×‘×™×“×”</title>
  <meta name="color-scheme" content="light dark">

  <!-- (××•×¤×¦×™×•× ×œ×™) KaTeX ×œ×”×¦×’×ª × ×•×¡×—××•×ª ×™×¤×” -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

  <style>
    :root{
      --bg0:#f4f6fb; --bg1:#eef2ff; --bg2:#ecfeff;
      --card:rgba(255,255,255,.82);
      --card2:rgba(255,255,255,.60);
      --text:#0f172a; --muted:#64748b; --head:#0b1220;
      --line:rgba(148,163,184,.35);
      --shadow: 0 18px 50px rgba(2,6,23,.10);
      --r:18px;
      --accent:#6366f1;
      --ok:#16a34a;
      --warn:#f59e0b;
      --danger:#ef4444;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Hebrew", "Noto Sans", sans-serif;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg0:#0b1220; --bg1:#0f172a; --bg2:#0b1220;
        --card:rgba(17,24,39,.72);
        --card2:rgba(17,24,39,.52);
        --text:#e5e7eb; --muted:#9ca3af; --head:#f9fafb;
        --line:rgba(148,163,184,.18);
        --shadow: 0 18px 55px rgba(0,0,0,.55);
        --accent:#a5b4fc;
      }
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1200px 650px at 90% 0%, var(--bg2), transparent 60%),
        radial-gradient(1000px 600px at 10% 10%, var(--bg1), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:22px 16px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    .topRow{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{
      margin:0;
      font-size:clamp(20px, 2.4vw, 34px);
      letter-spacing:.2px;
      color:var(--head);
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      max-width:820px;
      line-height:1.45;
      font-size:14px;
    }
    .chips{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .chip{
      padding:7px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:linear-gradient(180deg, var(--card), var(--card2));
      box-shadow:var(--shadow);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    main{max-width:1200px; margin:0 auto; padding:12px 16px 90px}
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      overflow:hidden;
    }
    .card h2{
      margin:0 0 8px;
      font-size:18px;
      color:var(--head);
      display:flex; gap:10px; align-items:center;
    }
    .card p{margin:8px 0; color:var(--text); line-height:1.6}
    .muted{color:var(--muted)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .hr{height:1px; background:var(--line); margin:12px 0}

    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 560px){ .controls{grid-template-columns:1fr} }
    label{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:13px;
      color:var(--muted);
    }
    select, input[type="range"], input[type="number"], button{
      font-family:var(--font);
    }
    select, input[type="number"]{
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.55);
      color:var(--text);
      outline:none;
    }
    @media (prefers-color-scheme: dark){
      select, input[type="number"]{ background:rgba(17,24,39,.45) }
    }
    input[type="range"]{ width:100% }
    .btn{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(99,102,241,.18), rgba(99,102,241,.08));
      color:var(--text);
      cursor:pointer;
      transition:transform .05s ease, filter .2s ease;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:linear-gradient(180deg, rgba(148,163,184,.20), rgba(148,163,184,.08));
    }
    .btn.ok{
      background:linear-gradient(180deg, rgba(22,163,74,.18), rgba(22,163,74,.08));
    }

    .canvasWrap{
      position:relative;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.35);
      overflow:hidden;
      min-height:320px;
    }
    @media (prefers-color-scheme: dark){ .canvasWrap{ background:rgba(17,24,39,.35) } }
    canvas{ display:block; width:100%; height:360px; }
    .badge{
      position:absolute;
      top:10px; inset-inline-end:10px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.65);
      font-size:12px;
      color:var(--muted);
      backdrop-filter: blur(8px);
    }
    @media (prefers-color-scheme: dark){ .badge{ background:rgba(17,24,39,.55) } }

    .katexBox{
      border:1px dashed var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.28);
    }
    @media (prefers-color-scheme: dark){ .katexBox{ background:rgba(17,24,39,.28) } }
    pre{
      margin:10px 0 0;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.05);
      overflow:auto;
      font-family:var(--mono);
      font-size:12.5px;
      line-height:1.55;
      direction:ltr;
      text-align:left;
    }
    @media (prefers-color-scheme: dark){ pre{ background:rgba(0,0,0,.25) } }

    footer{
      position:fixed; left:0; right:0; bottom:0;
      padding:10px 16px;
      background:linear-gradient(180deg, rgba(255,255,255,.00), rgba(255,255,255,.70));
      border-top:1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
    }
    @media (prefers-color-scheme: dark){
      footer{ background:linear-gradient(180deg, rgba(15,23,42,.00), rgba(15,23,42,.70)); }
    }
    .footInner{max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:12px}
    .warnNote{color:var(--muted); font-size:12.5px; line-height:1.55}
    .mini{
      font-size:12px; color:var(--muted);
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .dot{width:6px; height:6px; border-radius:999px; background:var(--accent); display:inline-block}
  </style>
</head>

<body>
<header>
  <div class="topRow">
    <div class="title">
      <h1>×˜×‘×¢ ×”×—×•××¨ ×”××¤×œ â€” ××•×“×œ â€œ××¨×—×‘×™ ××¡×œ×•×œ×™×â€ (Loop Spaces)</h1>
      <p class="subtitle">
        ××ª×” ×”×’×“×¨×ª ××ª ×¢×§×•××•×ª ×”×¡×™×‘×•×‘ ×›×©×œ×•×© ×§×˜×’×•×¨×™×•×ª ×‘×¡×™×¡×™×•×ª: <b>×¢×™×’×•×œ</b>, <b>××œ×™×¤×¡×”</b>, ×•-<b>××¡×œ×•×œ ×›×œ×œ×™</b> (×›×•×œ×œ × ×§×•×“×•×ª/×§×˜×¢×™×) ×©××•×’×“×¨ ×›×´×¡×™×‘×•×‘×´ ×× × ×§×•×“×ª ×”×”×ª×—×œ×” ×–×”×” ×œ× ×§×•×“×ª ×”×¡×•×£.
        ×›××Ÿ ×–×” ×× ×•×¡×— ×›××•×“×œ ×××•×—×“ ×©××—×‘×¨ ×’× <b>×¦×‘×™×¨×™ ×’×œ×§×¡×™×•×ª</b> (×›×´×“×’ ×˜×•×¨×£×´ ×”×©×•×—×” ×‘××“×™×•×) ×•×’× <b>×¢×“×©×•×ª ×›×‘×™×“×”</b> (×›×˜×¨× ×¡×¤×•×¨××¦×™×” ×¢×œ ××¡×œ×•×œ×™×).
      </p>
    </div>

    <div class="chips">
      <span class="chip">ğŸŒ€ ×¢×§×•××•×ª ×¡×™×‘×•×‘ ×¡×’×•×¨×•×ª</span>
      <span class="chip">ğŸ§© 3 ××¨×—×‘×™× ×•×§×˜×•×¨×™×™×</span>
      <span class="chip">ğŸŸ ×¦×‘×™×¨×™× ×›×´×©×—×™×™×”×´</span>
      <span class="chip">ğŸ” ×¢×“×©×ª ×›×‘×™×“×” = ×¢×™×•×•×ª ××¡×œ×•×œ</span>
      <span class="chip">âœˆï¸ ×›×‘×™×“×” ××¤×§×˜×™×‘×™×ª + ×¡×‘×™×‘×”</span>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- LEFT: Interactive demo -->
    <section class="card">
      <h2>×”×“×’××” ××™× ×˜×¨××§×˜×™×‘×™×ª: ××¡×œ×•×œ×™× + ×¢×§×•××ª ×¡×™×‘×•×‘ + ×¢×“×©×”</h2>
      <p class="muted">
        ×‘×—×¨ ×¡×•×’ ××¡×œ×•×œ (×¢×™×’×•×œ/××œ×™×¤×¡×”/××¡×œ×•×œ ×›×œ×œ×™), ×•××– ×©×—×§ ×¢× ×”×¤×¨××˜×¨×™×:
        <b>â€œ×¢×•×¦××ª ×—×•××¨ ××¤×œâ€</b> ××©×¤×™×¢×” ×¢×œ ×¢×§×•××ª ×”×¡×™×‘×•×‘ ×”××ª×§×‘×œ×ª (×§×•× ×¡×¤×˜×•××œ×™×ª),
        ×•-<b>â€œ×¢×“×©×ª ×›×‘×™×“×”â€</b> ××¢×•×•×ª×ª ××ª ×”××¨×—×‘ ×•×œ×›×Ÿ ×’× ××ª ×”××¡×œ×•×œ ×•××ª â€œ×”×ª××•× ×”â€ ×”× ×¦×¤×™×ª.
      </p>

      <div class="controls">
        <label>
          ×¡×•×’ ××¡×œ×•×œ (×”××¨×—×‘ ×”×•×•×§×˜×•×¨×™)
          <select id="orbitType">
            <option value="circle">Vâˆ˜ â€” ××¡×œ×•×œ×™× ××¢×’×œ×™×™×</option>
            <option value="ellipse">Vellipse â€” ××¡×œ×•×œ×™× ××œ×™×¤×˜×™×™×</option>
            <option value="loop">Vloop â€” ××¡×œ×•×œ ×›×œ×œ×™/××§×•×˜×¢ (×œ×•×œ××”)</option>
          </select>
        </label>

        <label>
          ×¨×“×™×•×¡ ×‘×¡×™×¡ r
          <input id="radius" type="range" min="40" max="150" value="95" />
        </label>

        <label>
          ××§×¡×¦× ×˜×¨×™×•×ª (×¨×§ ××œ×™×¤×¡×”) e
          <input id="ecc" type="range" min="0" max="85" value="35" />
        </label>

        <label>
          ××•×¨×›×‘×•×ª (×¨×§ ×œ×•×œ××” ×›×œ×œ×™×ª)
          <input id="complex" type="range" min="1" max="10" value="5" />
        </label>

        <label>
          â€œ×¢×•×¦××ª ×—×•××¨ ××¤×œâ€ (DM gain)
          <input id="dm" type="range" min="0" max="100" value="55" />
        </label>

        <label>
          â€œ×¢×“×©×ª ×›×‘×™×“×”â€ (×¢×•×¦××ª ×¢×™×•×•×ª)
          <input id="lens" type="range" min="0" max="100" value="25" />
        </label>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn ok" id="btnPlay">â–¶ï¸ ×”×¤×¢×œ/×¢×¦×•×¨</button>
        <button class="btn secondary" id="btnReseed">ğŸ² ××¡×œ×•×œ ×—×“×© (×œ×•×œ××”)</button>
        <button class="btn secondary" id="btnReset">â†º ××™×¤×•×¡ ×¤×¨××˜×¨×™×</button>
        <span class="mini"><span class="dot"></span>×˜×™×¤: ×”×’×“×œ DM ×›×“×™ ×œ×“××•×ª â€œ×¢×§×•××” ×©×˜×•×—×”â€ ×™×•×ª×¨</span>
      </div>

      <div class="hr"></div>

      <div class="canvasWrap">
        <div class="badge" id="badge">××¦×‘: ×¨×™×¦×”</div>
        <canvas id="cv" width="1100" height="360"></canvas>
      </div>

      <p class="warnNote" style="margin-top:10px;">
        âš ï¸ ×”×”×“×’××” ×›××Ÿ ×”×™× <b>××•×“×œ ×¨×¢×™×•× ×™</b> ×©×××—×™×© ××ª ×”×’××•××˜×¨×™×”/×˜×•×¤×•×œ×•×’×™×” ×•××ª ×¨×¢×™×•×Ÿ â€œ×”××¨×—×‘×™×â€.
        ×”×™× ×œ× ××—×œ×™×¤×” ×—×™×©×•×‘ ××¡×˜×¨×•×¤×™×–×™ ××œ× (N-body / GR lensing).
      </p>
    </section>

    <!-- RIGHT: Explanation from start -->
    <section class="card">
      <h2>×”×¡×‘×¨ ××œ× ××”×ª×—×œ×”: ×”× ×—×•×ª, ×”×’×“×¨×•×ª, ×•××” â€œ×—×•××¨ ××¤×œâ€ ××•××¨ ×‘××•×“×œ</h2>

      <p>
        <b>×¨×¢×™×•×Ÿ ×™×¡×•×“:</b> ×‘××§×•× ×œ×”×ª×—×™×œ ×â€œ××¡×” ×—×¡×¨×”â€, ××ª×” ××ª×—×™×œ ×××” ×©× ××“×“ ×‘×¤×•×¢×œ:
        <b>××¡×œ×•×œ×™ ×¡×™×‘×•×‘</b> ×•×¢×§×•××•×ª \(v(r)\) ×‘×’×œ×§×¡×™×•×ª.
        ××ª×” ××¦×™×¢ ×œ×ª××¨ ××ª â€œ×˜×‘×¢ ×”×—×•××¨ ×”××¤×œâ€ ×›×—×‘×•×¨×”/××¨×—×‘ ×©×œ <b>××¡×œ×•×œ×™× ×¡×’×•×¨×™×</b> (Loops),
        ×©×‘×ª×•×›×” ×™×© <b>×©×œ×•×©×” ××¨×—×‘×™× ×•×§×˜×•×¨×™×™×</b> ×”××™×™×¦×’×™× ×˜×™×¤×•×¡×™ ××¡×œ×•×œ×™× ×©×•× ×™×.
      </p>

      <div class="katexBox">
        <p style="margin:0 0 8px;"><b>1) ×”×’×“×¨×ª ×¡×™×‘×•×‘ ×›×œ×•×œ××” (Loop)</b></p>
        <p style="margin:0">
          ×¢×§×•××” \(\gamma\) ×”×™× â€œ×¡×™×‘×•×‘â€ ×× ×”×™× ××ª×—×™×œ×” ×•××¡×ª×™×™××ª ×‘××•×ª×” × ×§×•×“×”:
          <span class="math">
            \[
              \gamma:[0,1]\to \mathbb{R}^3,\qquad \gamma(0)=\gamma(1)
            \]
          </span>
          ×œ×›×Ÿ ××•×¡×£ ×›×œ â€œ×”×¡×™×‘×•×‘×™×â€ ×”×•×:
          <span class="math">
            \[
              \mathcal{G}_{DM}=\{\gamma\mid \gamma(0)=\gamma(1)\}
            \]
          </span>
          (××¤×©×¨ ×œ×—×©×•×‘ ×¢×œ ×–×” ×›×—×‘×•×¨×” ×ª×—×ª ×—×™×‘×•×¨ ××¡×œ×•×œ×™×/×”×“×‘×§×”.)
        </p>
      </div>

      <div class="hr"></div>

      <p style="margin-top:0"><b>2) ×©×œ×•×©×ª ×”××¨×—×‘×™× ×”×•×•×§×˜×•×¨×™×™× ×‘×ª×•×š \(\mathcal{G}_{DM}\)</b></p>
      <p class="muted" style="margin-top:0">
        ×›××Ÿ â€œ××¨×—×‘ ×•×§×˜×•×¨×™â€ ×”×•× ×“×¨×š ×œ×¡×•×•×’/×œ×¤×¨××˜ ××©×¤×—×•×ª ××¡×œ×•×œ×™× â€” ×‘×”×ª×× ×œ×’×™××•××˜×¨×™×” ×•×œ×¤×¨××˜×¨×™× ×©× ×•×—×™× ×œ×ª×™××•×¨.
      </p>

      <p>
        <b>Vâˆ˜ â€” ××¢×’×œ×™× (×§×•××•×¨×“×™× ×˜×•×ª ×›×“×•×¨×™×•×ª):</b>
        ××•×¡×£ ××¡×œ×•×œ×™× ×¢× ×¨×“×™×•×¡ ×§×‘×•×¢ ×‘××™×©×•×¨ ×”××©×•×•×” (×‘×§×™×¨×•×‘):
        <span class="math">\[
          V_{\circ}=\{\gamma\in\mathcal{G}_{DM}\mid r=\text{const}\}
        \]</span>
      </p>

      <p>
        <b>Vellipse â€” ××œ×™×¤×¡×•×ª (×§×•××•×¨×“×™× ×˜×•×ª ××œ×™×¤×˜×™×•×ª):</b>
        ××•×¡×£ ××¡×œ×•×œ×™× ×¢× ×¦×™×¨×™ \(a\neq b\), ×›×œ×•××¨ ××™-×¡×™××˜×¨×™×” ×’××•××˜×¨×™×ª:
        <span class="math">\[
          V_{\text{ellipse}}=\{\gamma\in\mathcal{G}_{DM}\mid a\neq b\}
        \]</span>
      </p>

      <p>
        <b>Vloop â€” ××¡×œ×•×œ×™× ×›×œ×œ×™×™×/×‘×“×™×“×™×:</b>
        × ×§×•×“×•×ª/×§×˜×¢×™×/××¡×œ×•×œ×™× ××§×•×˜×¢×™× ×©× ×™×ª× ×™× ×œ×—×™×‘×•×¨ ×œ×¢×§×•××” ×¡×’×•×¨×”:
        <span class="math">\[
          V_{\text{loop}}=\{\gamma=\cup_i p_i \ \mid\ \exists\ \text{×—×™×‘×•×¨}\Rightarrow \gamma(0)=\gamma(1)\}
        \]</span>
        ×–×”×• â€œ××¨×—×‘ ×”×¡×™×‘×•×‘×™× ×”×›×œ×œ×™â€, ×•×”×•× ×××¤×©×¨ ×’× ×“×™× ××™×§×” â€œ×“××•×™×ª-×¨×¢×©â€, ×¡×˜×™×•×ª, ××§×˜×¢×™×, ×•×ª× ×•×¢×” ××•×¨×›×‘×ª.
      </p>

      <div class="hr"></div>

      <p>
        <b>3) ×¦×‘×™×¨×™ ×’×œ×§×¡×™×•×ª ×›â€œ×“×’ ×˜×•×¨×£â€ (×©×—×™×™×” ×‘××“×™×•×):</b><br>
        ×‘××•×“×œ ×©×œ×š â€” ×©×“×” ×”×—×•××¨ ×”××¤×œ ×”×•× ×›××• â€œ×™×â€,
        ×•×¦×‘×™×¨ ×”×•× ×›××• â€œ×“×’â€ ×©××•×ª×¨ ×œ×• ×œ×©×—×•×ª ×‘×•.
        ×›×œ×•××¨ ×”××¡×œ×•×œ ×©×œ ×¦×‘×™×¨ ××™× ×• ×—×™×™×‘ ×œ×”×™×•×ª ×¢×™×’×•×œ/××œ×™×¤×¡×” ×¤×©×•×˜×™×,
        ××œ× ×ª× ×•×¢×” ××“×¤×˜×™×‘×™×ª ×‘×ª×•×š ×©×“×”:
        <span class="math">\[
          \dot{\mathbf{x}}=\nabla\Phi_{DM}+\mathbf{v}_{\text{active}}
        \]</span>
      </p>

      <p>
        <b>4) ×¢×“×©×•×ª ×›×‘×™×“×”:</b><br>
        ×¢×“×©×” ×”×™× ×œ× â€œ×©×‘×™×¨×”â€ ×¨×’×™×œ×” â€” ××œ× <b>×¢×™×•×•×ª ×©×œ ×”××˜×¨×™×§×”/×”××¨×—×‘</b>.
        ×œ×›×Ÿ, ×‘××•× ×—×™ ××¡×œ×•×œ×™×: ×”×™× ××¤×¢×™×œ×” ×˜×¨× ×¡×¤×•×¨××¦×™×” ×¢×œ \(\gamma\) ×•× ×•×ª× ×ª \(\gamma'\).
        ×‘×”×“×’××”, â€œLens strengthâ€ ×¢×•×©×” ×‘×“×™×•×§ ××ª ×–×”: ××¢×•×•×ª ××ª ×”××¨×—×‘ ×•××– ××¦×™×™×¨ ××—×“×©.
      </p>

      <div class="hr"></div>

      <p>
        <b>5) ×”×¢×¨×ª ×”××“× ×‘××˜××•×¡×¤×¨×” ×•×›×‘×™×“×” ××¤×§×˜×™×‘×™×ª:</b><br>
        ××ª×” ××¦×‘×™×¢ ×¢×œ ×¨×¢×™×•×Ÿ â€œ××§×“× ×›×‘×™×“×” ××¤×§×˜×™×‘×™â€ ×©×ª×œ×•×™ ×‘×¡×‘×™×‘×”.
        ×‘×¤×™×–×™×§×” ×™×© ×©× ×™ ×¨×›×™×‘×™× ××©××¢×•×ª×™×™× ×‘×’×•×‘×”: ×™×¨×™×“×” ×§×œ×” ×‘-\(g\) ×¢× ×”×’×•×‘×”, ×•×™×¨×™×“×” ×—×“×” ×‘×¦×¤×™×¤×•×ª ×”××•×•×™×¨ (×©××©× ×” ×’×¨×¨/× ×©×™××”/×ª× ××™ ×¨×™×—×•×£).
        ×‘××•×“×œ ×¨×¢×™×•× ×™ ××¤×©×¨ ×œ×›×ª×•×‘:
        <span class="math">\[
          g_{\text{eff}}(h)\approx g(h)\cdot f(\rho(h))
        \]</span>
        ×›×œ×•××¨: ××” ×©× ×¨××” ×›â€œ×©×™× ×•×™ ×™×›×•×œ×ªâ€ (× ×©×™××”/×ª× ×•×¢×”/×¨×™×—×•×£) ×”×•× ×©×™×œ×•×‘ ×©×œ ×©×“×”+××“×™×•×.
      </p>

      <p class="muted">
        ×‘×©×•×¨×” ×”×ª×—×ª×•× ×”: ××ª×” ××¦×™×¢ ×©â€œ×—×•××¨ ××¤×œâ€ ×”×•× ×œ× ×¨×§ â€œ××¡×” ×—×¡×¨×”â€,
        ××œ× <b>××‘× ×” ×©××’×“×™×¨ ××™×œ×• ×¡×™×‘×•×‘×™×/××¡×œ×•×œ×™× ×™×¦×™×‘×™×/××•×ª×¨×™×</b> ×‘×¢×•×œ× ×”××¡×˜×¨×•× ×•××™,
        ×•×©××•×ª×• ×¨×¢×™×•×Ÿ (â€œ×ª× ×•×¢×” ×‘××“×™×•×â€) ×™×›×•×œ ×œ×©××© ×× ×œ×•×’×™×” ×’× ×‘×¡×§××œ×” ×©×œ ××•×•×™×¨/×˜×™×¡×”.
      </p>
    </section>

    <!-- Additional card: How to read the plots -->
    <section class="card">
      <h2>××™×š ×œ×§×¨×•× ××ª ×”×”×“×’××”</h2>
      <p>
        <b>×‘×¦×™×•×¨:</b>
        ×”×§×• ×”×œ×‘×Ÿ ×”×•× ×”××¡×œ×•×œ, ×•×”× ×§×•×“×” ×”×™× ×”×’×•×£ ×”× ×¢ ×¢×œ×™×•.
        <b>×‘×’×¨×£ ×”×¤× ×™××™ (×™××™×Ÿ-×œ××˜×”):</b>
        ××•×¦×’×ª â€œ×¢×§×•××ª ×¡×™×‘×•×‘â€ ×¨×¢×™×•× ×™×ª \(v(r)\).
      </p>
      <p class="muted">
        ×‘×“×’× ×–×”: ×”×’×“×œ×ª DM ×’×•×¨××ª ×œ×¨×›×™×‘ ×©××“××” â€œ×ª×¨×•××” × ×•×¡×¤×ªâ€ ×œ××”×™×¨×•×ª ×¡×™×‘×•×‘,
        ×•×œ×›×Ÿ ×œ×¢×™×ª×™× ××ª×§×‘×œ ×§×˜×¢ â€œ×©×˜×•×— ×™×•×ª×¨â€ â€” ×›×¤×™ ×©××“×‘×¨×™× ×¢×œ ×¢×§×•××•×ª ×¡×™×‘×•×‘ ×‘×’×œ×§×¡×™×•×ª (×‘×”×§×©×¨ ×”×§×œ××¡×™ ×©×œ ×—×•××¨ ××¤×œ).
      </p>
      <pre><b>×”×¢×¨×” ×˜×›× ×™×ª</b>
- Circle: r ×§×‘×•×¢.
- Ellipse: r ××©×ª× ×” ×œ×¤×™ ×–×•×•×™×ª (×‘××•×¤×Ÿ ××œ×™×¤×˜×™).
- Loop: ××¡×œ×•×œ ××•×¨×›×‘ ××”×¨××•× ×™×•×ª + â€œ× ×§×•×“×•×ª ×¢×–×¨â€ (reseeding).
- Lens: ××‘×¦×¢ ××™×¤×•×™ (x,y)â†’(x',y') ×”××“××” ×¢×™×•×•×ª ××¨×—×‘.</pre>
    </section>

    <!-- Extra: cluster fish demo -->
    <section class="card">
      <h2>×”×“×’××” × ×•×¡×¤×ª: ×¦×‘×™×¨ ×›â€œ×“×’â€ (×©×—×™×™×” ×‘×™× ×”×—×•××¨ ×”××¤×œ)</h2>
      <p class="muted">
        ×›××Ÿ ×× ×—× ×• ××¦×™×™×¨×™× ××¡×œ×•×œ â€œ××§×˜×™×‘×™â€: ×”×’×•×£ ××©× ×” ×›×™×•×•×Ÿ ×›××™×œ×• ×”×•× â€œ×©×•×—×”â€ ×‘×ª×•×š ×©×“×”.
        ×–×” ×××—×™×© ××ª ×”×¨×¢×™×•×Ÿ ×©×œ×š ×©×¦×‘×™×¨×™× ×œ× ×—×™×™×‘×™× ××¡×œ×•×œ ××œ×’× ×˜×™ ××—×“ (×¢×™×’×•×œ/××œ×™×¤×¡×”).
      </p>

      <div class="controls">
        <label>
          ×“×¨×’×ª â€œ×©×—×™×™×”â€ (Active)
          <input id="swim" type="range" min="0" max="100" value="55" />
        </label>
        <label>
          ×—×•×–×§ ×–×¨× ×©×“×” (âˆ‡Î¦DM)
          <input id="field" type="range" min="0" max="100" value="45" />
        </label>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn ok" id="btnFish">ğŸŸ ×”×¤×¢×œ/×¢×¦×•×¨ ×“×’</button>
        <button class="btn secondary" id="btnFishReset">â†º ××™×¤×•×¡ ××¡×œ×•×œ ×“×’</button>
      </div>

      <div class="hr"></div>

      <div class="canvasWrap">
        <div class="badge" id="badgeFish">××¦×‘: ×¨×™×¦×”</div>
        <canvas id="cvFish" width="1100" height="360"></canvas>
      </div>
    </section>

  </div>
</main>

<footer>
  <div class="footInner">
    <div>×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª Â© | ××™×Ÿ ×œ×©×›×¤×œ ××œ× ×‘××™×©×•×¨ ×Ö¾RA â€” <a href="mailto:Raftn4@gmail.com">Raftn4@gmail.com</a></div>
    <div>×’×¨×¡×”: v1.0 | HTML ×™×—×™×“ + ×”×“×’××•×ª Canvas + KaTeX (××•×¤×¦×™×•× ×œ×™)</div>
  </div>
</footer>

<script>
/* =========================
   Utilities
========================= */
function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
function lerp(a,b,t){ return a + (b-a)*t; }
function rand(a,b){ return a + Math.random()*(b-a); }
function hypot(x,y){ return Math.sqrt(x*x+y*y); }
function now(){ return performance.now(); }

/* High-DPI canvas helper */
function setupCanvas(canvas){
  const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
  const rect = canvas.getBoundingClientRect();
  const w = Math.round(rect.width * dpr);
  const h = Math.round(rect.height * dpr);
  if(canvas.width !== w || canvas.height !== h){
    canvas.width = w; canvas.height = h;
  }
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return ctx;
}

function themeColors(){
  const cs = getComputedStyle(document.documentElement);
  return {
    text: cs.getPropertyValue('--text').trim(),
    muted: cs.getPropertyValue('--muted').trim(),
    head: cs.getPropertyValue('--head').trim(),
    line: cs.getPropertyValue('--line').trim(),
    accent: cs.getPropertyValue('--accent').trim(),
    ok: cs.getPropertyValue('--ok').trim(),
    warn: cs.getPropertyValue('--warn').trim(),
    danger: cs.getPropertyValue('--danger').trim(),
    bg: cs.getPropertyValue('--card').trim(),
  };
}

function drawGrid(ctx, w, h){
  const c = themeColors();
  ctx.save();
  ctx.globalAlpha = 0.25;
  ctx.strokeStyle = c.line;
  ctx.lineWidth = 1;
  const step = 40;
  for(let x=0; x<=w; x+=step){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke();
  }
  for(let y=0; y<=h; y+=step){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke();
  }
  ctx.restore();
}

/* =========================
   Orbit demo
========================= */
const cv = document.getElementById('cv');
const badge = document.getElementById('badge');

const elType = document.getElementById('orbitType');
const elR = document.getElementById('radius');
const elE = document.getElementById('ecc');
const elC = document.getElementById('complex');
const elDM = document.getElementById('dm');
const elLens = document.getElementById('lens');

const btnPlay = document.getElementById('btnPlay');
const btnReseed = document.getElementById('btnReseed');
const btnReset = document.getElementById('btnReset');

let running = true;
let t0 = now();
let loopSeed = 1;
let loopPts = [];

function reseedLoop(){
  loopSeed++;
  const n = 14 + Math.floor(Number(elC.value))*2;
  loopPts = [];
  for(let i=0;i<n;i++){
    // points on a noisy ring; later interpolated
    const ang = (i/n)*Math.PI*2;
    const rr = Number(elR.value) * (0.65 + 0.55*Math.random());
    loopPts.push({
      a: ang,
      r: rr,
      j: rand(-0.35,0.35)
    });
  }
  // ensure closure: copy first point style at end (implicit)
}

reseedLoop();

function lensMap(x,y, strength){
  // strength: 0..1
  // A simple â€œgravitational lensâ€ mapping: radial squeeze + swirl near center
  const r = hypot(x,y);
  const k = 0.0009 * (strength*strength) * 900; // scaled
  const s = 1 - k / (1 + r*r/90000);            // squeeze
  const swirl = (strength*0.9) * (1/(1 + r*r/70000));
  const ang = Math.atan2(y,x) + swirl;
  const rr = r * s;
  return { x: rr*Math.cos(ang), y: rr*Math.sin(ang) };
}

function orbitPoint(type, theta){
  const R = Number(elR.value);
  const e = Number(elE.value)/100; // 0..0.85
  const comp = Number(elC.value);

  if(type === 'circle'){
    return { x: R*Math.cos(theta), y: R*Math.sin(theta), r: R };
  }
  if(type === 'ellipse'){
    // ellipse param: a=R, b=R*(1-e)
    const a = R;
    const b = R*(1 - e);
    const x = a*Math.cos(theta);
    const y = b*Math.sin(theta);
    return { x, y, r: hypot(x,y) };
  }
  // loop: build from harmonics + control points
  const h1 = 0.18*comp, h2 = 0.10*comp, h3 = 0.06*comp;
  let rr = R*(0.78
    + h1*Math.sin(theta + 0.7*loopSeed)
    + h2*Math.sin(2*theta + 1.3*loopSeed)
    + h3*Math.sin(3*theta - 0.9*loopSeed)
  );

  // add â€œpiecewiseâ€ bumps from loopPts
  if(loopPts.length){
    const u = (theta%(Math.PI*2)) / (Math.PI*2);
    const idx = Math.floor(u * loopPts.length);
    const p = loopPts[idx];
    rr *= (1 + 0.22*p.j);
  }
  return { x: rr*Math.cos(theta), y: rr*Math.sin(theta), r: rr };
}

function rotationCurve(r, dmGain){
  // A conceptual curve: baryonic rises then decays; DM term flattens.
  // r: 0..Rmax
  const Rmax = 220;
  const x = r / Rmax;

  // baryonic: rises quickly, then slowly decays
  const vB = 0.95*(1 - Math.exp(-6*x)) * Math.exp(-0.35*x);

  // DM: saturating term that increases at large r to flatten
  const g = dmGain; // 0..1
  const vDM = g * (1 - Math.exp(-2.8*x));

  // combine (not physically exact): v = sqrt(vB^2 + vDM^2)
  const v = Math.sqrt(vB*vB + vDM*vDM);
  return v;
}

function drawOrbitScene(){
  const ctx = setupCanvas(cv);
  const rect = cv.getBoundingClientRect();
  const W = rect.width, H = rect.height;

  ctx.clearRect(0,0,W,H);
  drawGrid(ctx, W, H);

  const c = themeColors();
  const cx = W*0.38, cy = H*0.52;
  const type = elType.value;
  const dmGain = Number(elDM.value)/100;
  const lensStrength = Number(elLens.value)/100;

  // axes / center
  ctx.save();
  ctx.strokeStyle = c.line;
  ctx.globalAlpha = 0.55;
  ctx.beginPath(); ctx.moveTo(cx-220, cy); ctx.lineTo(cx+220, cy); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx, cy-220); ctx.lineTo(cx, cy+220); ctx.stroke();
  ctx.restore();

  // orbit path
  ctx.save();
  ctx.lineWidth = 2.25;
  ctx.strokeStyle = c.text;
  ctx.globalAlpha = 0.92;
  ctx.beginPath();
  const N = 700;
  for(let i=0;i<=N;i++){
    const th = (i/N)*Math.PI*2;
    const p0 = orbitPoint(type, th);

    // lens mapping around center
    const L = lensMap(p0.x, p0.y, lensStrength);
    const X = cx + L.x;
    const Y = cy + L.y;

    if(i===0) ctx.moveTo(X,Y);
    else ctx.lineTo(X,Y);
  }
  ctx.stroke();
  ctx.restore();

  // moving point
  const tt = running ? ((now()-t0)/1000) : ((tFreeze - t0)/1000);
  const speed = 0.8 + 1.4*dmGain; // conceptual: DM increases stable speed
  const th = (tt*speed)%(Math.PI*2);
  const p = orbitPoint(type, th);
  const Lp = lensMap(p.x, p.y, lensStrength);
  const Xp = cx + Lp.x, Yp = cy + Lp.y;

  ctx.save();
  ctx.fillStyle = c.accent;
  ctx.beginPath();
  ctx.arc(Xp, Yp, 6, 0, Math.PI*2);
  ctx.fill();

  // â€œtailâ€
  ctx.globalAlpha = 0.35;
  ctx.beginPath();
  ctx.arc(Xp, Yp, 14, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // small legend
  ctx.save();
  ctx.fillStyle = c.muted;
  ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
  ctx.fillText(
    `××¡×œ×•×œ: ${type==='circle'?'Vâˆ˜ (××¢×’×œ)': type==='ellipse'?'Vellipse (××œ×™×¤×¡×”)':'Vloop (×›×œ×œ×™)'}  |  DM=${Math.round(dmGain*100)}%  |  Lens=${Math.round(lensStrength*100)}%`,
    14, 18
  );
  ctx.restore();

  // rotation curve panel
  const px = W*0.70, py = H*0.12, pw = W*0.27, ph = H*0.76;
  drawRotationPanel(ctx, px, py, pw, ph, dmGain);
}

function drawRotationPanel(ctx, x, y, w, h, dmGain){
  const c = themeColors();
  // panel background
  ctx.save();
  ctx.globalAlpha = 0.85;
  ctx.fillStyle = 'rgba(255,255,255,0.18)';
  if(matchMedia('(prefers-color-scheme: dark)').matches){
    ctx.fillStyle = 'rgba(0,0,0,0.18)';
  }
  roundRect(ctx, x, y, w, h, 14, true, false);
  ctx.restore();

  // axes
  ctx.save();
  ctx.strokeStyle = c.line;
  ctx.globalAlpha = 0.7;
  ctx.lineWidth = 1;
  // y-axis
  ctx.beginPath(); ctx.moveTo(x+44, y+10); ctx.lineTo(x+44, y+h-36); ctx.stroke();
  // x-axis
  ctx.beginPath(); ctx.moveTo(x+44, y+h-36); ctx.lineTo(x+w-14, y+h-36); ctx.stroke();

  ctx.fillStyle = c.muted;
  ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
  ctx.fillText('v(r)', x+10, y+18);
  ctx.fillText('r', x+w-18, y+h-18);
  ctx.restore();

  // curve
  ctx.save();
  ctx.strokeStyle = c.text;
  ctx.lineWidth = 2;
  ctx.globalAlpha = 0.95;

  const Rmax = 220;
  const N = 180;
  ctx.beginPath();
  for(let i=0;i<=N;i++){
    const r = (i/N)*Rmax;
    const v = rotationCurve(r, dmGain); // 0..~1.2
    const X = x+44 + (i/N)*(w-64);
    const Y = (y+h-36) - v*(h-70);
    if(i===0) ctx.moveTo(X,Y);
    else ctx.lineTo(X,Y);
  }
  ctx.stroke();
  ctx.restore();

  // dm bar
  ctx.save();
  ctx.fillStyle = c.accent;
  ctx.globalAlpha = 0.22;
  const bx = x+10, by = y+h-30, bw = w-20, bh = 10;
  ctx.fillRect(bx, by, bw*dmGain, bh);
  ctx.globalAlpha = 0.55;
  ctx.strokeStyle = c.line;
  ctx.strokeRect(bx, by, bw, bh);
  ctx.globalAlpha = 0.9;
  ctx.fillStyle = c.muted;
  ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
  ctx.fillText(`DM â€œflatnessâ€: ${Math.round(dmGain*100)}%`, x+10, y+h-42);
  ctx.restore();
}

function roundRect(ctx, x, y, w, h, r, fill, stroke){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

/* Play/Pause logic */
let tFreeze = now();
function setRunning(v){
  if(running === v) return;
  if(!v){
    tFreeze = now();
    badge.textContent = '××¦×‘: ×¢×¦×™×¨×”';
  }else{
    // shift t0 so time continues from freeze point
    const dt = now() - tFreeze;
    t0 += dt;
    badge.textContent = '××¦×‘: ×¨×™×¦×”';
  }
  running = v;
}

btnPlay.addEventListener('click', () => setRunning(!running));
btnReseed.addEventListener('click', () => { reseedLoop(); });
btnReset.addEventListener('click', () => {
  elType.value = 'circle';
  elR.value = 95;
  elE.value = 35;
  elC.value = 5;
  elDM.value = 55;
  elLens.value = 25;
  reseedLoop();
});

function updateUIVisibility(){
  const type = elType.value;
  elE.parentElement.style.opacity = (type==='ellipse') ? '1' : '0.45';
  elE.parentElement.style.pointerEvents = (type==='ellipse') ? 'auto' : 'none';

  elC.parentElement.style.opacity = (type==='loop') ? '1' : '0.45';
  elC.parentElement.style.pointerEvents = (type==='loop') ? 'auto' : 'none';
}
['change','input'].forEach(evt=>{
  elType.addEventListener(evt, updateUIVisibility);
  elR.addEventListener(evt, ()=>{});
  elE.addEventListener(evt, ()=>{});
  elC.addEventListener(evt, ()=>{});
  elDM.addEventListener(evt, ()=>{});
  elLens.addEventListener(evt, ()=>{});
});
updateUIVisibility();

/* =========================
   Fish / Cluster demo
========================= */
const cvFish = document.getElementById('cvFish');
const badgeFish = document.getElementById('badgeFish');
const elSwim = document.getElementById('swim');
const elField = document.getElementById('field');
const btnFish = document.getElementById('btnFish');
const btnFishReset = document.getElementById('btnFishReset');

let fishRun = true;
let fish = { x:0, y:0, vx:0.9, vy:0.2, path:[] };
let fishT0 = now();

function resetFish(){
  fish = { x:0, y:0, vx: rand(-1,1), vy: rand(-1,1), path:[] };
  fishT0 = now();
}
resetFish();

function setFishRun(v){
  fishRun = v;
  badgeFish.textContent = v ? '××¦×‘: ×¨×™×¦×”' : '××¦×‘: ×¢×¦×™×¨×”';
}
btnFish.addEventListener('click', ()=> setFishRun(!fishRun));
btnFishReset.addEventListener('click', ()=> resetFish());

function fieldFlow(x,y, strength){
  // a smooth â€œcurrentâ€: combination of vortices
  const s = strength; // 0..1
  const a = Math.sin(y/90) * Math.cos(x/120);
  const b = Math.cos(y/120) * Math.sin(x/95);
  // curl-like flow
  return { fx: s*( 0.9*a - 0.4*b), fy: s*( 0.9*b + 0.4*a) };
}

function drawFishScene(dt){
  const ctx = setupCanvas(cvFish);
  const rect = cvFish.getBoundingClientRect();
  const W = rect.width, H = rect.height;

  ctx.clearRect(0,0,W,H);
  drawGrid(ctx, W, H);

  const c = themeColors();
  const cx = W*0.50, cy = H*0.52;

  const swim = Number(elSwim.value)/100;   // active drive
  const fld  = Number(elField.value)/100;  // field current

  // update motion
  if(fishRun){
    const flow = fieldFlow(fish.x, fish.y, fld);
    // active steering: â€œpredatorâ€ style â€” tends to curve and explore
    const steer = {
      ax: swim*(0.9*Math.sin((now()-fishT0)/600) + 0.3*Math.sin(fish.y/60)),
      ay: swim*(0.9*Math.cos((now()-fishT0)/750) + 0.3*Math.sin(fish.x/70))
    };

    fish.vx += (flow.fx + steer.ax) * dt*0.8;
    fish.vy += (flow.fy + steer.ay) * dt*0.8;

    // speed limit
    const sp = hypot(fish.vx, fish.vy);
    const maxSp = 2.2 + 2.4*swim;
    if(sp > maxSp){
      fish.vx *= maxSp/sp; fish.vy *= maxSp/sp;
    }

    fish.x += fish.vx * dt*60;
    fish.y += fish.vy * dt*60;

    // boundaries bounce
    const boundX = 0.42*W, boundY = 0.42*H;
    if(fish.x < -boundX || fish.x > boundX) fish.vx *= -0.95;
    if(fish.y < -boundY || fish.y > boundY) fish.vy *= -0.95;
    fish.x = clamp(fish.x, -boundX, boundX);
    fish.y = clamp(fish.y, -boundY, boundY);

    fish.path.push({x:fish.x, y:fish.y});
    if(fish.path.length > 420) fish.path.shift();
  }

  // draw flow hints
  ctx.save();
  ctx.globalAlpha = 0.18;
  ctx.strokeStyle = c.accent;
  for(let gx=-4; gx<=4; gx++){
    for(let gy=-3; gy<=3; gy++){
      const x = gx*90, y = gy*90;
      const f = fieldFlow(x,y, fld);
      const X = cx + x, Y = cy + y;
      ctx.beginPath();
      ctx.moveTo(X,Y);
      ctx.lineTo(X + f.fx*70, Y + f.fy*70);
      ctx.stroke();
    }
  }
  ctx.restore();

  // draw path
  ctx.save();
  ctx.strokeStyle = c.text;
  ctx.globalAlpha = 0.85;
  ctx.lineWidth = 2;
  ctx.beginPath();
  fish.path.forEach((p,i)=>{
    const X = cx + p.x;
    const Y = cy + p.y;
    if(i===0) ctx.moveTo(X,Y);
    else ctx.lineTo(X,Y);
  });
  ctx.stroke();
  ctx.restore();

  // draw â€œfishâ€
  const X = cx + fish.x, Y = cy + fish.y;
  const ang = Math.atan2(fish.vy, fish.vx);

  ctx.save();
  ctx.translate(X,Y);
  ctx.rotate(ang);
  ctx.fillStyle = c.accent;
  ctx.globalAlpha = 0.95;

  // body
  ctx.beginPath();
  ctx.ellipse(0,0, 14, 8, 0, 0, Math.PI*2);
  ctx.fill();

  // tail
  ctx.globalAlpha = 0.75;
  ctx.beginPath();
  ctx.moveTo(-14,0);
  ctx.lineTo(-25,7);
  ctx.lineTo(-25,-7);
  ctx.closePath();
  ctx.fill();

  // eye
  ctx.globalAlpha = 0.95;
  ctx.fillStyle = c.head;
  ctx.beginPath();
  ctx.arc(6,-2, 1.8, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();

  // label
  ctx.save();
  ctx.fillStyle = c.muted;
  ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
  ctx.fillText(`ğŸŸ Active=${Math.round(swim*100)}% | Field=${Math.round(fld*100)}% â€” â€œ×¦×‘×™×¨ ×›×©×—×™×™×” ×‘××“×™×•×â€`, 14, 18);
  ctx.restore();
}

/* =========================
   Animation loop
========================= */
let last = now();
function tick(){
  const t = now();
  const dt = Math.min(0.05, (t - last)/1000);
  last = t;

  drawOrbitScene();
  drawFishScene(dt);

  requestAnimationFrame(tick);
}
tick();

/* =========================
   KaTeX auto-render if available
========================= */
window.addEventListener('load', () => {
  try{
    if(window.renderMathInElement){
      renderMathInElement(document.body, {
        delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "\\[", right: "\\]", display: true},
          {left: "$", right: "$", display: false},
          {left: "\\(", right: "\\)", display: false}
        ],
        throwOnError: false
      });
    }
  }catch(e){}
});

/* Re-render on resize */
let resizeTimer = null;
window.addEventListener('resize', ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=>{ /* next tick redraw will adapt */ }, 120);
});
</script>
</body>
</html>
