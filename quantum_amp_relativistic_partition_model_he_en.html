<!doctype html>
<html lang="he" dir="rtl" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quantum Amp â€” ××•×“×œ ××ª××˜×™ ×œ××—×™×¦×” × ×¢×” + ×¡×™×›×•× ×©×œ×‘×™ ×”×”×¦×¢×”</title>
  <meta name="color-scheme" content="light dark">

  <!-- KaTeX (online) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

  <style>
    :root{
      --bg0:#f4f6fb; --bg1:#eef2ff; --bg2:#ecfeff;
      --card:rgba(255,255,255,.82);
      --card2:rgba(255,255,255,.62);
      --text:#0f172a; --muted:#64748b; --line:rgba(148,163,184,.35);
      --head:#0b1220; --link:#2563eb;
      --shadow:0 18px 50px rgba(2,6,23,.10);
      --r:18px;
      --accent:#6366f1; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg0:#070a12; --bg1:#0b1020; --bg2:#06131a;
        --card:rgba(15,23,42,.72);
        --card2:rgba(15,23,42,.55);
        --text:#e5e7eb; --muted:#9ca3af; --line:rgba(148,163,184,.18);
        --head:#f8fafc; --link:#93c5fd;
        --shadow:0 18px 50px rgba(0,0,0,.45);
      }
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% 5%, var(--bg2), transparent 60%),
                  radial-gradient(900px 600px at 80% 10%, var(--bg1), transparent 60%),
                  linear-gradient(180deg, var(--bg0), transparent 55%);
      color:var(--text);
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:28px 18px 10px;
      max-width:1100px;
      margin:0 auto;
    }
    .topbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg, rgba(99,102,241,.95), rgba(34,211,238,.85));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 45%);
      transform: rotate(18deg);
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.2vw, 30px);
      color:var(--head);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:4px 0 0;
      color:var(--muted);
      line-height:1.35;
      max-width:78ch;
      font-size: 14px;
    }

    .pillbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .pill{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      padding:8px 10px;
      border-radius: 999px;
      box-shadow: 0 10px 25px rgba(2,6,23,.06);
      display:flex; gap:10px; align-items:center;
      font-size: 13px;
    }
    .btn{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      padding:8px 10px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(2,6,23,.06);
      cursor:pointer;
      color:var(--text);
      font-weight:600;
      font-size: 13px;
      transition: transform .08s ease, border-color .15s ease;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(99,102,241,.55)}
    .btn:active{transform: translateY(0px)}
    .btn.primary{
      border-color: rgba(99,102,241,.55);
      background: linear-gradient(180deg, rgba(99,102,241,.20), rgba(34,211,238,.10));
    }

    main{max-width:1100px; margin:0 auto; padding: 8px 18px 40px;}
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:14px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 14px 14px;
      overflow:hidden;
    }
    .card h2{
      margin:0 0 8px;
      font-size: 18px;
      color:var(--head);
      display:flex; align-items:center; gap:8px;
    }
    .card h3{
      margin: 14px 0 6px;
      font-size: 15px;
      color:var(--head);
    }
    .muted{color:var(--muted)}
    .k{
      font-family: var(--mono);
      font-size: 12.5px;
      border:1px dashed var(--line);
      background: rgba(2,6,23,.04);
      padding: 10px;
      border-radius: 14px;
      overflow:auto;
    }
    @media (prefers-color-scheme: dark){
      .k{background: rgba(255,255,255,.04)}
    }

    .two-col{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){ .two-col{grid-template-columns:1fr} }

    .steps{
      display:grid;
      gap:10px;
      margin-top: 8px;
    }
    .step{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 10px 10px;
      background: rgba(255,255,255,.06);
    }
    .step .title{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      font-weight:800; color:var(--head); margin-bottom:4px;
    }
    .badge{
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      color: var(--muted);
      font-weight:700;
      white-space:nowrap;
    }
    .badge.ok{border-color: rgba(22,163,74,.40); color: rgba(22,163,74,.95)}
    .badge.warn{border-color: rgba(245,158,11,.50); color: rgba(245,158,11,.95)}
    .badge.info{border-color: rgba(99,102,241,.45); color: rgba(99,102,241,.95)}

    .controls{
      display:grid;
      gap:10px;
      margin-top: 10px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 150px;
      gap:10px;
      align-items:center;
    }
    @media (max-width: 520px){ .row{grid-template-columns:1fr} }
    input[type="range"]{width:100%}
    .val{
      font-family: var(--mono);
      font-size: 12.5px;
      padding: 7px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      text-align:left;
      direction:ltr;
    }

    canvas{
      width:100%;
      height:260px;
      border-radius: 16px;
      border:1px solid var(--line);
      background: rgba(2,6,23,.05);
      display:block;
    }
    @media (prefers-color-scheme: dark){
      canvas{background: rgba(255,255,255,.05)}
    }

    .langwrap{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    }
    .langbtn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      padding:6px 10px;
      border-radius: 999px;
      cursor:pointer;
      font-weight:800;
      font-size: 12.5px;
      color: var(--text);
    }
    .langbtn.active{border-color: rgba(99,102,241,.55); box-shadow: 0 10px 25px rgba(99,102,241,.10)}
    footer{
      max-width:1100px;
      margin: 0 auto;
      padding: 0 18px 28px;
      color: var(--muted);
      font-size: 12.5px;
    }
    .legal{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,.04);
    }
    .note{
      border-inline-start: 4px solid rgba(99,102,241,.65);
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(99,102,241,.08);
      margin-top: 8px;
    }
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1><span data-i18n="title">Quantum Amp â€” ××•×“×œ ××ª××˜×™ ×œ××—×™×¦×” × ×¢×” (Relativistic Piston)</span> âš›ï¸ğŸŒŠ</h1>
        <div class="subtitle" data-i18n="subtitle">
          ××¡××š ×˜×›× ×™: × ×™×¡×•×— ××©×ª× ×™×, ××©×•×•××•×ª ×ª× ×•×¢×” ×œ××—×™×¦×”, ×¦×™××•×“ ×©×“×”/××“×™×“×”, ×•×¡×™×›×•× ×©×œ×‘×™ ×”×”×¦×¢×” ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×™×ª ×”××“×™×“×”.
        </div>
      </div>
    </div>

    <div class="pillbar">
      <div class="pill">
        <span>ğŸŒ</span>
        <div class="langwrap" aria-label="Language">
          <button class="langbtn active" data-lang="he">×¢×‘×¨×™×ª</button>
          <button class="langbtn" data-lang="en">English</button>
        </div>
      </div>
      <button class="btn" id="btnTheme" title="Toggle theme">ğŸŒ“ <span data-i18n="theme">××¦×‘ ×ª×¦×•×’×”</span></button>
      <button class="btn primary" id="btnRun">â–¶ <span data-i18n="run">×”×¨×¥ ×¡×™××•×œ×¦×™×”</span></button>
      <button class="btn" id="btnReset">â†º <span data-i18n="reset">××™×¤×•×¡</span></button>
    </div>
  </div>
</header>

<main class="grid">

  <section class="card">
    <h2>ğŸ§­ <span data-i18n="sec1">1) ×”×’×“×¨×ª ×”××¢×¨×›×ª ×•×”××©×ª× ×™×</span></h2>
    <div class="two-col">
      <div>
        <p data-i18n="s1p1">
          "×××¤×˜ ×§×•×•× ×˜×™" ××•×’×“×¨ ×›××Ÿ ×›× ×¤×— ××“×™×“×” ×¡×’×•×¨ ×©×‘×• ××—×™×¦×” ×¤× ×™××™×ª × ×¢×” ×‘××”×™×¨×•×ª ×’×‘×•×”×” ×××•×“. ×”××—×™×¦×” ××¤×¨×™×“×” ×‘×™×Ÿ ×©× ×™ ×ª××™ ×’×–
          (×©×××œ/×™××™×Ÿ) ×•×™×•×¦×¨×ª ××•×“×•×œ×¦×™×” ×‘×–××Ÿ ×××ª ×©×œ ×ª× ××™ ×”×©×¤×” ×œ×©×“×”/×’×œ ×‘×ª×•×š ×”×××¤×˜ â€” ×œ×¤× ×™ ×”×¦×™××•×“ ×”×™×©×™×¨ ×œ×’×œ××™.
        </p>

        <h3 data-i18n="vars">××©×ª× ×™× ×‘×¡×™×¡×™×™×</h3>
        <div class="k" id="varsBlock"></div>

        <div class="note" data-i18n="note1">
          ×¨×¢×™×•×Ÿ ×”×œ×™×‘×”: ×œ× "×œ×‘×˜×œ" ××“×™×“×” ×§×•×•× ×˜×™×ª, ××œ× ×œ×‘× ×•×ª ×©×›×‘×ª ×‘×™× ×™×™× (Amp) ×©×××™×¨×” ××™×“×¢ ×§×•×•× ×˜×™ ×œ×“×¤×•×¡ ××¨×—×‘×™ (pattern)
          ×œ×¤× ×™ ×“×§×•Ö¾×”×¨× ×˜×™×•×ª ×—×–×§×” ×©×œ ×’×œ××™ ×§×œ××¡×™.
        </div>
      </div>

      <div>
        <h3 data-i18n="geo">×’×™××•××˜×¨×™×” ××™× ×™××œ×™×ª</h3>
        <div class="k" id="geoBlock"></div>

        <h3 data-i18n="assump">×”× ×—×•×ª ×¢×‘×•×“×” (××™× ×™××œ×™×•×ª)</h3>
        <ul class="muted" id="assumptions"></ul>
      </div>
    </div>

    <h2 style="margin-top:14px">ğŸ§® <span data-i18n="sec2">2) ××©×•×•××•×ª ×ª× ×•×¢×” ×œ××—×™×¦×” (Relativistic EOM)</span></h2>

    <p data-i18n="s2p1">
      ×›×“×™ ×œ×”×›× ×™×¡ "××—×™×¦×” ×©×¨×¦×” ××”×¨", ××©×ª××©×™× ×‘×“×™× ××™×§×” ×™×—×¡×•×ª×™×ª ×©×œ ×’×•×£ ×‘×¢×œ ××¡×” m ×”× ×¢ ×œ××•×¨×š ×¦×™×¨ x ×ª×—×ª ×›×•×— ×œ×—×¥ (×”×¤×¨×© ×œ×—×¦×™×).
      ××™×Ÿ ×¦×•×¨×š ×œ×˜×¢×•×Ÿ ×©×”××—×™×¦×” ×‘×××ª ××’×™×¢×” ×œÖ¾c; ×”××•×“×œ ××’×“×™×¨ ×’×‘×•×œ ×¤×™×–×™×§×œ×™: v ×ª××™×“ ×§×˜×Ÿ ×Ö¾c, ×•××ª×§×¨×‘ ××œ×™×” ××¡×™××¤×˜×•×˜×™×ª.
    </p>

    <div class="two-col">
      <div>
        <h3 data-i18n="rel1">2.1 ×™×—×¡×•×ª: ×ª× ×¢ ×•×’×•×¨× ×œ×•×¨× ×¥</h3>
        <div class="k" id="relBlock1"></div>

        <h3 data-i18n="rel2">2.2 ×›×•×— ×œ×—×¥ + ×—×™×›×•×š/×“××¤×™× ×’</h3>
        <div class="k" id="relBlock2"></div>

        <p class="muted" data-i18n="s2p2">
          ×›××Ÿ Î² ×”×•× ×—×™×›×•×š ××¤×§×˜×™×‘×™ (×›×•×œ×œ ××˜××™×, ××¢×¨×‘×•×œ×•×ª ×’×–, ×•×”×¤×¡×“×™ ×—×•×). × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×’× ×›×•×— ×‘×§×¨×” ×—×™×¦×•× ×™ u(t) (××§×˜×•××˜×•×¨)
          ×›×“×™ ×œ×§×‘×¢ ×ª×“×¨/×¤×¨×•×¤×™×œ ×ª× ×•×¢×”.
        </p>
      </div>

      <div>
        <h3 data-i18n="gas">2.3 ××•×“×œ ×œ×—×¥ ××™× ×™××œ×™ ×œ×’×– ×”×“×—×•×¡</h3>
        <div class="k" id="gasBlock"></div>

        <h3 data-i18n="stable">2.4 ×ª× ××™ ×™×¦×™×‘×•×ª / ××™Ö¾×—×¨×™×’×”</h3>
        <div class="k" id="stabilityBlock"></div>

        <div class="note" data-i18n="note2">
          ×”×¡×™××•×œ×¦×™×” ×œ××˜×” ××©×ª××©×ª ×‘××•×“×œ ×œ×—×¥ ××“×™××‘×˜×™ ×¤×©×•×˜ ×›×“×™ ×œ×”×“×’×™× ××ª ×”××¤×§×˜. ×‘×¤×•×¢×œ ××¤×©×¨ ×œ×”×—×œ×™×£ ×œ××•×“×œ CFD/×ª×¨××•×“×™× ××™ ××¤×•×¨×˜.
        </div>
      </div>
    </div>

    <h2 style="margin-top:14px">ğŸ§² <span data-i18n="sec3">3) ×¦×™××•×“ ×§×•×•× ×˜×™Ö¾××“×™×“×”: "Amp" ×›×©×›×‘×ª ×‘×™× ×™×™×</span></h2>
    <p data-i18n="s3p1">
      ×›×“×™ ×œ× ×¡×— ×–××ª ××ª××˜×™×ª ×‘×œ×™ ×œ×”×¤×¨ ××ª ×”×§×•×•× ×˜×™×: ××’×“×™×¨×™× ×”××™×œ×˜×•× ×™××Ÿ ×›×•×œ×œ ××—×™×¦×” ×›××©×ª× ×” ×§×œ××¡×™/×—×¦×™Ö¾×§×œ××¡×™ X(t),
      ×•××– ×”×©×“×”/×”××¢×¨×›×ª ×”×§×•×•× ×˜×™×ª ×—×•×•×” ×ª× ××™ ×©×¤×” ×ª×œ×•×™×™Ö¾×–××Ÿ. ×”××“×™×“×” (×”×’×œ××™) ××¦×•××“×ª ×œ×™×¦×™××” ×©×œ ×”×××¤×˜ ×•×œ× ×™×©×™×¨×•×ª ×œ××¢×¨×›×ª.
    </p>

    <div class="two-col">
      <div>
        <h3 data-i18n="ham">3.1 × ×™×¡×•×— ×”××™×œ×˜×•× ×™×× ×™ (×—×¦×™Ö¾×§×œ××¡×™)</h3>
        <div class="k" id="hamBlock"></div>
      </div>
      <div>
        <h3 data-i18n="obs">3.2 ××” "× ××“×“" ×‘×¤×•×¢×œ?</h3>
        <div class="k" id="obsBlock"></div>
      </div>
    </div>

    <h2 style="margin-top:14px">ğŸ—ºï¸ <span data-i18n="sec4">4) ×¡×™×›×•× ×›×œ ×©×œ×‘ ×‘×”×¦×¢×” ×©×œ×š (Pipeline)</span></h2>
    <div class="steps" id="steps"></div>
  </section>

  <aside class="card">
    <h2>ğŸ“ˆ <span data-i18n="sim">×¡×™××•×œ×¦×™×” ××”×™×¨×” ×œ××—×™×¦×”</span></h2>
    <p class="muted" data-i18n="simp">
      ×”×“×’××” × ×•××¨×™×ª: ××—×™×¦×” ×‘×™×Ÿ ×©× ×™ ×ª××™ ×’×– ×¢× ×œ×—×¥ ××“×™××‘×˜×™. ×”××˜×¨×” ×›××Ÿ ×”×™× ×œ×”××—×™×© ×ª× ×•×¢×” ××•×’×‘×œ×ªÖ¾c, ×œ× "×œ×”×•×›×™×—" × ×™×¡×•×™.
    </p>

    <div class="controls">
      <div class="row">
        <label for="m" data-i18n="m">m â€” ××¡×” (×§×´×’)</label>
        <input id="m" type="range" min="0.1" max="50" step="0.1" value="5">
        <div class="val" id="mVal"></div>
      </div>

      <div class="row">
        <label for="A" data-i18n="A">A â€” ×©×˜×— ××—×™×¦×” (××´×¨)</label>
        <input id="A" type="range" min="0.001" max="0.2" step="0.001" value="0.02">
        <div class="val" id="AVal"></div>
      </div>

      <div class="row">
        <label for="beta" data-i18n="beta">Î² â€” ×“××¤×™× ×’</label>
        <input id="beta" type="range" min="0" max="50" step="0.1" value="2">
        <div class="val" id="betaVal"></div>
      </div>

      <div class="row">
        <label for="P0L" data-i18n="P0L">Pâ‚€L â€” ×œ×—×¥ ×”×ª×—×œ×ª×™ ×©×××œ (Pa)</label>
        <input id="P0L" type="range" min="50000" max="2000000" step="10000" value="400000">
        <div class="val" id="P0LVal"></div>
      </div>

      <div class="row">
        <label for="P0R" data-i18n="P0R">Pâ‚€R â€” ×œ×—×¥ ×”×ª×—×œ×ª×™ ×™××™×Ÿ (Pa)</label>
        <input id="P0R" type="range" min="50000" max="2000000" step="10000" value="120000">
        <div class="val" id="P0RVal"></div>
      </div>

      <div class="row">
        <label for="L" data-i18n="L">L â€” ××•×¨×š ×××¤×˜ (××³)</label>
        <input id="L" type="range" min="0.1" max="5" step="0.01" value="1.2">
        <div class="val" id="LVal"></div>
      </div>

      <div class="row">
        <label for="x0" data-i18n="x0">x(0) â€” ××™×§×•× ×”×ª×—×œ×ª×™ (××³)</label>
        <input id="x0" type="range" min="0.01" max="1.19" step="0.01" value="0.6">
        <div class="val" id="x0Val"></div>
      </div>

      <div class="row">
        <label for="v0" data-i18n="v0">v(0) â€” ××”×™×¨×•×ª ×”×ª×—×œ×ª×™×ª (×™×—×¡×™×ª ×œÖ¾c)</label>
        <input id="v0" type="range" min="-0.95" max="0.95" step="0.01" value="0">
        <div class="val" id="v0Val"></div>
      </div>

      <div class="row">
        <label for="T" data-i18n="T">×–××Ÿ ×¡×™××•×œ×¦×™×” (×©×³)</label>
        <input id="T" type="range" min="0.02" max="2.0" step="0.01" value="0.25">
        <div class="val" id="TVal"></div>
      </div>

      <div class="row">
        <label for="dt" data-i18n="dt">Î”t ×¦×¢×“ (×©×³)</label>
        <input id="dt" type="range" min="0.00005" max="0.01" step="0.00005" value="0.0005">
        <div class="val" id="dtVal"></div>
      </div>
    </div>

    <h3 style="margin-top:12px" data-i18n="plot">×’×¨×£ ××™×§×•× ×•××”×™×¨×•×ª</h3>
    <canvas id="plot" width="900" height="520"></canvas>

    <div class="k" id="simOut" style="margin-top:10px"></div>

    <div class="note" data-i18n="note3">
      ×˜×™×¤ × ×™×¡×•×™×™: ×× ×¨×•×¦×™× "×“×¤×•×¡ ×ª××•× ×”" (pattern), ×¦×¨×™×š ×œ××“×•×“ ×™×¦×™××” ××”×××¤×˜:
      ×¡×¤×§×˜×¨×•×, ×¤××–×”, ××• ××™× ×˜× ×¡×™×‘×™×•×ª ××—×¨×™ ×”×××¤×˜ â€” ×œ× â€œ×‘×ª×•×šâ€ ×”××¢×¨×›×ª ×”×§×•×•× ×˜×™×ª.
    </div>
  </aside>

</main>

<footer>
  <div class="legal" data-i18n="legal">
    ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª. ××™×Ÿ ×œ×©×›×¤×œ ××œ× ×‘××™×©×•×¨ ×Ö¾RA â€” Raftn4@gmail.com
  </div>
</footer>

<script>
/* =========================
   i18n (HE/EN)
========================= */
const I18N = {
  he: {
    title: "Quantum Amp â€” ××•×“×œ ××ª××˜×™ ×œ××—×™×¦×” × ×¢×” (Relativistic Piston)",
    subtitle: "××¡××š ×˜×›× ×™: × ×™×¡×•×— ××©×ª× ×™×, ××©×•×•××•×ª ×ª× ×•×¢×” ×œ××—×™×¦×”, ×¦×™××•×“ ×©×“×”/××“×™×“×”, ×•×¡×™×›×•× ×©×œ×‘×™ ×”×”×¦×¢×” ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×™×ª ×”××“×™×“×”.",
    theme: "××¦×‘ ×ª×¦×•×’×”",
    run: "×”×¨×¥ ×¡×™××•×œ×¦×™×”",
    reset: "××™×¤×•×¡",
    sec1: "1) ×”×’×“×¨×ª ×”××¢×¨×›×ª ×•×”××©×ª× ×™×",
    s1p1: "\"×××¤×˜ ×§×•×•× ×˜×™\" ××•×’×“×¨ ×›××Ÿ ×›× ×¤×— ××“×™×“×” ×¡×’×•×¨ ×©×‘×• ××—×™×¦×” ×¤× ×™××™×ª × ×¢×” ×‘××”×™×¨×•×ª ×’×‘×•×”×” ×××•×“. ×”××—×™×¦×” ××¤×¨×™×“×” ×‘×™×Ÿ ×©× ×™ ×ª××™ ×’×– (×©×××œ/×™××™×Ÿ) ×•×™×•×¦×¨×ª ××•×“×•×œ×¦×™×” ×‘×–××Ÿ ×××ª ×©×œ ×ª× ××™ ×”×©×¤×” ×œ×©×“×”/×’×œ ×‘×ª×•×š ×”×××¤×˜ â€” ×œ×¤× ×™ ×”×¦×™××•×“ ×”×™×©×™×¨ ×œ×’×œ××™.",
    vars: "××©×ª× ×™× ×‘×¡×™×¡×™×™×",
    geo: "×’×™××•××˜×¨×™×” ××™× ×™××œ×™×ª",
    assump: "×”× ×—×•×ª ×¢×‘×•×“×” (××™× ×™××œ×™×•×ª)",
    note1: "×¨×¢×™×•×Ÿ ×”×œ×™×‘×”: ×œ× \"×œ×‘×˜×œ\" ××“×™×“×” ×§×•×•× ×˜×™×ª, ××œ× ×œ×‘× ×•×ª ×©×›×‘×ª ×‘×™× ×™×™× (Amp) ×©×××™×¨×” ××™×“×¢ ×§×•×•× ×˜×™ ×œ×“×¤×•×¡ ××¨×—×‘×™ (pattern) ×œ×¤× ×™ ×“×§×•Ö¾×”×¨× ×˜×™×•×ª ×—×–×§×” ×©×œ ×’×œ××™ ×§×œ××¡×™.",
    sec2: "2) ××©×•×•××•×ª ×ª× ×•×¢×” ×œ××—×™×¦×” (Relativistic EOM)",
    s2p1: "×›×“×™ ×œ×”×›× ×™×¡ \"××—×™×¦×” ×©×¨×¦×” ××”×¨\", ××©×ª××©×™× ×‘×“×™× ××™×§×” ×™×—×¡×•×ª×™×ª ×©×œ ×’×•×£ ×‘×¢×œ ××¡×” m ×”× ×¢ ×œ××•×¨×š ×¦×™×¨ x ×ª×—×ª ×›×•×— ×œ×—×¥ (×”×¤×¨×© ×œ×—×¦×™×). ××™×Ÿ ×¦×•×¨×š ×œ×˜×¢×•×Ÿ ×©×”××—×™×¦×” ×‘×××ª ××’×™×¢×” ×œÖ¾c; ×”××•×“×œ ××’×“×™×¨ ×’×‘×•×œ ×¤×™×–×™×§×œ×™: v ×ª××™×“ ×§×˜×Ÿ ×Ö¾c, ×•××ª×§×¨×‘ ××œ×™×” ××¡×™××¤×˜×•×˜×™×ª.",
    rel1: "2.1 ×™×—×¡×•×ª: ×ª× ×¢ ×•×’×•×¨× ×œ×•×¨× ×¥",
    rel2: "2.2 ×›×•×— ×œ×—×¥ + ×—×™×›×•×š/×“××¤×™× ×’",
    s2p2: "×›××Ÿ Î² ×”×•× ×—×™×›×•×š ××¤×§×˜×™×‘×™ (×›×•×œ×œ ××˜××™×, ××¢×¨×‘×•×œ×•×ª ×’×–, ×•×”×¤×¡×“×™ ×—×•×). × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×’× ×›×•×— ×‘×§×¨×” ×—×™×¦×•× ×™ u(t) (××§×˜×•××˜×•×¨) ×›×“×™ ×œ×§×‘×¢ ×ª×“×¨/×¤×¨×•×¤×™×œ ×ª× ×•×¢×”.",
    gas: "2.3 ××•×“×œ ×œ×—×¥ ××™× ×™××œ×™ ×œ×’×– ×”×“×—×•×¡",
    stable: "2.4 ×ª× ××™ ×™×¦×™×‘×•×ª / ××™Ö¾×—×¨×™×’×”",
    note2: "×”×¡×™××•×œ×¦×™×” ×œ××˜×” ××©×ª××©×ª ×‘××•×“×œ ×œ×—×¥ ××“×™××‘×˜×™ ×¤×©×•×˜ ×›×“×™ ×œ×”×“×’×™× ××ª ×”××¤×§×˜. ×‘×¤×•×¢×œ ××¤×©×¨ ×œ×”×—×œ×™×£ ×œ××•×“×œ CFD/×ª×¨××•×“×™× ××™ ××¤×•×¨×˜.",
    sec3: "3) ×¦×™××•×“ ×§×•×•× ×˜×™Ö¾××“×™×“×”: \"Amp\" ×›×©×›×‘×ª ×‘×™× ×™×™×",
    s3p1: "×›×“×™ ×œ× ×¡×— ×–××ª ××ª××˜×™×ª ×‘×œ×™ ×œ×”×¤×¨ ××ª ×”×§×•×•× ×˜×™×: ××’×“×™×¨×™× ×”××™×œ×˜×•× ×™××Ÿ ×›×•×œ×œ ××—×™×¦×” ×›××©×ª× ×” ×§×œ××¡×™/×—×¦×™Ö¾×§×œ××¡×™ X(t), ×•××– ×”×©×“×”/×”××¢×¨×›×ª ×”×§×•×•× ×˜×™×ª ×—×•×•×” ×ª× ××™ ×©×¤×” ×ª×œ×•×™×™Ö¾×–××Ÿ. ×”××“×™×“×” (×”×’×œ××™) ××¦×•××“×ª ×œ×™×¦×™××” ×©×œ ×”×××¤×˜ ×•×œ× ×™×©×™×¨×•×ª ×œ××¢×¨×›×ª.",
    ham: "3.1 × ×™×¡×•×— ×”××™×œ×˜×•× ×™×× ×™ (×—×¦×™Ö¾×§×œ××¡×™)",
    obs: "3.2 ××” \"× ××“×“\" ×‘×¤×•×¢×œ?",
    sec4: "4) ×¡×™×›×•× ×›×œ ×©×œ×‘ ×‘×”×¦×¢×” ×©×œ×š (Pipeline)",
    sim: "×¡×™××•×œ×¦×™×” ××”×™×¨×” ×œ××—×™×¦×”",
    simp: "×”×“×’××” × ×•××¨×™×ª: ××—×™×¦×” ×‘×™×Ÿ ×©× ×™ ×ª××™ ×’×– ×¢× ×œ×—×¥ ××“×™××‘×˜×™. ×”××˜×¨×” ×›××Ÿ ×”×™× ×œ×”××—×™×© ×ª× ×•×¢×” ××•×’×‘×œ×ªÖ¾c, ×œ× \"×œ×”×•×›×™×—\" × ×™×¡×•×™.",
    m: "m â€” ××¡×” (×§×´×’)",
    A: "A â€” ×©×˜×— ××—×™×¦×” (××´×¨)",
    beta: "Î² â€” ×“××¤×™× ×’",
    P0L: "Pâ‚€L â€” ×œ×—×¥ ×”×ª×—×œ×ª×™ ×©×××œ (Pa)",
    P0R: "Pâ‚€R â€” ×œ×—×¥ ×”×ª×—×œ×ª×™ ×™××™×Ÿ (Pa)",
    L: "L â€” ××•×¨×š ×××¤×˜ (××³)",
    x0: "x(0) â€” ××™×§×•× ×”×ª×—×œ×ª×™ (××³)",
    v0: "v(0) â€” ××”×™×¨×•×ª ×”×ª×—×œ×ª×™×ª (×™×—×¡×™×ª ×œÖ¾c)",
    T: "×–××Ÿ ×¡×™××•×œ×¦×™×” (×©×³)",
    dt: "Î”t ×¦×¢×“ (×©×³)",
    plot: "×’×¨×£ ××™×§×•× ×•××”×™×¨×•×ª",
    note3: "×˜×™×¤ × ×™×¡×•×™×™: ×× ×¨×•×¦×™× \"×“×¤×•×¡ ×ª××•× ×”\" (pattern), ×¦×¨×™×š ×œ××“×•×“ ×™×¦×™××” ××”×××¤×˜: ×¡×¤×§×˜×¨×•×, ×¤××–×”, ××• ××™× ×˜× ×¡×™×‘×™×•×ª ××—×¨×™ ×”×××¤×˜ â€” ×œ× â€œ×‘×ª×•×šâ€ ×”××¢×¨×›×ª ×”×§×•×•× ×˜×™×ª.",
    legal: "×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª. ××™×Ÿ ×œ×©×›×¤×œ ××œ× ×‘××™×©×•×¨ ×Ö¾RA â€” Raftn4@gmail.com"
  },
  en: {
    title: "Quantum Amp â€” Mathematical model for a moving partition (Relativistic piston)",
    subtitle: "Technical note: variables, partition equations of motion, field/measurement coupling, and a step-by-step pipeline for the proposed measurement workaround.",
    theme: "Theme",
    run: "Run simulation",
    reset: "Reset",
    sec1: "1) System definition and variables",
    s1p1: "Here, a â€œQuantum Ampâ€ is a closed measurement volume with an internal fast-moving partition. The partition separates two gas chambers (left/right) and imposes real-time time-dependent boundary modulation on the field/wave inside the ampâ€”before any direct coupling to a classical detector.",
    vars: "Core variables",
    geo: "Minimal geometry",
    assump: "Working assumptions (minimal)",
    note1: "Core idea: not to â€œcancelâ€ quantum measurement, but to insert an intermediate layer (Amp) that converts quantum information into a spatial pattern before strong detector-driven decoherence.",
    sec2: "2) Partition equations of motion (Relativistic EOM)",
    s2p1: "To model a â€œvery fast partitionâ€, use relativistic dynamics for a body of mass m moving along x under a pressure-force (pressure difference). No need to claim the partition reaches c; the model enforces the physical limit: v < c, approaching it asymptotically.",
    rel1: "2.1 Relativity: momentum and Lorentz factor",
    rel2: "2.2 Pressure force + friction/damping",
    s2p2: "Here Î² is an effective damping (seals, turbulence, thermal losses). You may add an external control force u(t) (actuator) to lock a desired frequency/profile.",
    gas: "2.3 Minimal compressed-gas pressure model",
    stable: "2.4 Stability / non-escape constraints",
    note2: "The demo below uses a simple adiabatic pressure model. In practice you can replace it with a detailed CFD/thermo model.",
    sec3: "3) Quantumâ€“measurement coupling: the Amp as an intermediate layer",
    s3p1: "To write this without violating QM: treat the partition as a classical/semi-classical variable X(t). Then the quantum field/system experiences time-dependent boundary conditions. The detector couples to the amp output, not directly to the quantum system.",
    ham: "3.1 Hamiltonian formulation (semi-classical)",
    obs: "3.2 What is actually measured?",
    sec4: "4) Step-by-step pipeline (your proposal)",
    sim: "Quick partition simulation",
    simp: "Numerical demo: a partition between two gas chambers with adiabatic pressure. Goal: illustrate the c-limited dynamics, not to â€œproveâ€ the experiment.",
    m: "m â€” mass (kg)",
    A: "A â€” partition area (mÂ²)",
    beta: "Î² â€” damping",
    P0L: "Pâ‚€L â€” initial left pressure (Pa)",
    P0R: "Pâ‚€R â€” initial right pressure (Pa)",
    L: "L â€” amp length (m)",
    x0: "x(0) â€” initial position (m)",
    v0: "v(0) â€” initial velocity (fraction of c)",
    T: "Simulation time (s)",
    dt: "Î”t step (s)",
    plot: "Position & velocity plot",
    note3: "Experimental tip: if you want a visible â€œpatternâ€, measure the amp output (spectrum/phase/intensity after the amp), not â€œinsideâ€ the quantum system.",
    legal: "All rights reserved. No copying without permission from RA â€” Raftn4@gmail.com"
  }
};

let LANG = "he";

function setLang(lang){
  LANG = lang;
  document.documentElement.lang = lang;
  document.documentElement.dir = (lang === "he") ? "rtl" : "ltr";

  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const k = el.getAttribute("data-i18n");
    if(I18N[lang][k]) el.textContent = I18N[lang][k];
  });

  document.querySelectorAll(".langbtn").forEach(b=>{
    b.classList.toggle("active", b.dataset.lang === lang);
  });

  // rebuild blocks + steps in selected language
  fillBlocks();
  fillSteps();
  renderMath();
}

/* =========================
   Static content blocks
========================= */
function fillBlocks(){
  const he = (LANG==="he");

  const vars = he
    ? String.raw`
\(c\) â€” ××”×™×¨×•×ª ×”××•×¨, \(\;c \approx 3\times 10^8 \text{ m/s}\)  
\(x(t)\) â€” ××™×§×•× ×”××—×™×¦×” ×œ××•×¨×š ×”×××¤×˜, \(\;0<x<L\)  
\(v(t)=\dot{x}(t)\) â€” ××”×™×¨×•×ª ×”××—×™×¦×”  
\(\gamma(v)=\dfrac{1}{\sqrt{1-(v/c)^2}}\) â€” ×’×•×¨× ×œ×•×¨× ×¥  
\(m\) â€” ××¡×” ××¤×§×˜×™×‘×™×ª ×©×œ ×”××—×™×¦×”  
\(A\) â€” ×©×˜×— ×”××—×™×¦×”  
\(P_L(t),P_R(t)\) â€” ×œ×—×¦×™× ×‘×ª××™× ×©×××œ/×™××™×Ÿ  
\(\beta\) â€” ×“××¤×™× ×’ ××¤×§×˜×™×‘×™ (×—×™×›×•×š/×˜×•×¨×‘×•×œ× ×¦×™×”/×”×¤×¡×“×™×)  
\(u(t)\) â€” ×›×•×— ×‘×§×¨×” ××•×¤×¦×™×•× ×œ×™ (××§×˜×•××˜×•×¨)  
\(\Psi\) â€” ×¤×•× ×§×¦×™×™×ª ×’×œ/×©×“×” ×§×•×•× ×˜×™ ×‘×ª×•×š ×”×××¤×˜  
`
    : String.raw`
\(c\) â€” speed of light, \(\;c \approx 3\times 10^8 \text{ m/s}\)  
\(x(t)\) â€” partition position along the amp, \(\;0<x<L\)  
\(v(t)=\dot{x}(t)\) â€” partition velocity  
\(\gamma(v)=\dfrac{1}{\sqrt{1-(v/c)^2}}\) â€” Lorentz factor  
\(m\) â€” effective partition mass  
\(A\) â€” partition area  
\(P_L(t),P_R(t)\) â€” left/right chamber pressures  
\(\beta\) â€” effective damping (friction/turbulence/losses)  
\(u(t)\) â€” optional control force (actuator)  
\(\Psi\) â€” quantum wavefunction/field in the amp
`;
  document.getElementById("varsBlock").innerHTML = vars;

  const geo = he
    ? String.raw`
×××¤×˜ ×—×“Ö¾×××“×™ (×œ×™×‘×”): \([0,L]\)  
×”××—×™×¦×” ×‘××™×§×•× \(x(t)\) ××—×œ×§×ª ×œ×©× ×™ × ×¤×—×™×:  
\[
V_L(t)=A\,x(t),\qquad V_R(t)=A\,(L-x(t))
\]
×‘××™××•×© ×ª×œ×ªÖ¾×××“×™: ×¦×™× ×•×¨/×—×œ×œ ×©×§×•×£, ××—×™×¦×” ××˜×•××”/×—×¦×™Ö¾×©×§×•×¤×”, ×•×—×œ×•× ×•×ª ××“×™×“×” ×‘×™×¦×™××”.
`
    : String.raw`
1D core amp: \([0,L]\)  
Partition at \(x(t)\) splits two volumes:
\[
V_L(t)=A\,x(t),\qquad V_R(t)=A\,(L-x(t))
\]
In 3D: a transparent tube/cavity, opaque/semi-transparent partition, and measurement windows at the output.
`;
  document.getElementById("geoBlock").innerHTML = geo;

  const assumptions = [
    he ? "×”××—×™×¦×” × ×¢×” ×œ××•×¨×š ×¦×™×¨ ××—×“, ×œ×œ× ×¡×™×‘×•×‘ (××¤×©×¨ ×œ×”×¨×—×™×‘)." : "1D motion (no rotation), extensible later.",
    he ? "××™×Ÿ ×—×“×™×¨×ª ×’×– ××©××¢×•×ª×™×ª ×“×¨×š ×”××—×™×¦×” (××™×˜×•× ××¤×§×˜×™×‘×™)." : "Negligible gas leakage through the partition (effective seal).",
    he ? "×œ×—×¥ ×”×’×– ××ª×•××¨ ××•×“×œ ××“×™××‘×˜×™/××™×–×•×ª×¨××™ ×œ×¤×™ ×¦×•×¨×š." : "Gas pressure modeled as adiabatic/isothermal as needed.",
    he ? "×”××“×™×“×” ×‘×¤×•×¢×œ × ×¢×©×™×ª ×‘×™×¦×™××ª ×”×××¤×˜ (××™× ×˜× ×¡×™×‘×™×•×ª/×¤××–×”/×¡×¤×§×˜×¨×•×)." : "Actual readout is at the amp output (intensity/phase/spectrum).",
    he ? "×”××—×™×¦×” ×™×›×•×œ×” ×œ×”×™×•×ª × ×©×œ×˜×ª ×—×™×¦×•× ×™×ª ×›×“×™ ×œ×™×™×¦×¨ ××•×“×•×œ×¦×™×” ××ª×•×›× × ×ª." : "External control can shape the partition modulation profile."
  ];
  const ul = document.getElementById("assumptions");
  ul.innerHTML = "";
  assumptions.forEach(t=>{
    const li = document.createElement("li");
    li.textContent = t;
    ul.appendChild(li);
  });

  const rel1 = he
    ? String.raw`
×ª× ×¢ ×™×—×¡×•×ª×™:
\[
p(t)=\gamma(v)\,m\,v
\]
××©×•×•××ª ×ª× ×•×¢×” ×›×œ×œ×™×ª:
\[
\frac{dp}{dt}=F(x,v,t)
\]
×›××©×¨ \(v<c\) ×ª××™×“, ×•-\(\gamma\to\infty\) ×›×©×”-\(v\to c\) (××•× ×¢ ××¢×‘×¨).
`
    : String.raw`
Relativistic momentum:
\[
p(t)=\gamma(v)\,m\,v
\]
General equation of motion:
\[
\frac{dp}{dt}=F(x,v,t)
\]
with \(v<c\) always, and \(\gamma\to\infty\) as \(v\to c\) (prevents crossing).
`;
  document.getElementById("relBlock1").innerHTML = rel1;

  const rel2 = he
    ? String.raw`
×›×•×— ×œ×—×¥ (×”×¤×¨×© ×œ×—×¦×™×) + ×“××¤×™× ×’:
\[
F_{\Delta P}(t)=A\,[P_L(t)-P_R(t)]
\]
\[
F_{\text{damp}}(t)= -\beta\,v(t)
\]
×•×× ×™×© ×‘×§×¨×”:
\[
F(t)=F_{\Delta P}+F_{\text{damp}}+u(t)
\]
×œ×›×Ÿ:
\[
\frac{d}{dt}\big(\gamma m v\big)=A\,[P_L-P_R]-\beta v+u(t)
\]
×‘× ×•×¡×£:
\[
\dot{x}=v
\]
`
    : String.raw`
Pressure-difference force + damping:
\[
F_{\Delta P}(t)=A\,[P_L(t)-P_R(t)]
\]
\[
F_{\text{damp}}(t)= -\beta\,v(t)
\]
Optional control:
\[
F(t)=F_{\Delta P}+F_{\text{damp}}+u(t)
\]
Thus:
\[
\frac{d}{dt}\big(\gamma m v\big)=A\,[P_L-P_R]-\beta v+u(t)
\]
And:
\[
\dot{x}=v
\]
`;
  document.getElementById("relBlock2").innerHTML = rel2;

  const gas = he
    ? String.raw`
××•×“×œ ×œ×—×¥ ××“×™××‘×˜×™ ×¤×©×•×˜ (×œ×›×œ ×ª×):
\[
P_L(t)=P_{0L}\left(\frac{V_{0L}}{V_L(t)}\right)^{\kappa},\quad
P_R(t)=P_{0R}\left(\frac{V_{0R}}{V_R(t)}\right)^{\kappa}
\]
×›××©×¨ \(\kappa\approx 1.4\) ×œ××•×•×™×¨ (×’×– ×“×™××˜×•××™ ××™×“×™××œ×™ ×‘×§×™×¨×•×‘).

×× ×¨×•×¦×™× ××•×“×œ ××™×–×•×ª×¨××™ (×¤×©×•×˜ ×™×•×ª×¨):
\[
P_L(t)=P_{0L}\frac{V_{0L}}{V_L(t)},\quad P_R(t)=P_{0R}\frac{V_{0R}}{V_R(t)}
\]
`
    : String.raw`
Simple adiabatic pressure model (each chamber):
\[
P_L(t)=P_{0L}\left(\frac{V_{0L}}{V_L(t)}\right)^{\kappa},\quad
P_R(t)=P_{0R}\left(\frac{V_{0R}}{V_R(t)}\right)^{\kappa}
\]
with \(\kappa\approx 1.4\) for air (approx.).

Isothermal (simpler) alternative:
\[
P_L(t)=P_{0L}\frac{V_{0L}}{V_L(t)},\quad P_R(t)=P_{0R}\frac{V_{0R}}{V_R(t)}
\]
`;
  document.getElementById("gasBlock").innerHTML = gas;

  const stable = he
    ? String.raw`
××’×‘×œ×•×ª ×¤×™×–×™×§×œ×™×•×ª:
\[
0<x(t)<L \quad \Rightarrow \quad V_L,V_R>0
\]
×”×’×‘×œ×ª ××”×™×¨×•×ª ××•×‘× ×™×ª ×¢"×™ ×™×—×¡×•×ª:
\[
|v(t)|<c
\]
×‘××•×“×œ × ×•××¨×™, ×›×“×™ ×œ×× ×•×¢ ×§×¨×™×¡×” ×›×©-\(V\to 0\), ××©×ª××©×™× ×‘××—×¡×•× ×§×˜×Ÿ \(\epsilon\):
\[
V_L=\max(Ax,\epsilon),\quad V_R=\max(A(L-x),\epsilon)
\]
`
    : String.raw`
Physical constraints:
\[
0<x(t)<L \quad \Rightarrow \quad V_L,V_R>0
\]
Speed limit enforced by relativity:
\[
|v(t)|<c
\]
Numerically, avoid blow-up as \(V\to 0\) via a small barrier \(\epsilon\):
\[
V_L=\max(Ax,\epsilon),\quad V_R=\max(A(L-x),\epsilon)
\]
`;
  document.getElementById("stabilityBlock").innerHTML = stable;

  const ham = he
    ? String.raw`
× ×¡××Ÿ ××ª ××™×§×•× ×”××—×™×¦×” \(X(t)\) ×›×¤×¨××˜×¨ ×§×œ××¡×™ (××• ××•×¤×¨×˜×•×¨ ×›×‘×“ ×××•×“).

×”××™×œ×˜×•× ×™××Ÿ ×›×•×œ×œ ×©×œ×•×©×” ×—×œ×§×™×:
\[
H(t)=H_{\text{sys}} + H_{\text{amp}}(X,\dot X) + H_{\text{int}}(X)
\]

×“×•×’××” ×§×•× ×¡×¤×˜×•××œ×™×ª ×œ×©×“×” ×¡×§×œ×¨×™ \(\Psi\) ×‘×××¤×˜ ×¢× ×ª× ××™ ×©×¤×” ×ª×œ×•×™×™Ö¾×–××Ÿ:
\[
\Psi(0,t)=0,\quad \Psi(X(t),t)=0,\quad \Psi(L,t)=0
\]
××• (×‘××§×¨×” ××—×™×¦×” ×—×¦×™Ö¾×©×§×•×¤×”) ×ª× ××™ ×§×¤×™×¦×”:
\[
\partial_x \Psi|_{X^+}-\partial_x \Psi|_{X^-}=\lambda\,\Psi(X,t)
\]
×›×š ×©×”××—×™×¦×” "×××•×“×œ×ª" ××ª ×”×¡×¤×§×˜×¨×•×/×¤××–×” ×©×œ ×”××¦×‘×™× ×‘×ª×•×š ×”×××¤×˜ ×œ××•×¨×š ×–××Ÿ.
`
    : String.raw`
Let the partition position \(X(t)\) be a classical (or very heavy) parameter.

Hamiltonian split:
\[
H(t)=H_{\text{sys}} + H_{\text{amp}}(X,\dot X) + H_{\text{int}}(X)
\]

Conceptual scalar field \(\Psi\) in the amp with time-dependent boundary conditions:
\[
\Psi(0,t)=0,\quad \Psi(X(t),t)=0,\quad \Psi(L,t)=0
\]
Or (semi-transparent partition) a jump condition:
\[
\partial_x \Psi|_{X^+}-\partial_x \Psi|_{X^-}=\lambda\,\Psi(X,t)
\]
So the moving partition modulates spectrum/phase of amp modes over time.
`;
  document.getElementById("hamBlock").innerHTML = ham;

  const obs = he
    ? String.raw`
×‘××§×•× ×œ××“×•×“ ×™×©×™×¨×•×ª ××•×¤×¨×˜×•×¨ ×¢×œ ×”××¢×¨×›×ª \(\hat O\), ××•×“×“×™× ×¤×•× ×§×¦×™×•× ×œ ×‘×™×¦×™××”:

\[
I(\omega,t)=\left|\mathcal{F}\{s(t)\}\right|^2
\]
×›××©×¨ \(s(t)\) ×”×•× ××•×ª × ××“×“ (××™× ×˜× ×¡×™×‘×™×•×ª/×¤××–×”/×–×¨× ×¤×•×˜×•) ××—×¨×™ ×”×××¤×˜.

×§×•× ×¡×¤×˜: ×”×××¤×˜ ××‘×¦×¢ "×§×™×“×•×“" ×©×œ ×ª×›×•× ×•×ª ×§×•×•× ×˜×™×•×ª ×œ×“×¤×•×¡ ×–××ŸÖ¾×ª×“×¨,
×•××– ×”××“×™×“×” ×”×§×œ××¡×™×ª ×§×•×¨××ª ××ª ×”×“×¤×•×¡ ×•×œ× ××ª×¢×¨×‘×ª ×™×©×™×¨×•×ª ×‘××¢×¨×›×ª.
`
    : String.raw`
Instead of directly measuring an operator \(\hat O\) on the system, measure an output functional:

\[
I(\omega,t)=\left|\mathcal{F}\{s(t)\}\right|^2
\]
where \(s(t)\) is the measured signal (intensity/phase/photocurrent) after the amp.

Concept: the amp â€œencodesâ€ quantum features into a timeâ€“frequency pattern; the classical readout reads the pattern rather than directly disturbing the system.
`;
  document.getElementById("obsBlock").innerHTML = obs;
}

function fillSteps(){
  const he = (LANG==="he");
  const steps = [
    {
      n: 1,
      badge: he ? "×”×’×“×¨×”" : "Define",
      kind: "info",
      title: he ? "××’×“×™×¨×™× × ×¤×— ×¡×’×•×¨ (â€œAmpâ€) ×‘×™×Ÿ ×”××¢×¨×›×ª ×œ×’×œ××™" : "Define a closed volume (â€œAmpâ€) between system and detector",
      body: he
        ? "×”×××¤×˜ ×”×•× ××–×•×¨ ×‘×™× ×™×™× ×¤×™×–×™×§×œ×™: ×—×œ×œ ×©×§×•×£/××•×’×“×¨, ×¢× ×™×¦×™××” ×œ××“×™×“×”. ×”××¢×¨×›×ª ×”×§×•×•× ×˜×™×ª ×œ× ××¦×•××“×ª ×™×©×™×¨×•×ª ×œ×’×œ××™."
        : "The amp is a physical intermediate region with an output port. The quantum system is not directly coupled to the detector."
    },
    {
      n: 2,
      badge: he ? "××›× ×™×§×”" : "Mechanics",
      kind: "info",
      title: he ? "××›× ×™×¡×™× ××—×™×¦×” × ×¢×” + ×’×– ×“×—×•×¡ ×›×“×™ ×œ×™×¦×•×¨ ××•×“×•×œ×¦×™×”" : "Add a moving partition + compressed gas to create modulation",
      body: he
        ? "×”××—×™×¦×” ××™×™×¦×¨×ª ×ª× ××™ ×©×¤×” ×ª×œ×•×™×™Ö¾×–××Ÿ ×œ×©×“×”/×’×œ ×‘×××¤×˜. ×ª× ×•×¢×” ××”×™×¨×” × ×•×ª× ×ª ×¡×¨×™×§×”/×§×™×“×•×“ ×©×œ ××™×“×¢ ×œ××‘× ×” ××¨×—×‘×™."
        : "The partition imposes time-dependent boundary conditions. Fast motion produces scanning/encoding into a spatial-temporal structure."
    },
    {
      n: 3,
      badge: he ? "××©×•×•××•×ª" : "Equations",
      kind: "ok",
      title: he ? "××©×•×•××•×ª ×ª× ×•×¢×” ×™×—×¡×•×ª×™×•×ª ××‘×˜×™×—×•×ª v<c" : "Relativistic EOM enforce v<c",
      body: he
        ? "××©×ª××©×™× ×‘Ö¾ d/dt(Î³mv)=A(PLâˆ’PR)âˆ’Î²v+u(t). ×’×•×¨× ×œ×•×¨× ×¥ ××•× ×¢ ××¢×‘×¨ ×œÖ¾c ×‘××•×¤×Ÿ ×˜×‘×¢×™."
        : "Use d/dt(Î³mv)=A(PLâˆ’PR)âˆ’Î²v+u(t). Lorentz factor naturally prevents exceeding c."
    },
    {
      n: 4,
      badge: he ? "×§×•×•× ×˜×™×" : "QM",
      kind: "ok",
      title: he ? "×× ×¡×—×™× ××ª ×”××—×™×¦×” ×›Ö¾X(t) ×©××’×“×™×¨ ×ª× ××™ ×©×¤×” ×œ×©×“×”" : "Treat the partition as X(t) defining boundary conditions for the field",
      body: he
        ? "×”××¢×¨×›×ª ×”×§×•×•× ×˜×™×ª ×—×•×•×” H(t) ×¢× ×ª× ××™ ×©×¤×” ×ª×œ×•×™×™Ö¾×–××Ÿ. ×–×” ×œ× ×¡×•×ª×¨ QM â€” ×–×• ××¢×¨×›×ª ××•× ×¢×ª ×‘×–××Ÿ (driven)."
        : "The quantum system sees H(t) with time-dependent boundaries. This does not violate QMâ€”it's a driven system."
    },
    {
      n: 5,
      badge: he ? "××“×™×“×”" : "Readout",
      kind: "warn",
      title: he ? "××•×“×“×™× ×‘×™×¦×™××ª ×”×××¤×˜ ×“×¤×•×¡ ×–××ŸÖ¾×ª×“×¨ ×‘××§×•× ××“×™×“×” ×™×©×™×¨×”" : "Measure timeâ€“frequency patterns at the amp output rather than direct measurement",
      body: he
        ? "×”×’×œ××™ ×§×•×¨× s(t) ××—×¨×™ ×”×××¤×˜: ××™× ×˜× ×¡×™×‘×™×•×ª/×¤××–×”/×¡×¤×§×˜×¨×•×. ×”×“×§×•Ö¾×”×¨× ×˜×™×•×ª ××ª×¨×—×©×ª ×¢×œ ×”××•×ª ×”××§×•×“×“, ×œ× ×¢×œ ×”××¢×¨×›×ª."
        : "Detector reads s(t) after the amp: intensity/phase/spectrum. Decoherence acts on the encoded signal, not directly on the system."
    },
    {
      n: 6,
      badge: he ? "×¡×‘×™×‘×”" : "Environment",
      kind: "info",
      title: he ? "×ª× ××™× ××¢×œ ×”×™×: ×”×•×¨×“×ª ×¨×¢×© ×•×©×“×•×ª ××¤×¨×™×¢×™×" : "Over-ocean conditions: reduce noise and disturbances",
      body: he
        ? "×”×¦×“×§×” ×¤×¨×§×˜×™×ª: ×¤×—×•×ª ×”×¤×¨×¢×•×ª ××œ×§×˜×¨×•××’× ×˜×™×•×ª/××‘× ×™×•×ª ×•×¨×¢×© ×¡×‘×™×‘×ª×™ â†’ ×¤×—×•×ª ×“×§×•Ö¾×”×¨× ×˜×™×•×ª ×œ× ×¨×¦×•×™×”."
        : "Practical motivation: lower EM/structural noise â†’ less unwanted decoherence."
    },
    {
      n: 7,
      badge: he ? "×ª×•×¦××”" : "Outcome",
      kind: "ok",
      title: he ? "××§×‘×œ×™× â€œ×ª××•× ×”â€ = ×“×¤×•×¡ ××“×™×“ ×©××™×™×¦×’ ×ª×›×•× ×•×ª ×§×•×•× ×˜×™×•×ª" : "You get a â€œpictureâ€ = a measurable pattern representing quantum features",
      body: he
        ? "×”×“×¤×•×¡ ×™×›×•×œ ×œ×”×™×•×ª ×”×ª××‘×›×•×ª/×¤××–×”/×¡×¤×§×˜×¨×•× ×©×××¤×” ××¦×‘×™× ××• ×¤×¨××˜×¨×™× ×©×œ ×”××¢×¨×›×ª."
        : "Pattern can be interference/phase/spectrum that maps states or parameters of the system."
    }
  ];

  const box = document.getElementById("steps");
  box.innerHTML = "";
  steps.forEach(s=>{
    const d = document.createElement("div");
    d.className = "step";
    const badgeClass = s.kind === "ok" ? "ok" : (s.kind === "warn" ? "warn" : "info");
    d.innerHTML = `
      <div class="title">
        <div>Step ${s.n}. ${escapeHtml(s.title)}</div>
        <div class="badge ${badgeClass}">${escapeHtml(s.badge)}</div>
      </div>
      <div class="muted">${escapeHtml(s.body)}</div>
    `;
    box.appendChild(d);
  });
}

/* =========================
   Theme toggle
========================= */
let THEME = "auto";
function toggleTheme(){
  const isDark = document.documentElement.getAttribute("data-theme")==="dark";
  document.documentElement.setAttribute("data-theme", isDark ? "light" : "dark");
}

/* =========================
   Relativistic simulation
========================= */
const c = 299792458; // m/s
const kappa = 1.4;
const eps = 1e-9;

function gammaFromV(v){
  const b = v/c;
  const bb = b*b;
  return 1/Math.sqrt(Math.max(1e-15, 1-bb));
}

// Force based on adiabatic pressures
function pressures(x, A, L, P0L, P0R, V0L, V0R){
  const VL = Math.max(A*x, eps);
  const VR = Math.max(A*(L-x), eps);
  const PL = P0L * Math.pow(V0L/VL, kappa);
  const PR = P0R * Math.pow(V0R/VR, kappa);
  return {PL, PR, VL, VR};
}

// Convert state (x,v) -> derivatives (dx/dt, dv/dt) using dp/dt = F
function deriv(t, state, params){
  const {m, A, beta, L, P0L, P0R, V0L, V0R, u0, omegaU} = params;
  const x = state.x;
  const v = state.v;

  const {PL, PR, VL, VR} = pressures(x, A, L, P0L, P0R, V0L, V0R);
  const Fp = A*(PL - PR);

  // Optional control force (small sinusoid just to show capability)
  const u = u0 * Math.sin(omegaU*t);

  const F = Fp - beta*v + u;

  // dp/dt = F ; p = gamma m v
  // dp/dt = d/dt(gamma m v) = m gamma^3 a (in 1D)
  // => a = F / (m gamma^3)
  const g = gammaFromV(v);
  const a = F / (m * Math.pow(g,3));

  // Safety: keep within amp bounds by soft wall force (numerical)
  let wall = 0;
  const margin = 1e-4 * Math.max(1, L);
  if(x < margin) wall += (margin - x) * 1e6;
  if(x > L - margin) wall -= (x - (L - margin)) * 1e6;

  const a2 = a + wall/(m*Math.pow(g,3));

  return { dx: v, dv: a2, PL, PR, VL, VR, F };
}

// RK4 integrator
function rk4Step(t, state, dt, params){
  const k1 = deriv(t, state, params);
  const s2 = { x: state.x + 0.5*dt*k1.dx, v: state.v + 0.5*dt*k1.dv };
  const k2 = deriv(t+0.5*dt, s2, params);
  const s3 = { x: state.x + 0.5*dt*k2.dx, v: state.v + 0.5*dt*k2.dv };
  const k3 = deriv(t+0.5*dt, s3, params);
  const s4 = { x: state.x + dt*k3.dx, v: state.v + dt*k3.dv };
  const k4 = deriv(t+dt, s4, params);

  const x = state.x + (dt/6)*(k1.dx + 2*k2.dx + 2*k3.dx + k4.dx);
  let v = state.v + (dt/6)*(k1.dv + 2*k2.dv + 2*k3.dv + k4.dv);

  // clamp v softly to < c (numerical)
  const vmax = 0.999999*c;
  if(v > vmax) v = vmax;
  if(v < -vmax) v = -vmax;

  return { x, v, meta: k4 };
}

/* =========================
   Plotting
========================= */
function drawPlot(canvas, data, L){
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // axes frame
  ctx.lineWidth = 2;
  ctx.strokeStyle = "rgba(148,163,184,.55)";
  ctx.strokeRect(40, 20, W-60, H-60);

  // find ranges
  const tMax = data[data.length-1].t;
  let xMin=Infinity, xMax=-Infinity, vMin=Infinity, vMax=-Infinity;
  data.forEach(p=>{
    xMin = Math.min(xMin, p.x);
    xMax = Math.max(xMax, p.x);
    vMin = Math.min(vMin, p.v);
    vMax = Math.max(vMax, p.v);
  });

  // Expand ranges a bit
  const pad = 1e-9;
  xMin = Math.min(xMin, 0);
  xMax = Math.max(xMax, L);
  vMin -= Math.abs(vMin)*0.05 + pad;
  vMax += Math.abs(vMax)*0.05 + pad;

  const plotX0=40, plotY0=20, plotW=W-60, plotH=H-60;
  const mapX = (t)=> plotX0 + (t/tMax)*plotW;
  const mapYx = (x)=> plotY0 + plotH - ((x - xMin)/(xMax-xMin))*plotH;
  const mapYv = (v)=> plotY0 + plotH - ((v - vMin)/(vMax-vMin))*plotH;

  // draw x(t)
  ctx.lineWidth = 2.5;
  ctx.strokeStyle = "rgba(99,102,241,.95)";
  ctx.beginPath();
  data.forEach((p,i)=>{
    const X = mapX(p.t);
    const Y = mapYx(p.x);
    if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
  });
  ctx.stroke();

  // draw v(t)
  ctx.lineWidth = 2.0;
  ctx.strokeStyle = "rgba(34,211,238,.95)";
  ctx.beginPath();
  data.forEach((p,i)=>{
    const X = mapX(p.t);
    const Y = mapYv(p.v);
    if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
  });
  ctx.stroke();

  // legend
  ctx.font = "14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillStyle = "rgba(99,102,241,.95)";
  ctx.fillText("x(t)", 52, 42);
  ctx.fillStyle = "rgba(34,211,238,.95)";
  ctx.fillText("v(t)", 100, 42);

  // labels
  ctx.fillStyle = "rgba(100,116,139,.95)";
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace";
  ctx.fillText("t=0", plotX0, H-18);
  ctx.fillText("t=max", plotX0+plotW-60, H-18);
}

function formatSI(x){
  // simple formatter
  if(!isFinite(x)) return "NaN";
  const ax = Math.abs(x);
  if(ax === 0) return "0";
  if(ax >= 1e6 || ax < 1e-3){
    return x.toExponential(3);
  }
  return x.toFixed(6).replace(/0+$/,'').replace(/\.$/,'');
}

/* =========================
   UI wiring
========================= */
const el = (id)=>document.getElementById(id);

const inputs = ["m","A","beta","P0L","P0R","L","x0","v0","T","dt"];
function syncVals(){
  inputs.forEach(id=>{
    const v = parseFloat(el(id).value);
    const label = el(id+"Val");
    if(id==="v0"){
      label.textContent = `${formatSI(v)} c  â†’  ${formatSI(v*c)} m/s`;
    } else if(id==="P0L" || id==="P0R"){
      label.textContent = `${Math.round(v).toLocaleString()} Pa`;
    } else {
      label.textContent = `${formatSI(v)}`;
    }
  });

  // keep x0 within [0.01, L-0.01]
  const L = parseFloat(el("L").value);
  const x0 = el("x0");
  x0.max = Math.max(0.02, L-0.01).toFixed(2);
  if(parseFloat(x0.value) > parseFloat(x0.max)) x0.value = x0.max;
  if(parseFloat(x0.value) < parseFloat(x0.min)) x0.value = x0.min;
  el("x0Val").textContent = formatSI(parseFloat(x0.value));
}

inputs.forEach(id=> el(id).addEventListener("input", syncVals));

el("btnTheme").addEventListener("click", ()=>toggleTheme());

document.querySelectorAll(".langbtn").forEach(b=>{
  b.addEventListener("click", ()=>setLang(b.dataset.lang));
});

el("btnReset").addEventListener("click", ()=>{
  el("m").value=5;
  el("A").value=0.02;
  el("beta").value=2;
  el("P0L").value=400000;
  el("P0R").value=120000;
  el("L").value=1.2;
  el("x0").value=0.6;
  el("v0").value=0;
  el("T").value=0.25;
  el("dt").value=0.0005;
  syncVals();
  runSim();
});

el("btnRun").addEventListener("click", runSim);

function runSim(){
  const m = parseFloat(el("m").value);
  const A = parseFloat(el("A").value);
  const beta = parseFloat(el("beta").value);
  const P0L = parseFloat(el("P0L").value);
  const P0R = parseFloat(el("P0R").value);
  const L = parseFloat(el("L").value);
  const x0 = parseFloat(el("x0").value);
  const v0frac = parseFloat(el("v0").value);
  const T = parseFloat(el("T").value);
  const dt = parseFloat(el("dt").value);

  // initial volumes: based on initial split
  const V0L = Math.max(A*x0, eps);
  const V0R = Math.max(A*(L-x0), eps);

  // Optional small control (set to 0 by default)
  const u0 = 0;          // N
  const omegaU = 2*Math.PI*40; // rad/s (placeholder)

  const params = {m, A, beta, L, P0L, P0R, V0L, V0R, u0, omegaU};

  let state = {x:x0, v: v0frac*c};
  const N = Math.max(2, Math.floor(T/dt));
  const data = [];
  let t=0;

  let maxBeta=0, maxGamma=0, maxF=0;
  let minX=Infinity, maxX=-Infinity;

  for(let i=0;i<=N;i++){
    const g = gammaFromV(state.v);
    maxGamma = Math.max(maxGamma, g);
    maxBeta = Math.max(maxBeta, Math.abs(state.v)/c);
    minX = Math.min(minX, state.x);
    maxX = Math.max(maxX, state.x);

    data.push({t, x: state.x, v: state.v});
    state = rk4Step(t, state, dt, params);
    t += dt;

    // keep inside [0,L] softly
    if(state.x < 0) state.x = 0.000001;
    if(state.x > L) state.x = L-0.000001;
  }

  drawPlot(el("plot"), data, L);

  // final meta
  const last = data[data.length-1];
  const {PL, PR, VL, VR, F} = deriv(T, {x:last.x, v:last.v}, params);

  maxF = Math.abs(F);

  const he = (LANG==="he");
  const out = he
    ? String.raw`×ª×•×¦××•×ª (×“×•×’××” × ×•××¨×™×ª):
- \(L=${formatSI(L)}\) m, \(A=${formatSI(A)}\) mÂ², \(m=${formatSI(m)}\) kg, \(\beta=${formatSI(beta)}\)
- ××§×¡×™××•× \(|v|/c \approx ${formatSI(maxBeta)}\)
- ××§×¡×™××•× \(\gamma \approx ${formatSI(maxGamma)}\)
- ×˜×•×•×— \(x(t)\): [${formatSI(minX)}, ${formatSI(maxX)}] m
- ×‘×¡×•×£: \(x(T)=${formatSI(last.x)}\) m, \(v(T)=${formatSI(last.v)}\) m/s
- ×œ×—×¦×™× ×‘×¡×•×£ (××“×™××‘×˜×™): \(P_L \approx ${Math.round(PL).toLocaleString()} \text{ Pa}\), \(P_R \approx ${Math.round(PR).toLocaleString()} \text{ Pa}\)
×”×¢×¨×”: ×–×” ××•×“×œ ×”×“×’××”. × ×™×ª×Ÿ ×œ×”×—×œ×™×£ \(P(V)\) ×œ××•×“×œ ××¤×•×¨×˜ (×ª×¨××•/×–×¨×™××”) ×•×œ×”×•×¡×™×£ \(u(t)\) ×œ×‘×§×¨×”.`
    : String.raw`Results (numerical demo):
- \(L=${formatSI(L)}\) m, \(A=${formatSI(A)}\) mÂ², \(m=${formatSI(m)}\) kg, \(\beta=${formatSI(beta)}\)
- max \(|v|/c \approx ${formatSI(maxBeta)}\)
- max \(\gamma \approx ${formatSI(maxGamma)}\)
- \(x(t)\) range: [${formatSI(minX)}, ${formatSI(maxX)}] m
- final: \(x(T)=${formatSI(last.x)}\) m, \(v(T)=${formatSI(last.v)}\) m/s
- final pressures (adiabatic): \(P_L \approx ${Math.round(PL).toLocaleString()} \text{ Pa}\), \(P_R \approx ${Math.round(PR).toLocaleString()} \text{ Pa}\)
Note: demo model. Replace \(P(V)\) with a detailed thermo/flow model and add \(u(t)\) for control if needed.`;

  el("simOut").textContent = out;
  renderMath();
}

function renderMath(){
  if(!window.renderMathInElement) return;
  renderMathInElement(document.body, {
    delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "\\[", right: "\\]", display: true},
      {left: "\\(", right: "\\)", display: false},
      {left: "$", right: "$", display: false}
    ],
    throwOnError: false
  });
}

function escapeHtml(s){
  return (s+"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

/* =========================
   Init
========================= */
function init(){
  // default theme: follow prefers-color-scheme but allow toggle
  document.documentElement.setAttribute("data-theme", "light");
  // fill blocks & steps
  fillBlocks();
  fillSteps();
  syncVals();

  // render math after KaTeX loads
  window.addEventListener("load", ()=>{
    renderMath();
    runSim();
  });
}

init();
</script>

</body>
</html>
